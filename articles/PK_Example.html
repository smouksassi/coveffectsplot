<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PK Model: Assessing the Marginal Impact of Covariates on Drug Exposure â€¢ coveffectsplot</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/united/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="PK Model: Assessing the Marginal Impact of Covariates on Drug Exposure">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">coveffectsplot</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.0.7</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Vignettes

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/introduction_to_coveffectsplot.html">Introduction to coveffectsplot</a>
    </li>
    <li>
      <a href="../articles/Exposure_Response_Example.html">Exposure-Response Example</a>
    </li>
    <li>
      <a href="../articles/PK_Example.html">PK Example</a>
    </li>
    <li>
      <a href="../articles/PK_Example_full.html">PK Example Full</a>
    </li>
    <li>
      <a href="../articles/Pediatric_Cov_Sim.html">PK Pediatric Example</a>
    </li>
    <li>
      <a href="../articles/PKPD_Example.html">PKPD Example</a>
    </li>
  </ul>
</li>
<li>
  <a href="../articles/app.html">Shiny App</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/smouksassi/coveffectsplot/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>PK Model: Assessing the Marginal Impact of
Covariates on Drug Exposure</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/smouksassi/coveffectsplot/blob/v1.0.7/vignettes/PK_Example.Rmd" class="external-link"><code>vignettes/PK_Example.Rmd</code></a></small>
      <div class="hidden name"><code>PK_Example.Rmd</code></div>

    </div>

    
    
<p>Here we illustrate the varying one covariate at a time approach,
keeping all the others at the reference value or category. A
two-compartment pharmacokinetic (PK) model defined with ordinary
differential equations (ODEs) is used. Covariates Weight, Albumin and
Sex had effects on the Clearance (CL) model parameter while Weight and
Sex had effects on the Volume of distribution (V) model parameter. For
simplicity, there were no included covariates effects on other PK
parameters such as peripheral clearance or volume. The approach is
general and can be easily extended to any other ODEs model with multiple
covariate effects on multiple model parameters.</p>
<div class="section level2">
<h2 id="specifying-a-pk-model-using-mrgsolve">Specifying a PK Model using <code>mrgsolve</code><a class="anchor" aria-label="anchor" href="#specifying-a-pk-model-using-mrgsolve"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">codepkmodelcov</span> <span class="op">&lt;-</span> <span class="st">'</span></span>
<span><span class="st">$PARAM @annotated</span></span>
<span><span class="st">KA    : 0.5   : Absorption rate constant Ka (1/h)</span></span>
<span><span class="st">CL    : 4     : Clearance CL (L/h)</span></span>
<span><span class="st">V     : 10    : Central volume Vc (L)</span></span>
<span><span class="st">Vp    : 50    : Peripheral volume Vp (L)</span></span>
<span><span class="st">Qp    : 10    : Intercompartmental clearance Q (L/h)</span></span>
<span><span class="st">CLALB : -0.8  : Ablumin on CL (ref. 45 g/L)</span></span>
<span><span class="st">CLSEX : 0.2   : Sex on CL (ref. Female)</span></span>
<span><span class="st">CLWT  : 1     : Weight on CL (ref. 85 kg)</span></span>
<span><span class="st">VSEX  : 0.07  : Sex on Vc (ref. Female)</span></span>
<span><span class="st">VWT   : 1     : Weight on Vc (ref. 85 kg)</span></span>
<span><span class="st"></span></span>
<span><span class="st">$PARAM @annotated // reference values for covariate</span></span>
<span><span class="st">WT    : 85    : Weight (kg)</span></span>
<span><span class="st">SEX   : 0     : Sex (0=Female, 1=Male)</span></span>
<span><span class="st">ALB   : 45    : Albumin (g/L)</span></span>
<span><span class="st"></span></span>
<span><span class="st">$PKMODEL cmt="GUT CENT PER", depot=TRUE, trans=11</span></span>
<span><span class="st"></span></span>
<span><span class="st">$MAIN</span></span>
<span><span class="st">double CLi = CL *</span></span>
<span><span class="st">    pow((ALB/45.0), CLALB)*</span></span>
<span><span class="st">    (SEX == 1.0 ? (1.0+CLSEX) : 1.0)*</span></span>
<span><span class="st">    pow((WT/85.0), CLWT)*exp(nCL); </span></span>
<span><span class="st">double V2i = V *</span></span>
<span><span class="st">    (SEX == 1.0 ? (1.0+VSEX) : 1.0)*</span></span>
<span><span class="st">    pow((WT/85.0), VWT)*exp(nVC);  </span></span>
<span><span class="st"></span></span>
<span><span class="st">double KAi = KA;</span></span>
<span><span class="st">double V3i = Vp *pow((WT/85.0),    1);</span></span>
<span><span class="st">double Qi = Qp *pow((WT/85.0), 0.75);</span></span>
<span><span class="st"></span></span>
<span><span class="st">$OMEGA @annotated @block</span></span>
<span><span class="st">nCL : 0.09       : ETA on CL</span></span>
<span><span class="st">nVC : 0.01 0.09  : ETA on Vc</span></span>
<span><span class="st"></span></span>
<span><span class="st">$TABLE</span></span>
<span><span class="st">double CP   = CENT/V2i;</span></span>
<span><span class="st"></span></span>
<span><span class="st">$CAPTURE CP KAi CLi V2i V3i Qi WT SEX ALB</span></span>
<span><span class="st">'</span></span>
<span><span class="va">modcovsim</span> <span class="op">&lt;-</span> <span class="fu">mcode</span><span class="op">(</span><span class="st">"codepkmodelcov"</span>, <span class="va">codepkmodelcov</span><span class="op">)</span></span>
<span></span>
<span><span class="va">partab</span> <span class="op">&lt;-</span> <span class="fu">setDT</span><span class="op">(</span><span class="va">modcovsim</span><span class="op">@</span><span class="va">annot</span><span class="op">$</span><span class="va">data</span><span class="op">)</span><span class="op">[</span><span class="va">block</span><span class="op">==</span><span class="st">"PARAM"</span>, <span class="fu">.</span><span class="op">(</span><span class="va">name</span>, <span class="va">descr</span>, <span class="va">unit</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">partab</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="va">partab</span>, <span class="fu">melt</span><span class="op">(</span><span class="fu">setDT</span><span class="op">(</span><span class="va">modcovsim</span><span class="op">@</span><span class="va">param</span><span class="op">@</span><span class="va">data</span><span class="op">)</span>, meas<span class="op">=</span><span class="fu">patterns</span><span class="op">(</span><span class="st">"*"</span><span class="op">)</span>, var<span class="op">=</span><span class="st">"name"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">partab</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">name</th>
<th align="left">descr</th>
<th align="left">unit</th>
<th align="right">value</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">ALB</td>
<td align="left">Albumin</td>
<td align="left">g/L</td>
<td align="right">45.00</td>
</tr>
<tr class="even">
<td align="left">CL</td>
<td align="left">Clearance CL</td>
<td align="left">L/h</td>
<td align="right">4.00</td>
</tr>
<tr class="odd">
<td align="left">CLALB</td>
<td align="left">Ablumin on CL</td>
<td align="left">ref. 45 g/L</td>
<td align="right">-0.80</td>
</tr>
<tr class="even">
<td align="left">CLSEX</td>
<td align="left">Sex on CL</td>
<td align="left">ref. Female</td>
<td align="right">0.20</td>
</tr>
<tr class="odd">
<td align="left">CLWT</td>
<td align="left">Weight on CL</td>
<td align="left">ref. 85 kg</td>
<td align="right">1.00</td>
</tr>
<tr class="even">
<td align="left">KA</td>
<td align="left">Absorption rate constant Ka</td>
<td align="left">1/h</td>
<td align="right">0.50</td>
</tr>
<tr class="odd">
<td align="left">Qp</td>
<td align="left">Intercompartmental clearance Q</td>
<td align="left">L/h</td>
<td align="right">10.00</td>
</tr>
<tr class="even">
<td align="left">SEX</td>
<td align="left">Sex</td>
<td align="left">0=Female, 1=Male</td>
<td align="right">0.00</td>
</tr>
<tr class="odd">
<td align="left">V</td>
<td align="left">Central volume Vc</td>
<td align="left">L</td>
<td align="right">10.00</td>
</tr>
<tr class="even">
<td align="left">VSEX</td>
<td align="left">Sex on Vc</td>
<td align="left">ref. Female</td>
<td align="right">0.07</td>
</tr>
<tr class="odd">
<td align="left">VWT</td>
<td align="left">Weight on Vc</td>
<td align="left">ref. 85 kg</td>
<td align="right">1.00</td>
</tr>
<tr class="even">
<td align="left">Vp</td>
<td align="left">Peripheral volume Vp</td>
<td align="left">L</td>
<td align="right">50.00</td>
</tr>
<tr class="odd">
<td align="left">WT</td>
<td align="left">Weight</td>
<td align="left">kg</td>
<td align="right">85.00</td>
</tr>
</tbody>
</table>
<div class="section level3">
<h3 id="simulate-a-reference-subjects-with-bsv">Simulate a Reference Subjects with BSV<a class="anchor" aria-label="anchor" href="#simulate-a-reference-subjects-with-bsv"></a>
</h3>
<p>We simulate the reference subject having the reference covariate
values defined in the model which are:<br>
Weight = 85 kg, Sex = Female and Albumin = 45 g/L. We also keep the
between subject variability (BSV) to illustrate its effects on the
concentration-time profiles on linear and log linear scales.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">idata</span> <span class="op">&lt;-</span> <span class="fu">data.table</span><span class="op">(</span>ID<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="va">nbsvsubjects</span>, WT<span class="op">=</span><span class="fl">85</span>, SEX<span class="op">=</span><span class="fl">0</span>, ALB<span class="op">=</span><span class="fl">45</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ev1</span> <span class="op">&lt;-</span> <span class="fu">ev</span><span class="op">(</span>time <span class="op">=</span> <span class="fl">0</span>, amt <span class="op">=</span> <span class="fl">100</span>, cmt <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">data.dose</span> <span class="op">&lt;-</span> <span class="fu">ev</span><span class="op">(</span><span class="va">ev1</span><span class="op">)</span></span>
<span><span class="va">data.dose</span> <span class="op">&lt;-</span> <span class="fu">setDT</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">data.dose</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">data.all</span> <span class="op">&lt;-</span> <span class="fu">data.table</span><span class="op">(</span><span class="va">idata</span>, <span class="va">data.dose</span><span class="op">)</span></span>
<span></span>
<span><span class="va">outputsim</span> <span class="op">&lt;-</span> <span class="va">modcovsim</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">data_set</span><span class="op">(</span><span class="va">data.all</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">mrgsim</span><span class="op">(</span>end <span class="op">=</span> <span class="fl">24</span>, delta <span class="op">=</span> <span class="fl">0.25</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="va">as.data.frame</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="va">as.data.table</span></span>
<span></span>
<span><span class="va">outputsim</span><span class="op">$</span><span class="va">SEX</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">outputsim</span><span class="op">$</span><span class="va">SEX</span>, labels<span class="op">=</span><span class="st">"Female"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Only plot a random sample of N=500</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">678549</span><span class="op">)</span></span>
<span><span class="va">plotdata</span> <span class="op">&lt;-</span> <span class="va">outputsim</span><span class="op">[</span><span class="va">ID</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">ID</span><span class="op">)</span>, <span class="fl">500</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># New facet label names for dose variable</span></span>
<span><span class="va">albumin.labs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"albumin: 45 ng/mL"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">albumin.labs</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"45"</span><span class="op">)</span></span>
<span><span class="va">wt.labs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"weight: 85 kg"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">wt.labs</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"85"</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">plotdata</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">CP</span>, group <span class="op">=</span> <span class="va">ID</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.2</span>, size <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span><span class="op">~</span> <span class="va">WT</span> <span class="op">+</span> <span class="va">ALB</span> <span class="op">+</span> <span class="va">SEX</span>,</span>
<span>             labeller <span class="op">=</span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labeller.html" class="external-link">labeller</a></span><span class="op">(</span>ALB <span class="op">=</span> <span class="va">albumin.labs</span>,</span>
<span>                                  WT <span class="op">=</span> <span class="va">wt.labs</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>y <span class="op">=</span> <span class="st">"Plasma Concentrations"</span>, x <span class="op">=</span> <span class="st">"Time (h)"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">plotdata</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">CP</span>, group <span class="op">=</span> <span class="va">ID</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.2</span>, size <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span><span class="op">~</span> <span class="va">WT</span> <span class="op">+</span> <span class="va">ALB</span> <span class="op">+</span> <span class="va">SEX</span>,</span>
<span>             labeller <span class="op">=</span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labeller.html" class="external-link">labeller</a></span><span class="op">(</span>ALB <span class="op">=</span> <span class="va">albumin.labs</span>,</span>
<span>                                  WT <span class="op">=</span> <span class="va">wt.labs</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_log10</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>y <span class="op">=</span> <span class="st">"Plasma~Concentrations\n(logarithmic scale)"</span>, x <span class="op">=</span> <span class="st">"Time (h)"</span><span class="op">)</span></span>
<span>  <span class="co">#labs(y = expression(Log[10]~Plasma~Concentrations), x = "Time (h)")+</span></span>
<span></span>
<span></span>
<span></span>
<span><span class="fu">egg</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/egg/man/ggarrange.html" class="external-link">ggarrange</a></span><span class="op">(</span><span class="va">p1</span>, <span class="va">p2</span>, ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="PK_Example_files/figure-html/pksimulation-1.png" width="672"></p>
</div>
<div class="section level3">
<h3 id="compute-pk-parameters-plot-and-summarize-bsv">Compute PK Parameters, Plot and Summarize BSV<a class="anchor" aria-label="anchor" href="#compute-pk-parameters-plot-and-summarize-bsv"></a>
</h3>
<p>In this section we compute the PK parameters of interest, provide a
plot of the parameters as well as of the standardized ones. We also
summarize and report the BSV as ranges of 50 and 90% of patients for
each PK parameter. Later on we might choose to include these ranges in
the <code>coveffectsplot</code> or not.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">derive.exposure</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">time</span>, <span class="va">CP</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">time</span><span class="op">)</span></span>
<span>  <span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    Cmax <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">CP</span><span class="op">)</span>,</span>
<span>    Clast <span class="op">=</span> <span class="va">CP</span><span class="op">[</span><span class="va">n</span><span class="op">]</span>,</span>
<span>    AUC <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diff.html" class="external-link">diff</a></span><span class="op">(</span><span class="va">time</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="va">CP</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="va">CP</span><span class="op">[</span><span class="op">-</span><span class="va">n</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="fu">data.table</span><span class="op">(</span>paramname<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, paramvalue<span class="op">=</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">refbsv</span> <span class="op">&lt;-</span> <span class="va">outputsim</span><span class="op">[</span>, <span class="fu">derive.exposure</span><span class="op">(</span><span class="va">time</span>, <span class="va">CP</span><span class="op">)</span>, by<span class="op">=</span><span class="fu">.</span><span class="op">(</span><span class="va">ID</span>, <span class="va">WT</span>, <span class="va">SEX</span>, <span class="va">ALB</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="va">p3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">refbsv</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span></span>
<span>        x      <span class="op">=</span> <span class="va">paramvalue</span>,</span>
<span>        y      <span class="op">=</span> <span class="va">paramname</span>,</span>
<span>        fill   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">..quantile..</span><span class="op">)</span>,</span>
<span>        height <span class="op">=</span> <span class="va">..ndensity..</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">paramname</span>, scales<span class="op">=</span><span class="st">"free"</span>, ncol<span class="op">=</span><span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">stat_density_ridges</span><span class="op">(</span></span>
<span>    geom<span class="op">=</span><span class="st">"density_ridges_gradient"</span>, calc_ecdf<span class="op">=</span><span class="cn">TRUE</span>,</span>
<span>    quantile_lines<span class="op">=</span><span class="cn">TRUE</span>, rel_min_height<span class="op">=</span><span class="fl">0.001</span>, scale<span class="op">=</span><span class="fl">0.9</span>,</span>
<span>    quantiles<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.05</span>, <span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>, <span class="fl">0.95</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span></span>
<span>    name   <span class="op">=</span> <span class="st">"Probability"</span>,</span>
<span>    values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"white"</span>, <span class="st">"#FF000050"</span>, <span class="st">"#FF0000A0"</span>, <span class="st">"#FF0000A0"</span>, <span class="st">"#FF000050"</span>, <span class="st">"white"</span><span class="op">)</span>,</span>
<span>    labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"(0, 0.05]"</span>, <span class="st">"(0.05, 0.25]"</span>,</span>
<span>               <span class="st">"(0.25, 0.5]"</span>, <span class="st">"(0.5, 0.75]"</span>,</span>
<span>               <span class="st">"(0.75, 0.95]"</span>, <span class="st">"(0.95, 1]"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span></span>
<span>    legend.position <span class="op">=</span> <span class="st">"none"</span>,</span>
<span>    axis.text.y     <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    axis.ticks.y    <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    axis.title.y    <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x<span class="op">=</span><span class="st">"PK Parameters"</span>, y<span class="op">=</span><span class="st">""</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_log10</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html" class="external-link">coord_cartesian</a></span><span class="op">(</span>expand<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Obtain the standardized parameter value by dividing by the median.</span></span>
<span><span class="va">refbsv</span><span class="op">[</span>, <span class="va">stdparamvalue</span> <span class="op">:=</span> <span class="va">paramvalue</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span><span class="op">(</span><span class="va">paramvalue</span><span class="op">)</span>, by<span class="op">=</span><span class="va">paramname</span><span class="op">]</span></span>
<span></span>
<span><span class="va">p4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">refbsv</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span></span>
<span>        x      <span class="op">=</span> <span class="va">stdparamvalue</span>,</span>
<span>        y      <span class="op">=</span> <span class="va">paramname</span>,</span>
<span>        fill   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">..quantile..</span><span class="op">)</span>,</span>
<span>        height <span class="op">=</span> <span class="va">..ndensity..</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">paramname</span>, scales<span class="op">=</span><span class="st">"free"</span>, ncol<span class="op">=</span><span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">stat_density_ridges</span><span class="op">(</span></span>
<span>    geom<span class="op">=</span><span class="st">"density_ridges_gradient"</span>, calc_ecdf<span class="op">=</span><span class="cn">TRUE</span>,</span>
<span>    quantile_lines<span class="op">=</span><span class="cn">TRUE</span>, rel_min_height<span class="op">=</span><span class="fl">0.001</span>, scale<span class="op">=</span><span class="fl">0.9</span>,</span>
<span>    quantiles<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.05</span>, <span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>, <span class="fl">0.95</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span></span>
<span>    name<span class="op">=</span><span class="st">"Probability"</span>,</span>
<span>    values<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"white"</span>, <span class="st">"#FF000050"</span>, <span class="st">"#FF0000A0"</span>, <span class="st">"#FF0000A0"</span>, <span class="st">"#FF000050"</span>, <span class="st">"white"</span><span class="op">)</span>,</span>
<span>    labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"(0, 0.05]"</span>, <span class="st">"(0.05, 0.25]"</span>,</span>
<span>             <span class="st">"(0.25, 0.5]"</span>, <span class="st">"(0.5, 0.75]"</span>,</span>
<span>             <span class="st">"(0.75, 0.95]"</span>, <span class="st">"(0.95, 1]"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span></span>
<span>    legend.position <span class="op">=</span> <span class="st">"none"</span>,</span>
<span>    axis.text.y     <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    axis.ticks.y    <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    axis.title.y    <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x<span class="op">=</span><span class="st">"Standardized PK Parameters"</span>, y<span class="op">=</span><span class="st">""</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_log10</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html" class="external-link">coord_cartesian</a></span><span class="op">(</span>expand<span class="op">=</span><span class="cn">FALSE</span>, xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.3</span>,<span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p3</span><span class="op">+</span><span class="va">p4</span></span></code></pre></div>
<p><img src="PK_Example_files/figure-html/computenca-1.png" width="672"></p>
<p><strong>Ranges of BSV for each PK Parameter:</strong></p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bsvranges</span> <span class="op">&lt;-</span> <span class="va">refbsv</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    P05 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">stdparamvalue</span>, <span class="fl">0.05</span><span class="op">)</span>,</span>
<span>    P25 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">stdparamvalue</span>, <span class="fl">0.25</span><span class="op">)</span>,</span>
<span>    P50 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">stdparamvalue</span>, <span class="fl">0.5</span><span class="op">)</span>,</span>
<span>    P75 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">stdparamvalue</span>, <span class="fl">0.75</span><span class="op">)</span>,</span>
<span>    P95 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">stdparamvalue</span>, <span class="fl">0.95</span><span class="op">)</span><span class="op">)</span>, by <span class="op">=</span> <span class="va">paramname</span><span class="op">]</span></span>
<span><span class="va">bsvranges</span></span>
<span><span class="co">#&gt;    paramname       P05       P25   P50      P75      P95</span></span>
<span><span class="co">#&gt;       &lt;char&gt;     &lt;num&gt;     &lt;num&gt; &lt;num&gt;    &lt;num&gt;    &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:      Cmax 0.7982012 0.9162689     1 1.078929 1.191273</span></span>
<span><span class="co">#&gt; 2:     Clast 0.4591170 0.7702615     1 1.264859 1.751432</span></span>
<span><span class="co">#&gt; 3:       AUC 0.7017877 0.8815325     1 1.117071 1.318266</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="generate-and-simulate-at-combinations-of-covariate-of-interest">Generate and Simulate at Combinations of Covariate of Interest<a class="anchor" aria-label="anchor" href="#generate-and-simulate-at-combinations-of-covariate-of-interest"></a>
</h2>
<p>Based on our observed covariate data, we compute percentiles of
interest that we will use to simulate data at. Common practice is to
compute the 5,25,75,95 percentiles (the median being the reference). In
some cases, we might want to explore the min, max or other extreme case
scenarios. Care should be taken as this approach might generate
unrealistic combination of covariates that can never appear in a real
patient. The utility function expand.modelframe (written by Benjamin
Rich) is defined in the setup section of the vignette and can be found
in the source code. It facilitates the creation of a set of covariate
values varying one at a time.</p>
<div class="section level3">
<h3 id="generate-a-dataset-holding-combinations-of-covariates">Generate a Dataset Holding Combinations of Covariates:<a class="anchor" aria-label="anchor" href="#generate-a-dataset-holding-combinations-of-covariates"></a>
</h3>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">reference.values</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>WT <span class="op">=</span> <span class="fl">85</span>, ALB <span class="op">=</span> <span class="fl">45</span>, SEX <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>   </span>
<span></span>
<span><span class="va">covcomb</span> <span class="op">&lt;-</span> <span class="fu">expand.modelframe</span><span class="op">(</span> <span class="co">#defined at the top and now expand_modelframe was added</span></span>
<span>  WT  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">56</span>, <span class="fl">72</span>, <span class="fl">98</span>, <span class="fl">128</span><span class="op">)</span>, <span class="co"># P05, P25, P50, P75, P95</span></span>
<span>  ALB <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">40</span>, <span class="fl">50</span><span class="op">)</span>,          <span class="co"># P05, P50, P95</span></span>
<span>  SEX <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>,               <span class="co"># Reference is for SEX=0 (female)</span></span>
<span>  rv <span class="op">=</span> <span class="va">reference.values</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Add the reference</span></span>
<span><span class="va">covcomb</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">covcomb</span>, <span class="fu">data.table</span><span class="op">(</span><span class="va">reference.values</span>, covname<span class="op">=</span><span class="st">"REF"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">covcomb</span><span class="op">$</span><span class="va">ID</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">covcomb</span><span class="op">)</span></span>
<span></span>
<span><span class="va">covcomb</span></span>
<span><span class="co">#&gt;    WT ALB SEX covname ID</span></span>
<span><span class="co">#&gt; 1  56  45   0      WT  1</span></span>
<span><span class="co">#&gt; 2  72  45   0      WT  2</span></span>
<span><span class="co">#&gt; 3  98  45   0      WT  3</span></span>
<span><span class="co">#&gt; 4 128  45   0      WT  4</span></span>
<span><span class="co">#&gt; 5  85  40   0     ALB  5</span></span>
<span><span class="co">#&gt; 6  85  50   0     ALB  6</span></span>
<span><span class="co">#&gt; 7  85  45   1     SEX  7</span></span>
<span><span class="co">#&gt; 8  85  45   0     REF  8</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="simulation-at-unique-combinations-of-covariates">Simulation at Unique Combinations of Covariates<a class="anchor" aria-label="anchor" href="#simulation-at-unique-combinations-of-covariates"></a>
</h3>
<p>As a first step, we simulate without uncertainty and without BSV
using <code>zero_re()</code> at unique combination of covariates and
provide a plot to visualize the effects.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">idata</span> <span class="op">&lt;-</span> <span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/copy.html" class="external-link">copy</a></span><span class="op">(</span><span class="va">covcomb</span><span class="op">)</span></span>
<span><span class="va">idata</span><span class="op">$</span><span class="va">covname</span> <span class="op">&lt;-</span>  <span class="cn">NULL</span></span>
<span><span class="va">ev1</span> <span class="op">&lt;-</span> <span class="fu">ev</span><span class="op">(</span>time<span class="op">=</span><span class="fl">0</span>, amt<span class="op">=</span><span class="fl">100</span>, cmt<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">data.dose</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">ev1</span><span class="op">)</span></span>
<span><span class="va">data.all</span> <span class="op">&lt;-</span> <span class="fu">data.table</span><span class="op">(</span><span class="va">idata</span>, <span class="va">data.dose</span><span class="op">)</span></span>
<span></span>
<span><span class="va">outcovcomb</span><span class="op">&lt;-</span> <span class="va">modcovsim</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">data_set</span><span class="op">(</span><span class="va">data.all</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">zero_re</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">mrgsim</span><span class="op">(</span>end<span class="op">=</span><span class="fl">24</span>, delta<span class="op">=</span><span class="fl">0.25</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="va">as.data.frame</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="va">as.data.table</span></span>
<span></span>
<span><span class="va">outcovcomb</span><span class="op">$</span><span class="va">SEX</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">outcovcomb</span><span class="op">$</span><span class="va">SEX</span>, labels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Female"</span>, <span class="st">"Male"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">albumin.labs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"albumin: 40 ng/mL"</span>,<span class="st">"albumin: 45 ng/mL"</span>,<span class="st">"albumin: 50 ng/mL"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">albumin.labs</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"40"</span>,<span class="st">"45"</span>,<span class="st">"50"</span><span class="op">)</span></span>
<span><span class="va">wt.labs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"weight: 56 kg"</span>,<span class="st">"weight: 72 kg"</span>,<span class="st">"weight: 85 kg"</span>,<span class="st">"weight: 98 kg"</span>,<span class="st">"weight: 128 kg"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">wt.labs</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"56"</span>,<span class="st">"72"</span>,<span class="st">"85"</span>,<span class="st">"98"</span>,<span class="st">"128"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pkprofiletypical</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">outcovcomb</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">time</span>, y<span class="op">=</span><span class="va">CP</span>, col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">WT</span><span class="op">)</span>, linetype<span class="op">=</span><span class="va">SEX</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>group<span class="op">=</span><span class="va">ID</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">1</span>, linewidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">facet_nested</span><span class="op">(</span><span class="va">ALB</span> <span class="op">+</span> <span class="va">SEX</span> <span class="op">~</span> <span class="va">WT</span>,</span>
<span>               labeller<span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labeller.html" class="external-link">labeller</a></span><span class="op">(</span>ALB <span class="op">=</span> <span class="va">albumin.labs</span>, WT <span class="op">=</span> <span class="va">wt.labs</span>, SEX <span class="op">=</span> <span class="va">label_value</span><span class="op">)</span>,</span>
<span>             switch <span class="op">=</span> <span class="st">"y"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    x        <span class="op">=</span> <span class="st">"Time (h)"</span>,</span>
<span>    y        <span class="op">=</span> <span class="st">"Plasma Concentrations"</span>,</span>
<span>    linetype <span class="op">=</span> <span class="st">"Sex"</span>,</span>
<span>    colour   <span class="op">=</span> <span class="st">"Weight"</span>,</span>
<span>    caption  <span class="op">=</span> <span class="st">"Simulation without Uncertainty and without BSV"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html" class="external-link">coord_cartesian</a></span><span class="op">(</span>ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">4</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pkprofiletypical</span> <span class="op">&lt;-</span> <span class="va">pkprofiletypical</span> <span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">13</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>axis.title.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">15</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>colour   <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html" class="external-link">guide_legend</a></span><span class="op">(</span>override.aes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">1</span>, linewidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>         linetype <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html" class="external-link">guide_legend</a></span><span class="op">(</span>override.aes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>linewidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>, order <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html" class="external-link">coord_cartesian</a></span><span class="op">(</span>ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">4</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">pkprofiletypical</span></span></code></pre></div>
<p><img src="PK_Example_files/figure-html/unnamed-chunk-2-1.png" width="816"></p>
</div>
</div>
<div class="section level2">
<h2 id="adding-uncertainty-from-a-varcov-matrix">Adding Uncertainty from a Varcov Matrix<a class="anchor" aria-label="anchor" href="#adding-uncertainty-from-a-varcov-matrix"></a>
</h2>
<p>First, we will invent a varcov matrix by assuming 25% relative
standard errors and correlations of 0.2 across the board. We then
simulate a 100 set of parameters using a multivariate normal (kept at
100 for the vignette, use more replicates for a real project). Also,
unless the model was written in a way to allow unconstrained parameter
values, care should be taken to make sure the simulated parameters are
valid and make sense. In a real modeling applications, the software used
to fit the model will provide a variance covariance matrix, if possible.
Otherwise, the user can rely on set of parameters generated from
bootstrap replicates or SIR run.</p>
<p><strong>Variance Covariance Matrix of fixed effects:</strong></p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">theta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">unclass</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span><span class="fu">param</span><span class="op">(</span><span class="va">modcovsim</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">theta</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"WT"</span>, <span class="st">"SEX"</span>, <span class="st">"ALB"</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span><span class="va">theta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">theta</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">theta</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;    KA CL  V Vp Qp CLALB CLSEX CLWT VSEX VWT</span></span>
<span><span class="co">#&gt; 1 0.5  4 10 50 10  -0.8   0.2    1 0.07   1</span></span>
<span></span>
<span><span class="co">#note that from RsNLME or NONMEM or Monolix the software will give you the varcov just read it it in.</span></span>
<span><span class="co"># example NONMEM  read in your run .cov</span></span>
<span><span class="co"># varcov &lt;- read.csv(paste("runxyz",".cov",sep=""), header=TRUE, skip=1, sep="")</span></span>
<span></span>
<span><span class="va">varcov</span> <span class="op">&lt;-</span> <span class="fu">cor2cov</span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0.2</span>, nrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">theta</span><span class="op">)</span>, ncol<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">theta</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  sd<span class="op">=</span><span class="va">theta</span><span class="op">*</span><span class="fl">0.25</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">varcov</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">varcov</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">theta</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">varcov</span><span class="op">)</span></span>
<span><span class="co">#&gt;               KA      CL        V        Vp       Qp  CLALB     CLSEX      CLWT</span></span>
<span><span class="co">#&gt; KA     0.0156250  0.0250  0.06250   0.31250  0.06250 -5e-03  0.001250  0.006250</span></span>
<span><span class="co">#&gt; CL     0.0250000  1.0000  0.50000   2.50000  0.50000 -4e-02  0.010000  0.050000</span></span>
<span><span class="co">#&gt; V      0.0625000  0.5000  6.25000   6.25000  1.25000 -1e-01  0.025000  0.125000</span></span>
<span><span class="co">#&gt; Vp     0.3125000  2.5000  6.25000 156.25000  6.25000 -5e-01  0.125000  0.625000</span></span>
<span><span class="co">#&gt; Qp     0.0625000  0.5000  1.25000   6.25000  6.25000 -1e-01  0.025000  0.125000</span></span>
<span><span class="co">#&gt; CLALB -0.0050000 -0.0400 -0.10000  -0.50000 -0.10000  4e-02 -0.002000 -0.010000</span></span>
<span><span class="co">#&gt; CLSEX  0.0012500  0.0100  0.02500   0.12500  0.02500 -2e-03  0.002500  0.002500</span></span>
<span><span class="co">#&gt; CLWT   0.0062500  0.0500  0.12500   0.62500  0.12500 -1e-02  0.002500  0.062500</span></span>
<span><span class="co">#&gt; VSEX   0.0004375  0.0035  0.00875   0.04375  0.00875 -7e-04  0.000175  0.000875</span></span>
<span><span class="co">#&gt; VWT    0.0062500  0.0500  0.12500   0.62500  0.12500 -1e-02  0.002500  0.012500</span></span>
<span><span class="co">#&gt;              VSEX       VWT</span></span>
<span><span class="co">#&gt; KA     0.00043750  0.006250</span></span>
<span><span class="co">#&gt; CL     0.00350000  0.050000</span></span>
<span><span class="co">#&gt; V      0.00875000  0.125000</span></span>
<span><span class="co">#&gt; Vp     0.04375000  0.625000</span></span>
<span><span class="co">#&gt; Qp     0.00875000  0.125000</span></span>
<span><span class="co">#&gt; CLALB -0.00070000 -0.010000</span></span>
<span><span class="co">#&gt; CLSEX  0.00017500  0.002500</span></span>
<span><span class="co">#&gt; CLWT   0.00087500  0.012500</span></span>
<span><span class="co">#&gt; VSEX   0.00030625  0.000875</span></span>
<span><span class="co">#&gt; VWT    0.00087500  0.062500</span></span></code></pre></div>
<div class="section level3">
<h3 id="generating-sets-of-parameters-with-uncertainty">Generating Sets of Parameters with Uncertainty<a class="anchor" aria-label="anchor" href="#generating-sets-of-parameters-with-uncertainty"></a>
</h3>
<p>Second, we generate the sim_parameters dataset using
<code>mvrnorm</code> and then incorporate the uncertainty by simulating
using a different set of parameters (row) for each replicate.</p>
<p><strong>First Few Rows of a Dataset Containing Simulated Fixed
Effects with Uncertainty:</strong></p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">678549</span><span class="op">)</span></span>
<span><span class="co"># mvtnorm::rmvnorm is another option that can be explored</span></span>
<span><span class="co"># if you have run a bootstrap just use the parameters data generated using all replicates</span></span>
<span><span class="va">sim_parameters</span> <span class="op">&lt;-</span> <span class="fu">MASS</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/MASS/man/mvrnorm.html" class="external-link">mvrnorm</a></span><span class="op">(</span><span class="va">nsim</span>, <span class="va">theta</span>, <span class="va">varcov</span>, empirical<span class="op">=</span><span class="cn">T</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="va">as.data.table</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">sim_parameters</span><span class="op">)</span></span>
<span><span class="co">#&gt;           KA       CL         V       Vp        Qp      CLALB      CLSEX</span></span>
<span><span class="co">#&gt;        &lt;num&gt;    &lt;num&gt;     &lt;num&gt;    &lt;num&gt;     &lt;num&gt;      &lt;num&gt;      &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1: 0.3525490 3.200401  7.920479 35.80060  9.154611 -0.7968278 0.14694757</span></span>
<span><span class="co">#&gt; 2: 0.5249089 3.677540  6.911500 45.37793  7.117828 -0.3630370 0.09057703</span></span>
<span><span class="co">#&gt; 3: 0.4832810 4.066721  9.170236 51.89540  8.947875 -1.0678602 0.18739863</span></span>
<span><span class="co">#&gt; 4: 0.5278150 2.346888  6.033332 44.26334  7.974338 -0.6485870 0.14966223</span></span>
<span><span class="co">#&gt; 5: 0.4710727 4.065682 10.607099 38.29416  9.425221 -0.4660593 0.30434781</span></span>
<span><span class="co">#&gt; 6: 0.7963261 5.041541 13.192930 43.99648 10.936419 -0.6903318 0.14403872</span></span>
<span><span class="co">#&gt;         CLWT       VSEX       VWT</span></span>
<span><span class="co">#&gt;        &lt;num&gt;      &lt;num&gt;     &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1: 0.4792149 0.06565644 1.0745008</span></span>
<span><span class="co">#&gt; 2: 0.8847586 0.06079893 0.3047879</span></span>
<span><span class="co">#&gt; 3: 1.1481026 0.06577778 1.1339100</span></span>
<span><span class="co">#&gt; 4: 0.6216810 0.04888023 0.7770958</span></span>
<span><span class="co">#&gt; 5: 0.8386740 0.06299953 0.8784929</span></span>
<span><span class="co">#&gt; 6: 1.0514400 0.05609656 1.1710921</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="iterative-simulations-to-apply-the-uncertainty">Iterative Simulations to Apply the Uncertainty<a class="anchor" aria-label="anchor" href="#iterative-simulations-to-apply-the-uncertainty"></a>
</h3>
<p>Third, we illustrate how you can iterate over a set of parameters
value using a <code>for</code> loop. We then overlay the previous
simulation results without uncertainty on the one with uncertainty to
visualize the effect of adding it.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">idata</span> <span class="op">&lt;-</span> <span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/copy.html" class="external-link">copy</a></span><span class="op">(</span><span class="va">covcomb</span><span class="op">)</span></span>
<span><span class="va">idata</span><span class="op">$</span><span class="va">covname</span> <span class="op">&lt;-</span>  <span class="cn">NULL</span></span>
<span><span class="va">ev1</span>       <span class="op">&lt;-</span> <span class="fu">ev</span><span class="op">(</span>time<span class="op">=</span><span class="fl">0</span>, amt<span class="op">=</span><span class="fl">100</span>, cmt<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">data.dose</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">ev1</span><span class="op">)</span></span>
<span><span class="va">iter_sims</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">nsim</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">data.all</span>  <span class="op">&lt;-</span> <span class="fu">data.table</span><span class="op">(</span><span class="va">idata</span>, <span class="va">data.dose</span>, <span class="va">sim_parameters</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">out</span> <span class="op">&lt;-</span> <span class="va">modcovsim</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu">data_set</span><span class="op">(</span><span class="va">data.all</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu">zero_re</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu">mrgsim</span><span class="op">(</span>start<span class="op">=</span><span class="fl">0</span>, end<span class="op">=</span><span class="fl">24</span>, delta<span class="op">=</span><span class="fl">0.25</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="va">as.data.frame</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="va">as.data.table</span></span>
<span>  <span class="va">out</span><span class="op">[</span>, <span class="va">rep</span> <span class="op">:=</span> <span class="va">i</span><span class="op">]</span></span>
<span>  <span class="va">iter_sims</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">iter_sims</span>, <span class="va">out</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">iter_sims</span><span class="op">$</span><span class="va">SEX</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">iter_sims</span><span class="op">$</span><span class="va">SEX</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Female"</span>, <span class="st">"Male"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">summary_conc</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">CP</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    Cmed <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span><span class="op">(</span><span class="va">CP</span><span class="op">)</span>,</span>
<span>    Clow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">CP</span>, probs <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span>,</span>
<span>    Cup <span class="op">=</span>  <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">CP</span>, probs <span class="op">=</span> <span class="fl">0.95</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="fu">data.table</span><span class="op">(</span>paramname<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, paramvalue<span class="op">=</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">iter_sims_sum</span> <span class="op">&lt;-</span> <span class="va">iter_sims</span><span class="op">[</span>, <span class="fu">summary_conc</span><span class="op">(</span><span class="va">CP</span><span class="op">)</span>, by<span class="op">=</span><span class="fu">.</span><span class="op">(</span> <span class="va">time</span>, <span class="va">WT</span>, <span class="va">SEX</span>, <span class="va">ALB</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">iter_sims_sum</span> <span class="op">&lt;-</span> <span class="fu">spread</span><span class="op">(</span><span class="va">iter_sims_sum</span>,<span class="va">paramname</span>,<span class="va">paramvalue</span><span class="op">)</span></span>
<span><span class="va">iter_sims_sum</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">iter_sims_sum</span><span class="op">)</span></span>
<span></span>
<span><span class="va">albumin.labs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"albumin: 40 ng/mL"</span>,<span class="st">"albumin: 45 ng/mL"</span>,<span class="st">"albumin: 50 ng/mL"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">albumin.labs</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"40"</span>,<span class="st">"45"</span>,<span class="st">"50"</span><span class="op">)</span></span>
<span><span class="va">wt.labs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"weight: 56 kg"</span>,<span class="st">"weight: 72 kg"</span>,<span class="st">"weight: 85 kg"</span>,<span class="st">"weight: 98 kg"</span>,<span class="st">"weight: 128 kg"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">wt.labs</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"56"</span>,<span class="st">"72"</span>,<span class="st">"85"</span>,<span class="st">"98"</span>,<span class="st">"128"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pkprofileuncertainty_sum</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">iter_sims_sum</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">time</span>, col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">WT</span><span class="op">)</span>,</span>
<span>                      fill<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">WT</span><span class="op">)</span>,</span>
<span>                      linetype<span class="op">=</span><span class="va">SEX</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>ymin<span class="op">=</span> <span class="va">`Clow.5%`</span> ,ymax<span class="op">=</span><span class="va">`Cup.95%`</span><span class="op">)</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.4</span>, linetype <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y<span class="op">=</span><span class="va">Cmed</span><span class="op">)</span>,alpha<span class="op">=</span><span class="fl">1</span> , color <span class="op">=</span><span class="st">"black"</span> , linewidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">facet_nested</span><span class="op">(</span><span class="va">ALB</span> <span class="op">+</span><span class="va">SEX</span> <span class="op">~</span> <span class="va">WT</span>,</span>
<span>             labeller<span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labeller.html" class="external-link">labeller</a></span><span class="op">(</span>ALB <span class="op">=</span> <span class="va">albumin.labs</span>,</span>
<span>                                WT <span class="op">=</span> <span class="va">wt.labs</span>,</span>
<span>                                SEX <span class="op">=</span> <span class="va">label_value</span><span class="op">)</span>,switch <span class="op">=</span> <span class="st">"y"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    x        <span class="op">=</span> <span class="st">"Time (h)"</span>,</span>
<span>    y        <span class="op">=</span> <span class="st">"Plasma Concentrations"</span>,</span>
<span>    linetype <span class="op">=</span> <span class="st">"Sex"</span>,</span>
<span>    colour   <span class="op">=</span> <span class="st">"Uncertainty\n5-95%\nWeight"</span>,</span>
<span>    fill   <span class="op">=</span> <span class="st">"Uncertainty\n5-95%\nWeight"</span>,</span>
<span>    caption  <span class="op">=</span> <span class="st">"Simulation with Uncertainty, without BSV"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">13</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>axis.title.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">15</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>fill     <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html" class="external-link">guide_legend</a></span><span class="op">(</span>override.aes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.4</span>, size <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span><span class="op">)</span>,</span>
<span>         linetype <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html" class="external-link">guide_legend</a></span><span class="op">(</span>override.aes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>linewidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>, order <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html" class="external-link">coord_cartesian</a></span><span class="op">(</span>ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">4</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pkprofileuncertainty_sum</span></span></code></pre></div>
<p><img src="PK_Example_files/figure-html/unnamed-chunk-5-1.png" width="816"></p>
</div>
<div class="section level3">
<h3 id="compute-pk-parameters-and-boxplots">Compute PK Parameters and Boxplots<a class="anchor" aria-label="anchor" href="#compute-pk-parameters-and-boxplots"></a>
</h3>
<p>Similar to an earlier section, we compute the PK parameters by
patient and by replicate standardize by the computed median for
reference subject and provide a plot. We add some data manipulation to
construct more informative labels that will help in the plotting.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">out.df.univariatecov.nca</span> <span class="op">&lt;-</span> <span class="va">iter_sims</span><span class="op">[</span>, <span class="fu">derive.exposure</span><span class="op">(</span><span class="va">time</span>, <span class="va">CP</span><span class="op">)</span>, by<span class="op">=</span><span class="fu">.</span><span class="op">(</span><span class="va">rep</span>, <span class="va">ID</span>, <span class="va">WT</span>, <span class="va">SEX</span>, <span class="va">ALB</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="va">refvalues</span> <span class="op">&lt;-</span> <span class="va">out.df.univariatecov.nca</span><span class="op">[</span></span>
<span>  <span class="va">ALB</span><span class="op">==</span><span class="fl">45</span> <span class="op">&amp;</span> <span class="va">WT</span><span class="op">==</span><span class="fl">85</span> <span class="op">&amp;</span> <span class="va">SEX</span><span class="op">==</span><span class="st">"Female"</span>,</span>
<span>  <span class="fu">.</span><span class="op">(</span>medparam <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span><span class="op">(</span><span class="va">paramvalue</span><span class="op">)</span><span class="op">)</span>, by<span class="op">=</span> <span class="fu">.</span><span class="op">(</span><span class="va">rep</span>,<span class="va">paramname</span><span class="op">)</span> <span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">refvalues</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;   rep paramname   medparam</span></span>
<span><span class="co">#&gt; 1   1      Cmax  2.0237077</span></span>
<span><span class="co">#&gt; 2   1     Clast  0.4285660</span></span>
<span><span class="co">#&gt; 3   1       AUC 23.9392632</span></span>
<span><span class="co">#&gt; 4   2      Cmax  2.8913245</span></span>
<span><span class="co">#&gt; 5   2     Clast  0.3178367</span></span>
<span><span class="co">#&gt; 6   2       AUC 20.7979014</span></span></code></pre></div>
<p><strong>Median Parameter Values for the Reference:</strong></p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">covcomb</span><span class="op">$</span><span class="va">covvalue</span><span class="op">[</span><span class="va">covcomb</span><span class="op">$</span><span class="va">covname</span><span class="op">==</span><span class="st">"WT"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">covcomb</span><span class="op">$</span><span class="va">WT</span><span class="op">[</span><span class="va">covcomb</span><span class="op">$</span><span class="va">covname</span><span class="op">==</span><span class="st">"WT"</span><span class="op">]</span>,<span class="st">"kg"</span><span class="op">)</span></span>
<span><span class="va">covcomb</span><span class="op">$</span><span class="va">covvalue</span><span class="op">[</span><span class="va">covcomb</span><span class="op">$</span><span class="va">covname</span><span class="op">==</span><span class="st">"ALB"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">covcomb</span><span class="op">$</span><span class="va">ALB</span><span class="op">[</span><span class="va">covcomb</span><span class="op">$</span><span class="va">covname</span><span class="op">==</span><span class="st">"ALB"</span><span class="op">]</span>,<span class="st">"g/L"</span><span class="op">)</span>                   </span>
<span><span class="va">covcomb</span><span class="op">$</span><span class="va">covvalue</span><span class="op">[</span><span class="va">covcomb</span><span class="op">$</span><span class="va">covname</span><span class="op">==</span><span class="st">"SEX"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"Male"</span></span>
<span><span class="va">covcomb</span><span class="op">$</span><span class="va">covvalue</span><span class="op">[</span><span class="va">covcomb</span><span class="op">$</span><span class="va">covname</span><span class="op">==</span><span class="st">"REF"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"85 kg\nFemale\n45 g/L"</span></span>
<span><span class="co">#covcomb[covname=="REF", covvalue := "85 kg Female 45 g/L"]</span></span>
<span><span class="va">covcomb</span> <span class="op">&lt;-</span> <span class="fu">as.data.table</span><span class="op">(</span><span class="va">covcomb</span><span class="op">)</span></span>
<span></span>
<span><span class="va">out.df.univariatecov.nca</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span></span>
<span>  <span class="va">out.df.univariatecov.nca</span>,</span>
<span>  <span class="va">covcomb</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">ID</span>, <span class="va">covname</span>, <span class="va">covvalue</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">setkey</span><span class="op">(</span><span class="va">out.df.univariatecov.nca</span>, <span class="va">paramname</span>,<span class="va">rep</span><span class="op">)</span></span>
<span></span>
<span><span class="va">out.df.univariatecov.nca</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span></span>
<span>  <span class="va">out.df.univariatecov.nca</span>,</span>
<span>  <span class="va">refvalues</span><span class="op">)</span></span>
<span></span>
<span><span class="va">out.df.univariatecov.nca</span><span class="op">[</span>, <span class="va">paramvaluestd</span> <span class="op">:=</span> <span class="va">paramvalue</span><span class="op">/</span><span class="va">medparam</span><span class="op">]</span></span>
<span></span>
<span></span>
<span><span class="va">boxplotdat</span> <span class="op">&lt;-</span> <span class="va">out.df.univariatecov.nca</span><span class="op">[</span><span class="va">covname</span><span class="op">!=</span><span class="st">"REF"</span><span class="op">]</span></span>
<span><span class="va">boxplotdat</span><span class="op">[</span><span class="va">covname</span><span class="op">==</span><span class="st">"WT"</span>,  <span class="va">covname2</span> <span class="op">:=</span> <span class="st">"Weight"</span><span class="op">]</span></span>
<span><span class="va">boxplotdat</span><span class="op">[</span><span class="va">covname</span><span class="op">==</span><span class="st">"ALB"</span>, <span class="va">covname2</span> <span class="op">:=</span> <span class="st">"Albumin"</span><span class="op">]</span></span>
<span><span class="va">boxplotdat</span><span class="op">[</span><span class="va">covname</span><span class="op">==</span><span class="st">"SEX"</span>, <span class="va">covname2</span> <span class="op">:=</span> <span class="st">"Sex"</span><span class="op">]</span></span>
<span></span>
<span><span class="va">boxplotdatREFWT</span> <span class="op">&lt;-</span> <span class="va">out.df.univariatecov.nca</span><span class="op">[</span><span class="va">covname</span><span class="op">==</span><span class="st">"REF"</span><span class="op">]</span></span>
<span><span class="va">boxplotdatREFWT</span><span class="op">[</span>, <span class="va">covname2</span> <span class="op">:=</span> <span class="st">"Weight"</span><span class="op">]</span></span>
<span><span class="va">boxplotdatREFWT</span><span class="op">[</span>, <span class="va">covvalue</span> <span class="op">:=</span> <span class="va">covcomb</span><span class="op">[</span><span class="va">covname</span><span class="op">==</span><span class="st">"REF"</span>, <span class="va">covvalue</span><span class="op">]</span><span class="op">]</span></span>
<span></span>
<span><span class="va">boxplotdatREFSEX</span> <span class="op">&lt;-</span> <span class="va">out.df.univariatecov.nca</span><span class="op">[</span><span class="va">covname</span><span class="op">==</span><span class="st">"REF"</span><span class="op">]</span></span>
<span><span class="va">boxplotdatREFSEX</span><span class="op">[</span>, <span class="va">covname2</span> <span class="op">:=</span> <span class="st">"Sex"</span><span class="op">]</span></span>
<span><span class="va">boxplotdatREFSEX</span><span class="op">[</span>, <span class="va">covvalue</span> <span class="op">:=</span> <span class="va">covcomb</span><span class="op">[</span><span class="va">covname</span><span class="op">==</span><span class="st">"REF"</span>, <span class="va">covvalue</span><span class="op">]</span><span class="op">]</span></span>
<span></span>
<span><span class="va">boxplotdatREFALB</span> <span class="op">&lt;-</span> <span class="va">out.df.univariatecov.nca</span><span class="op">[</span><span class="va">covname</span><span class="op">==</span><span class="st">"REF"</span><span class="op">]</span></span>
<span><span class="va">boxplotdatREFALB</span><span class="op">[</span>, <span class="va">covname2</span> <span class="op">:=</span> <span class="st">"Albumin"</span><span class="op">]</span></span>
<span><span class="va">boxplotdatREFALB</span><span class="op">[</span>, <span class="va">covvalue</span> <span class="op">:=</span> <span class="va">covcomb</span><span class="op">[</span><span class="va">covname</span><span class="op">==</span><span class="st">"REF"</span>, <span class="va">covvalue</span><span class="op">]</span><span class="op">]</span></span>
<span></span>
<span><span class="va">boxplotdat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span></span>
<span>  <span class="va">boxplotdat</span>,</span>
<span>  <span class="va">boxplotdatREFWT</span>,</span>
<span>  <span class="va">boxplotdatREFSEX</span>,</span>
<span>  <span class="va">boxplotdatREFALB</span><span class="op">)</span></span>
<span></span>
<span><span class="va">boxplotdat</span><span class="op">[</span><span class="va">paramname</span><span class="op">==</span><span class="st">"AUC"</span>,   <span class="va">paramname2</span> <span class="op">:=</span> <span class="st">"AUC"</span><span class="op">]</span></span>
<span><span class="va">boxplotdat</span><span class="op">[</span><span class="va">paramname</span><span class="op">==</span><span class="st">"Clast"</span>, <span class="va">paramname2</span> <span class="op">:=</span> <span class="st">"C[last]"</span><span class="op">]</span></span>
<span><span class="va">boxplotdat</span><span class="op">[</span><span class="va">paramname</span><span class="op">==</span><span class="st">"Cmax"</span>,  <span class="va">paramname2</span> <span class="op">:=</span> <span class="st">"C[max]"</span><span class="op">]</span></span>
<span></span>
<span><span class="va">boxplotdat</span><span class="op">[</span>, <span class="va">covname2</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">covname2</span>, levels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">covname2</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="co">#boxplotdat[, covvalue := factor(covvalue, levels=unique(covvalue))]</span></span>
<span><span class="va">boxplotdat</span><span class="op">[</span>, <span class="va">covvalue</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">covvalue</span>,</span>
<span>  levels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"56 kg"</span>, <span class="st">"72 kg"</span>, <span class="st">"40 g/L"</span>, <span class="st">"Male"</span>, <span class="st">"85 kg\nFemale\n45 g/L"</span>, <span class="st">"98 kg"</span>, <span class="st">"128 kg"</span>, <span class="st">"50 g/L"</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="va">pkparametersboxplot</span><span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">boxplotdat</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">covvalue</span>, y<span class="op">=</span><span class="va">paramvalue</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span><span class="va">paramname2</span> <span class="op">~</span> <span class="va">covname2</span>, scales<span class="op">=</span><span class="st">"free"</span>, labeller<span class="op">=</span><span class="va">label_parsed</span>,</span>
<span>             switch<span class="op">=</span><span class="st">"both"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html" class="external-link">geom_boxplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>y<span class="op">=</span><span class="st">"Parameter Values"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>axis.title<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        strip.placement <span class="op">=</span> <span class="st">"outside"</span><span class="op">)</span></span>
<span><span class="va">pkparametersboxplot</span></span></code></pre></div>
<p><img src="PK_Example_files/figure-html/unnamed-chunk-7-1.png" width="672"></p>
</div>
</div>
<div class="section level2">
<h2 id="alternative-view-of-the-data-distributions-and-intervals">Alternative View of the Data: Distributions and Intervals<a class="anchor" aria-label="anchor" href="#alternative-view-of-the-data-distributions-and-intervals"></a>
</h2>
<p>Here we provide an alternative visual summary of the standardized PK
parameters. It shows the distribution, quantiles of interest. It
isolates each covariate effects in one panel keeping the reference on
its own. It is exactly the same data as the boxplots. Which visual
presentation do you prefer? Which one enables you to clearly see and
compare the covariate effects?</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">out.df.univariatecov.nca</span><span class="op">[</span><span class="va">covname</span><span class="op">==</span><span class="st">"WT"</span>,      <span class="va">covname2</span> <span class="op">:=</span> <span class="st">"Weight"</span><span class="op">]</span></span>
<span><span class="va">out.df.univariatecov.nca</span><span class="op">[</span><span class="va">covname</span><span class="op">==</span><span class="st">"ALB"</span>,     <span class="va">covname2</span> <span class="op">:=</span> <span class="st">"Albumin"</span><span class="op">]</span></span>
<span><span class="va">out.df.univariatecov.nca</span><span class="op">[</span><span class="va">covname</span><span class="op">==</span><span class="st">"SEX"</span>,     <span class="va">covname2</span> <span class="op">:=</span> <span class="st">"Sex"</span><span class="op">]</span></span>
<span><span class="va">out.df.univariatecov.nca</span><span class="op">[</span><span class="va">covname</span><span class="op">==</span><span class="st">"REF"</span>,     <span class="va">covname2</span> <span class="op">:=</span> <span class="st">"Reference"</span><span class="op">]</span></span>
<span><span class="va">out.df.univariatecov.nca</span><span class="op">[</span><span class="va">paramname</span><span class="op">==</span><span class="st">"AUC"</span>,   <span class="va">paramname2</span> <span class="op">:=</span> <span class="st">"AUC"</span><span class="op">]</span></span>
<span><span class="va">out.df.univariatecov.nca</span><span class="op">[</span><span class="va">paramname</span><span class="op">==</span><span class="st">"Clast"</span>, <span class="va">paramname2</span> <span class="op">:=</span> <span class="st">"C[last]"</span><span class="op">]</span></span>
<span><span class="va">out.df.univariatecov.nca</span><span class="op">[</span><span class="va">paramname</span><span class="op">==</span><span class="st">"Cmax"</span>,  <span class="va">paramname2</span> <span class="op">:=</span> <span class="st">"C[max]"</span><span class="op">]</span></span>
<span></span>
<span><span class="va">out.df.univariatecov.nca</span><span class="op">[</span>, <span class="va">covvalue</span>   <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">covvalue</span>, levels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">covvalue</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">out.df.univariatecov.nca</span><span class="op">[</span>, <span class="va">covname2</span>   <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">covname2</span>, levels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">covname2</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">out.df.univariatecov.nca</span><span class="op">[</span>, <span class="va">paramname2</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">paramname2</span>, levels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">paramname2</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">out.df.univariatecov.nca</span><span class="op">[</span><span class="va">out.df.univariatecov.nca</span><span class="op">$</span><span class="va">covname</span><span class="op">!=</span><span class="st">"REF"</span>,<span class="op">]</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span></span>
<span>    x      <span class="op">=</span> <span class="va">paramvaluestd</span>,</span>
<span>    y      <span class="op">=</span> <span class="va">covvalue</span>,</span>
<span>    fill   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">..quantile..</span><span class="op">)</span>,</span>
<span>    height <span class="op">=</span> <span class="va">..ndensity..</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span><span class="va">covname2</span> <span class="op">~</span> <span class="va">paramname2</span>,</span>
<span>    scales   <span class="op">=</span> <span class="st">"free_y"</span>,</span>
<span>    space    <span class="op">=</span> <span class="st">"free"</span>,</span>
<span>    labeller <span class="op">=</span> <span class="va">label_parsed</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html" class="external-link">annotate</a></span><span class="op">(</span><span class="st">"rect"</span>,</span>
<span>    xmin  <span class="op">=</span> <span class="fl">0.8</span>,</span>
<span>    xmax  <span class="op">=</span> <span class="fl">1.25</span>,</span>
<span>    ymin  <span class="op">=</span> <span class="op">-</span><span class="cn">Inf</span>,</span>
<span>    ymax  <span class="op">=</span> <span class="cn">Inf</span>,</span>
<span>    fill  <span class="op">=</span> <span class="st">"gray"</span>,</span>
<span>    alpha <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">stat_density_ridges</span><span class="op">(</span></span>
<span>    geom           <span class="op">=</span> <span class="st">"density_ridges_gradient"</span>,</span>
<span>    calc_ecdf      <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    quantile_lines <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    rel_min_height <span class="op">=</span> <span class="fl">0.001</span>,</span>
<span>    scale          <span class="op">=</span> <span class="fl">0.9</span>,</span>
<span>    quantiles      <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.05</span>,<span class="fl">0.5</span>, <span class="fl">0.95</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span></span>
<span>    breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.8</span>, <span class="fl">1</span><span class="op">/</span><span class="fl">0.8</span>, <span class="fl">1</span><span class="op">/</span><span class="fl">0.5</span>, <span class="fl">1</span><span class="op">/</span><span class="fl">0.25</span><span class="op">)</span>,</span>
<span>    trans  <span class="op">=</span> <span class="st">"log"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span></span>
<span>    name   <span class="op">=</span> <span class="st">"Probability"</span>,</span>
<span>    values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"white"</span>, <span class="st">"#0000FFA0"</span>, <span class="st">"#0000FFA0"</span>, <span class="st">"white"</span><span class="op">)</span>,</span>
<span>    labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"(0, 0.05]"</span>, <span class="st">"(0.05, 0.5]"</span>,<span class="st">"(0.5, 0.95]"</span>, <span class="st">"(0.95, 1]"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>xintercept<span class="op">=</span><span class="fl">1</span><span class="op">)</span>, size<span class="op">=</span><span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x<span class="op">=</span><span class="st">"Effects Relative to Parameter Reference Value"</span>, y<span class="op">=</span><span class="st">""</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>breaks<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.25</span>,<span class="fl">0.5</span>,<span class="fl">0.8</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">/</span><span class="fl">0.8</span>,<span class="fl">1</span><span class="op">/</span><span class="fl">0.5</span>,<span class="fl">1</span><span class="op">/</span><span class="fl">0.25</span><span class="op">)</span>,</span>
<span>                     labels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"1/4"</span>,<span class="st">"1/2"</span>,<span class="st">"0.8"</span>,<span class="st">"1"</span>,<span class="st">"1.25"</span>,<span class="st">"2"</span>,<span class="st">"4"</span><span class="op">)</span>,</span>
<span>                     trans <span class="op">=</span><span class="st">"log"</span> <span class="op">)</span></span></code></pre></div>
<p><img src="PK_Example_files/figure-html/unnamed-chunk-8-1.png" width="672"></p>
</div>
<div class="section level2">
<h2 id="adding-the-bsv-ranges-and-putting-it-all-together-using-forest_plot">Adding the BSV Ranges and Putting it all Together Using
<code>forest_plot</code><a class="anchor" aria-label="anchor" href="#adding-the-bsv-ranges-and-putting-it-all-together-using-forest_plot"></a>
</h2>
<p>To contrast the covariate effects with random unexplained variability
we add to the data the BSV intervals computed in an earlier section. We
then do some data manipulation and formatting to produce a plot from the
package function <code>forest_plot</code>. To simplify we will only keep
AUC before revisiting more than one parameter plots at the end. The user
can also compute an show the BSV for all presented effects not just for
the reference. Refer to the approach that incorporate BSV and full
covariate distributions presented in another vignette.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fpdata</span> <span class="op">&lt;-</span> <span class="va">out.df.univariatecov.nca</span><span class="op">[</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/setNames.html" class="external-link">setNames</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">paramvaluestd</span>, probs<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">0.05</span>, <span class="fl">0.95</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mid"</span>, <span class="st">"lower"</span>, <span class="st">"upper"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  by<span class="op">=</span><span class="fu">.</span><span class="op">(</span><span class="va">paramname2</span>, <span class="va">covname2</span>, <span class="va">covvalue</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="va">bsvranges</span><span class="op">[</span><span class="va">paramname</span><span class="op">==</span><span class="st">"AUC"</span>,   <span class="va">paramname2</span> <span class="op">:=</span> <span class="st">"AUC"</span><span class="op">]</span></span>
<span><span class="va">bsvranges</span><span class="op">[</span><span class="va">paramname</span><span class="op">==</span><span class="st">"Clast"</span>, <span class="va">paramname2</span> <span class="op">:=</span> <span class="st">"C[last]"</span><span class="op">]</span></span>
<span><span class="va">bsvranges</span><span class="op">[</span><span class="va">paramname</span><span class="op">==</span><span class="st">"Cmax"</span>,  <span class="va">paramname2</span> <span class="op">:=</span> <span class="st">"C[max]"</span><span class="op">]</span></span>
<span><span class="fu">setkey</span><span class="op">(</span><span class="va">bsvranges</span>, <span class="va">paramname2</span><span class="op">)</span></span>
<span></span>
<span><span class="va">fpdataBSV50</span> <span class="op">&lt;-</span> <span class="va">fpdata</span><span class="op">[</span><span class="va">covname2</span> <span class="op">==</span> <span class="st">"Reference"</span><span class="op">]</span></span>
<span><span class="va">fpdataBSV50</span><span class="op">$</span><span class="va">covname2</span> <span class="op">&lt;-</span> <span class="st">"BSV"</span></span>
<span><span class="va">fpdataBSV50</span><span class="op">$</span><span class="va">covvalue</span> <span class="op">&lt;-</span> <span class="st">"50% of patients"</span></span>
<span><span class="fu">setkey</span><span class="op">(</span><span class="va">fpdataBSV50</span>, <span class="va">paramname2</span><span class="op">)</span></span>
<span></span>
<span><span class="va">fpdataBSV50</span><span class="op">$</span><span class="va">lower</span>    <span class="op">&lt;-</span> <span class="va">bsvranges</span><span class="op">[</span>,<span class="st">"P25"</span><span class="op">]</span></span>
<span><span class="va">fpdataBSV50</span><span class="op">$</span><span class="va">upper</span>    <span class="op">&lt;-</span> <span class="va">bsvranges</span><span class="op">[</span>,<span class="st">"P75"</span><span class="op">]</span></span>
<span></span>
<span><span class="va">fpdataBSV90</span> <span class="op">&lt;-</span> <span class="va">fpdata</span><span class="op">[</span><span class="va">covname2</span> <span class="op">==</span> <span class="st">"Reference"</span><span class="op">]</span></span>
<span><span class="va">fpdataBSV90</span><span class="op">$</span><span class="va">covname2</span> <span class="op">&lt;-</span> <span class="st">"BSV"</span></span>
<span><span class="va">fpdataBSV90</span><span class="op">$</span><span class="va">covvalue</span> <span class="op">&lt;-</span> <span class="st">"90% of patients"</span></span>
<span><span class="fu">setkey</span><span class="op">(</span><span class="va">fpdataBSV90</span>, <span class="va">paramname2</span><span class="op">)</span></span>
<span></span>
<span><span class="va">fpdataBSV90</span><span class="op">$</span><span class="va">lower</span>    <span class="op">&lt;-</span> <span class="va">bsvranges</span><span class="op">[</span>,<span class="st">"P05"</span><span class="op">]</span></span>
<span><span class="va">fpdataBSV90</span><span class="op">$</span><span class="va">upper</span>    <span class="op">&lt;-</span> <span class="va">bsvranges</span><span class="op">[</span>,<span class="st">"P95"</span><span class="op">]</span></span>
<span></span>
<span><span class="va">fpdata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">fpdata</span>, <span class="va">fpdataBSV90</span>, <span class="va">fpdataBSV50</span><span class="op">)</span></span>
<span></span>
<span><span class="va">fpdata</span><span class="op">[</span>, <span class="va">LABEL</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"%s [%s, %s]"</span>,</span>
<span>  <span class="fu">round_pad</span><span class="op">(</span><span class="va">mid</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>  <span class="fu">round_pad</span><span class="op">(</span><span class="va">lower</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>  <span class="fu">round_pad</span><span class="op">(</span><span class="va">upper</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op">]</span></span>
<span></span>
<span><span class="fu">setnames</span><span class="op">(</span><span class="va">fpdata</span>, <span class="st">"paramname2"</span>, <span class="st">"paramname"</span><span class="op">)</span></span>
<span><span class="fu">setnames</span><span class="op">(</span><span class="va">fpdata</span>, <span class="st">"covname2"</span>, <span class="st">"covname"</span><span class="op">)</span></span>
<span><span class="fu">setnames</span><span class="op">(</span><span class="va">fpdata</span>, <span class="st">"covvalue"</span>, <span class="st">"label"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">fpdata</span><span class="op">[</span>, <span class="va">label</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">label</span>, levels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">label</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="va">interval_legend_text</span> <span class="op">&lt;-</span> <span class="st">"Median (points)\n90% CI (horizontal lines)"</span></span>
<span><span class="va">interval_bsv_text</span>    <span class="op">&lt;-</span> <span class="st">"BSV (points)\nPrediction Intervals (horizontal lines)"</span></span>
<span><span class="va">ref_legend_text</span>      <span class="op">&lt;-</span> <span class="st">"Reference (vertical line)\nClinically relevant limits\n(gray area)"</span></span>
<span><span class="va">area_legend_text</span>     <span class="op">&lt;-</span> <span class="st">"Reference (vertical line)\nClinically relevant limits\n(gray area)"</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/grDevices/png.html" class="external-link">png</a></span><span class="op">(</span><span class="st">"./Figure4_6.png"</span>,width <span class="op">=</span><span class="fl">9</span> ,height <span class="op">=</span> <span class="fl">6</span>,units <span class="op">=</span> <span class="st">"in"</span>,res<span class="op">=</span><span class="fl">72</span><span class="op">)</span></span>
<span><span class="fu">coveffectsplot</span><span class="fu">::</span><span class="fu"><a href="../reference/forest_plot.html">forest_plot</a></span><span class="op">(</span><span class="va">fpdata</span><span class="op">[</span><span class="va">paramname</span><span class="op">==</span><span class="st">"AUC"</span> <span class="op">&amp;</span> </span>
<span>                                     <span class="va">covname</span><span class="op">!=</span><span class="st">"Reference"</span>,<span class="op">]</span>,</span>
<span>                            ref_area               <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.8</span>, <span class="fl">1</span><span class="op">/</span><span class="fl">0.8</span><span class="op">)</span>,</span>
<span>                            x_range                <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>                            strip_placement        <span class="op">=</span> <span class="st">"inside"</span>,</span>
<span>                            base_size              <span class="op">=</span> <span class="fl">18</span>,</span>
<span>                            y_label_text_size      <span class="op">=</span> <span class="fl">12</span>,</span>
<span>                            y_facet_text_angle     <span class="op">=</span> <span class="fl">0</span>,</span>
<span>                            xlabel                 <span class="op">=</span> <span class="st">"Fold Change Relative to Reference"</span>,</span>
<span>                            ref_legend_text        <span class="op">=</span> <span class="va">ref_legend_text</span>,</span>
<span>                            area_legend_text       <span class="op">=</span> <span class="va">area_legend_text</span>,</span>
<span>                            interval_legend_text   <span class="op">=</span> <span class="va">interval_legend_text</span>,</span>
<span>                            interval_bsv_text      <span class="op">=</span> <span class="va">interval_bsv_text</span>,</span>
<span>                            plot_title             <span class="op">=</span> <span class="st">""</span>,</span>
<span>                            facet_formula          <span class="op">=</span> <span class="st">"covname ~ paramname"</span>,</span>
<span>                            facet_switch           <span class="op">=</span> <span class="st">"y"</span>,</span>
<span>                            facet_scales           <span class="op">=</span> <span class="st">"free_y"</span>,</span>
<span>                            facet_space            <span class="op">=</span> <span class="st">"free"</span>,</span>
<span>                            paramname_shape        <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                            legend_order <span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"pointinterval"</span>,<span class="st">"ref"</span>, <span class="st">"area"</span><span class="op">)</span>,</span>
<span>                            table_position         <span class="op">=</span> <span class="st">"right"</span>,</span>
<span>                            table_text_size        <span class="op">=</span> <span class="fl">4</span>,</span>
<span>                            plot_table_ratio       <span class="op">=</span> <span class="fl">3</span>,</span>
<span>                            show_table_facet_strip <span class="op">=</span> <span class="st">"none"</span>,</span>
<span>                            logxscale              <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                            major_x_ticks          <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">0.8</span>,<span class="fl">1</span>, <span class="fl">1</span><span class="op">/</span><span class="fl">0.8</span>, <span class="fl">1</span><span class="op">/</span><span class="fl">0.5</span><span class="op">)</span>,</span>
<span>                            major_x_labels         <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"1/2"</span>, <span class="st">"0.8"</span>,<span class="st">"1"</span>, <span class="st">"1.25"</span>, <span class="st">"2"</span><span class="op">)</span>,</span>
<span>                            return_list            <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html" class="external-link">dev.off</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; png </span></span>
<span><span class="co">#&gt;   2</span></span></code></pre></div>
<div class="float">
<img src="Figure4_6.png" alt="Covariate Effects Plot With BSV."><div class="figcaption">Covariate Effects Plot With BSV.</div>
</div>
</div>
<div class="section level2">
<h2 id="customization-of-the-plots">Customization of the Plots<a class="anchor" aria-label="anchor" href="#customization-of-the-plots"></a>
</h2>
<p>In this section, we first show a <code>forest_plot</code> built-in
theme, then how you return the ggplot objects as a list for further
editing using regular â€˜ggplot2â€™ code.</p>
<div class="section level3">
<h3 id="using-theme_benrich-along-additional-options">Using <code>theme_benrich</code> along Additional Options<a class="anchor" aria-label="anchor" href="#using-theme_benrich-along-additional-options"></a>
</h3>
<p>This is achieved by setting <code>theme_benrich = TRUE</code>,
specifying that you want no legend
<code>legend_position = "none"</code>.<br>
With this theme active you can also control the <code>table_title</code>
text and <code>table_title_size</code> arguments.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/grDevices/png.html" class="external-link">png</a></span><span class="op">(</span><span class="st">"./coveffectsplot4.png"</span>,width <span class="op">=</span><span class="fl">9</span> ,height <span class="op">=</span> <span class="fl">6</span>,units <span class="op">=</span> <span class="st">"in"</span>,res<span class="op">=</span><span class="fl">72</span><span class="op">)</span></span>
<span><span class="fu">coveffectsplot</span><span class="fu">::</span><span class="fu"><a href="../reference/forest_plot.html">forest_plot</a></span><span class="op">(</span><span class="va">fpdata</span><span class="op">[</span><span class="va">paramname</span><span class="op">==</span><span class="st">"AUC"</span><span class="op">]</span>,</span>
<span>                            ref_area <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.8</span>, <span class="fl">1</span><span class="op">/</span><span class="fl">0.8</span><span class="op">)</span>,</span>
<span>                            x_range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>,<span class="fl">2</span><span class="op">)</span>,</span>
<span>                            xlabel <span class="op">=</span> <span class="st">"Fold Change Relative to Reference"</span>,</span>
<span>                            x_label_text_size<span class="op">=</span> <span class="fl">10</span>,</span>
<span>                            y_facet_text_angle     <span class="op">=</span> <span class="fl">0</span>,</span>
<span>                            facet_formula <span class="op">=</span> <span class="st">"covname~paramname"</span>,</span>
<span>                            theme_benrich <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                            table_title_size <span class="op">=</span> <span class="fl">15</span>,</span>
<span>                            table_title <span class="op">=</span> <span class="st">"Median [90% CI]"</span>,</span>
<span>                            interval_legend_text <span class="op">=</span> <span class="va">interval_legend_text</span>,</span>
<span>                            interval_bsv_text <span class="op">=</span> <span class="va">interval_bsv_text</span>,</span>
<span>                            legend_position <span class="op">=</span> <span class="st">"none"</span>,</span>
<span>                            strip_placement <span class="op">=</span> <span class="st">"outside"</span>,</span>
<span>                            base_size <span class="op">=</span> <span class="fl">12</span>,</span>
<span>                            facet_switch <span class="op">=</span> <span class="st">"y"</span>,</span>
<span>                            facet_scales <span class="op">=</span> <span class="st">"free_y"</span>,</span>
<span>                            facet_space <span class="op">=</span> <span class="st">"free"</span>,</span>
<span>                            paramname_shape <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                            table_position <span class="op">=</span> <span class="st">"right"</span>,</span>
<span>                            table_text_size<span class="op">=</span><span class="fl">4</span>,</span>
<span>                            plot_table_ratio <span class="op">=</span> <span class="fl">3</span>,</span>
<span>                            show_table_facet_strip <span class="op">=</span> <span class="st">"none"</span>,</span>
<span>                            logxscale <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                            major_x_ticks <span class="op">=</span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.25</span>,<span class="fl">0.5</span>,<span class="fl">0.8</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">/</span><span class="fl">0.8</span>,<span class="fl">1</span><span class="op">/</span><span class="fl">0.5</span>,<span class="fl">1</span><span class="op">/</span><span class="fl">0.25</span><span class="op">)</span>,</span>
<span>                            major_x_labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"1/4"</span>,<span class="st">"1/2"</span>,<span class="st">"0.8"</span>,<span class="st">"1"</span>,<span class="st">"1.25"</span>,<span class="st">"2"</span>,<span class="st">"4"</span><span class="op">)</span>,</span>
<span>                            return_list <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html" class="external-link">dev.off</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; png </span></span>
<span><span class="co">#&gt;   2</span></span></code></pre></div>
<div class="float">
<img src="coveffectsplot4.png" alt="Covariate Effects Plot Theme Ben Rich."><div class="figcaption">Covariate Effects Plot Theme Ben Rich.</div>
</div>
</div>
<div class="section level3">
<h3 id="returning-a-list-of-ggplots">Returning a List of ggplots<a class="anchor" aria-label="anchor" href="#returning-a-list-of-ggplots"></a>
</h3>
<p>You can get the underlying ggplots as a list for further editing by
setting <code>return_list = TRUE</code> and saving it into an object.
The list will contain two objects the first being the main plot and the
second the table. We illustrate how you can modify the look of the plots
using regular ggplot code that modify the facet text color to
<code>gray</code> and italic. Finally we recombine the plots using
<code><a href="https://rdrr.io/pkg/egg/man/ggarrange.html" class="external-link">egg::ggarrange</a></code>.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/grDevices/png.html" class="external-link">png</a></span><span class="op">(</span><span class="st">"./coveffectsplot0.png"</span>,width <span class="op">=</span> <span class="fl">9</span> ,height <span class="op">=</span> <span class="fl">6</span>,units <span class="op">=</span> <span class="st">"in"</span>,res<span class="op">=</span><span class="fl">72</span><span class="op">)</span></span>
<span><span class="va">plotlists</span> <span class="op">&lt;-</span> <span class="fu">coveffectsplot</span><span class="fu">::</span><span class="fu"><a href="../reference/forest_plot.html">forest_plot</a></span><span class="op">(</span><span class="va">fpdata</span><span class="op">[</span><span class="va">paramname</span><span class="op">==</span><span class="st">"AUC"</span><span class="op">]</span>,</span>
<span>                            ref_area <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.8</span>, <span class="fl">1</span><span class="op">/</span><span class="fl">0.8</span><span class="op">)</span>,</span>
<span>                            xlabel <span class="op">=</span> <span class="st">"Fold Change Relative to Reference"</span>,</span>
<span>                            ref_legend_text  <span class="op">=</span> <span class="st">"Reference (vertical line)\nClinically relevant limits\n(gray area)"</span>,</span>
<span>                            area_legend_text <span class="op">=</span> <span class="st">"Reference (vertical line)\nClinically relevant limits\n(gray area)"</span>,</span>
<span>                            interval_legend_text <span class="op">=</span> <span class="va">interval_legend_text</span>,</span>
<span>                            plot_title             <span class="op">=</span> <span class="st">""</span>,</span>
<span>                            interval_bsv_text <span class="op">=</span> <span class="va">interval_bsv_text</span>,</span>
<span>                            facet_formula <span class="op">=</span> <span class="st">"covname~paramname"</span>,</span>
<span>                            facet_switch <span class="op">=</span> <span class="st">"y"</span>,</span>
<span>                            facet_scales <span class="op">=</span> <span class="st">"free_y"</span>,</span>
<span>                            facet_space <span class="op">=</span> <span class="st">"free"</span>,</span>
<span>                            paramname_shape <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                            combine_interval_shape_legend <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                            table_position <span class="op">=</span> <span class="st">"right"</span>,</span>
<span>                            table_text_size<span class="op">=</span><span class="fl">4</span>,</span>
<span>                            plot_table_ratio <span class="op">=</span> <span class="fl">4</span>,</span>
<span>                            show_table_facet_strip <span class="op">=</span> <span class="st">"none"</span>,</span>
<span>                            logxscale <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                            major_x_ticks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.25</span>,<span class="fl">0.5</span>,<span class="fl">0.8</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">/</span><span class="fl">0.8</span>,<span class="fl">1</span><span class="op">/</span><span class="fl">0.5</span>,<span class="fl">1</span><span class="op">/</span><span class="fl">0.25</span><span class="op">)</span>,</span>
<span>                            major_x_labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"1/4"</span>,<span class="st">"1/2"</span>,<span class="st">"0.8"</span>,<span class="st">"1"</span>,<span class="st">"1.25"</span>,<span class="st">"2"</span>,<span class="st">"4"</span><span class="op">)</span>,</span>
<span>                            return_list <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">plotlists</span></span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[2]]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html" class="external-link">dev.off</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; png </span></span>
<span><span class="co">#&gt;   2</span></span></code></pre></div>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">main_plot</span> <span class="op">&lt;-</span> <span class="va">plotlists</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span></span>
<span>               panel.spacing<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">10</span>, <span class="st">"pt"</span><span class="op">)</span>,</span>
<span>               panel.grid<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>               panel.grid.minor<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>               legend.position<span class="op">=</span><span class="st">"bottom"</span>,</span>
<span>               strip.placement.y<span class="op">=</span><span class="st">"outside"</span>,</span>
<span>               strip.background.y<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>               strip.text.y<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span></span>
<span>                   hjust<span class="op">=</span><span class="fl">1</span>,</span>
<span>                   vjust<span class="op">=</span><span class="fl">1</span>,</span>
<span>                   face<span class="op">=</span><span class="st">"italic"</span>,color<span class="op">=</span><span class="st">"gray"</span>,</span>
<span>                   size<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">rel</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>               legend.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">rel</a></span><span class="op">(</span><span class="fl">0.5</span><span class="op">)</span><span class="op">)</span>,</span>
<span>               plot.margin <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">margin</a></span><span class="op">(</span>t<span class="op">=</span><span class="fl">0</span>,r<span class="op">=</span><span class="fl">0</span>,b<span class="op">=</span><span class="fl">0</span>,l<span class="op">=</span><span class="fl">5</span>,unit<span class="op">=</span><span class="st">"pt"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_discrete.html" class="external-link">scale_y_discrete</a></span><span class="op">(</span></span>
<span>breaks<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"90% of patients"</span>,</span>
<span>         <span class="st">"50% of patients"</span>,</span>
<span>         <span class="st">"85 kg\nFemale\n45 g/L"</span>,</span>
<span>         <span class="st">"40 g/L"</span>,<span class="st">"50 g/L"</span>,<span class="st">"Male"</span>,</span>
<span>         <span class="st">"56 kg"</span>,<span class="st">"72 kg"</span>,<span class="st">"98 kg"</span>,<span class="st">"128 kg"</span></span>
<span><span class="op">)</span>,</span>
<span>labels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"90% of patients"</span>,</span>
<span>               <span class="st">"50% of patients"</span>,</span>
<span>               <span class="st">"85 kg-Female-45 g/L"</span>,</span>
<span>               <span class="st">"40 g/L"</span>,<span class="st">"50 g/L"</span>,<span class="st">"Male"</span>,</span>
<span>               <span class="st">"56 kg"</span>,<span class="st">"72 kg"</span>,<span class="st">"98 kg"</span>,<span class="st">"128 kg"</span></span>
<span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">table_plot</span> <span class="op">&lt;-</span> <span class="va">plotlists</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span></span>
<span>               panel.border<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>               panel.spacing<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">10</span>, <span class="st">"pt"</span><span class="op">)</span>,</span>
<span>               strip.background.y<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>               legend.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">rel</a></span><span class="op">(</span><span class="fl">0.5</span><span class="op">)</span><span class="op">)</span>,</span>
<span>               plot.margin <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">margin</a></span><span class="op">(</span>t<span class="op">=</span><span class="fl">0</span>,r<span class="op">=</span><span class="fl">5</span>,b<span class="op">=</span><span class="fl">0</span>,l<span class="op">=</span><span class="fl">0</span>,unit<span class="op">=</span><span class="st">"pt"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/grDevices/png.html" class="external-link">png</a></span><span class="op">(</span><span class="st">"./coveffectsplot5.png"</span>,width <span class="op">=</span><span class="fl">8.5</span> ,height <span class="op">=</span> <span class="fl">6</span>,units <span class="op">=</span> <span class="st">"in"</span>,res<span class="op">=</span><span class="fl">72</span><span class="op">)</span></span>
<span><span class="fu">egg</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/egg/man/ggarrange.html" class="external-link">ggarrange</a></span><span class="op">(</span></span>
<span>  <span class="va">main_plot</span>,</span>
<span>  <span class="va">table_plot</span>,</span>
<span>  nrow <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  widths <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">1</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html" class="external-link">dev.off</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; png </span></span>
<span><span class="co">#&gt;   2</span></span></code></pre></div>
<div class="float">
<img src="coveffectsplot5.png" alt="Customized Covariate Effects Plot."><div class="figcaption">Customized Covariate Effects Plot.</div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="plots-with-multiple-pk-parameters">Plots with Multiple PK Parameters<a class="anchor" aria-label="anchor" href="#plots-with-multiple-pk-parameters"></a>
</h2>
<p>You can also have plots with more than one PK parameter. You may want
to facet by parameter, or to use different shape by parameter.</p>
<div class="section level3">
<h3 id="facet-by-parameter">Facet by Parameter<a class="anchor" aria-label="anchor" href="#facet-by-parameter"></a>
</h3>
<p>This is achieved by setting <code>paramname_shape = FALSE</code> and
<code>facet_formula = "covname~paramname"</code>. We also suppress the
table by using <code>table_position = "none"</code> and reduce the plot
text sizes using <code>base_size = 11</code>.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/grDevices/png.html" class="external-link">png</a></span><span class="op">(</span><span class="st">"./coveffectsplot6.png"</span>,width <span class="op">=</span><span class="fl">9.5</span> ,height <span class="op">=</span> <span class="fl">6</span>,units <span class="op">=</span> <span class="st">"in"</span>,res<span class="op">=</span><span class="fl">72</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/forest_plot.html">forest_plot</a></span><span class="op">(</span><span class="va">fpdata</span>,</span>
<span>                            ref_area <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.8</span>, <span class="fl">1</span><span class="op">/</span><span class="fl">0.8</span><span class="op">)</span>,</span>
<span>                            x_range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>,<span class="fl">2</span><span class="op">)</span>,</span>
<span>                            xlabel <span class="op">=</span> <span class="st">"Fold Change Relative to Reference"</span>,</span>
<span>                            facet_formula <span class="op">=</span> <span class="st">"covname~paramname"</span>,</span>
<span>                            interval_legend_text <span class="op">=</span> <span class="va">interval_legend_text</span>,</span>
<span>                            interval_bsv_text <span class="op">=</span> <span class="va">interval_bsv_text</span>,</span>
<span>                            facet_switch <span class="op">=</span> <span class="st">"y"</span>,</span>
<span>                            facet_scales <span class="op">=</span> <span class="st">"free_y"</span>,</span>
<span>                            facet_space <span class="op">=</span> <span class="st">"free"</span>,</span>
<span>                            facet_labeller <span class="op">=</span> <span class="st">"label_parsed"</span>,</span>
<span>                            paramname_shape <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                            bsv_shape <span class="op">=</span><span class="st">"triangle"</span>,</span>
<span>                            table_position <span class="op">=</span> <span class="st">"none"</span>,</span>
<span>                            table_text_size<span class="op">=</span><span class="fl">4</span>,</span>
<span>                            base_size <span class="op">=</span> <span class="fl">11</span>,</span>
<span>                            plot_table_ratio <span class="op">=</span> <span class="fl">4</span>,</span>
<span>                            show_table_facet_strip <span class="op">=</span> <span class="st">"none"</span>,</span>
<span>                            logxscale <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                            major_x_ticks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>,<span class="fl">0.8</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">/</span><span class="fl">0.8</span>,<span class="fl">1</span><span class="op">/</span><span class="fl">0.5</span><span class="op">)</span>,</span>
<span>                            major_x_labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"1/2"</span>,<span class="st">"0.8"</span>,<span class="st">"1"</span>,<span class="st">"1.25"</span>,<span class="st">"2"</span><span class="op">)</span>,</span>
<span>                            x_label_text_size <span class="op">=</span> <span class="fl">10</span>,</span>
<span>                            return_list <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html" class="external-link">dev.off</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; png </span></span>
<span><span class="co">#&gt;   2</span></span></code></pre></div>
<div class="float">
<img src="coveffectsplot6.png" alt="Facet By Parameter Covariate Effects Plot."><div class="figcaption">Facet By Parameter Covariate Effects Plot.</div>
</div>
</div>
<div class="section level3">
<h3 id="shape-by-parameter">Shape by Parameter<a class="anchor" aria-label="anchor" href="#shape-by-parameter"></a>
</h3>
<p>This is achieved by setting <code>paramname_shape = TRUE</code> we
also illustrate how you can use <code>legend_order</code> to choose the
legend ordering and few other options.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/grDevices/png.html" class="external-link">png</a></span><span class="op">(</span><span class="st">"./coveffectsplot7.png"</span>,width <span class="op">=</span><span class="fl">9.5</span> ,height <span class="op">=</span> <span class="fl">6</span>,units <span class="op">=</span> <span class="st">"in"</span>,res<span class="op">=</span><span class="fl">72</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/forest_plot.html">forest_plot</a></span><span class="op">(</span><span class="va">fpdata</span><span class="op">[</span><span class="va">paramname</span><span class="op">!=</span><span class="st">"AUC"</span><span class="op">]</span>,</span>
<span>                            ref_area <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.8</span>, <span class="fl">1</span><span class="op">/</span><span class="fl">0.8</span><span class="op">)</span>,</span>
<span>                            x_range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.35</span>,<span class="fl">1</span><span class="op">/</span><span class="fl">0.35</span><span class="op">)</span>,</span>
<span>                            xlabel <span class="op">=</span> <span class="st">"Fold Change Relative to Reference"</span>,</span>
<span>            ref_legend_text <span class="op">=</span> <span class="st">"Reference\nClinically relevant limits\n(0.8-1.25)"</span>,</span>
<span>            area_legend_text <span class="op">=</span> <span class="st">"Reference\nClinically relevant limits\n(0.8-1.25)"</span>,</span>
<span>            interval_legend_text <span class="op">=</span> <span class="st">"Median\n90% CI"</span>,</span>
<span>            interval_bsv_text <span class="op">=</span> <span class="st">"BSV\nPrediction Intervals"</span>, </span>
<span>                            facet_formula <span class="op">=</span> <span class="st">"covname~."</span>,</span>
<span>                            paramname_shape <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                            interval_shape <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"square"</span>,<span class="st">"triangle"</span><span class="op">)</span>,</span>
<span>            legend_order <span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"shape"</span>,<span class="st">"pointinterval"</span>,<span class="st">"ref"</span>, <span class="st">"area"</span><span class="op">)</span>,</span>
<span>                            legend_shape_reverse <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                            bsv_col <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/muted.html" class="external-link">muted</a></span><span class="op">(</span><span class="st">"red"</span><span class="op">)</span>,</span>
<span>                            interval_col <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/muted.html" class="external-link">muted</a></span><span class="op">(</span><span class="st">"blue"</span><span class="op">)</span>,</span>
<span>                            facet_switch <span class="op">=</span> <span class="st">"y"</span>,</span>
<span>                            facet_scales <span class="op">=</span> <span class="st">"free_y"</span>,</span>
<span>                            facet_space <span class="op">=</span> <span class="st">"free"</span>,</span>
<span>                            table_position <span class="op">=</span> <span class="st">"none"</span>,</span>
<span>                            table_text_size<span class="op">=</span><span class="fl">4</span>,</span>
<span>                            base_size <span class="op">=</span> <span class="fl">9</span>,</span>
<span>                            plot_table_ratio <span class="op">=</span> <span class="fl">4</span>,</span>
<span>                            show_table_facet_strip <span class="op">=</span> <span class="st">"none"</span>,</span>
<span>                            logxscale <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                            major_x_ticks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>,<span class="fl">0.8</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">/</span><span class="fl">0.8</span>,<span class="fl">1</span><span class="op">/</span><span class="fl">0.5</span><span class="op">)</span>,</span>
<span>                            major_x_labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"1/2"</span>,<span class="st">"0.8"</span>,<span class="st">"1"</span>,<span class="st">"1.25"</span>,<span class="st">"2"</span><span class="op">)</span>,</span>
<span>                            legend_space_x_mult <span class="op">=</span> <span class="fl">0.01</span>,</span>
<span>                            legend_position <span class="op">=</span> <span class="st">"right"</span>,</span>
<span>                            return_list <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html" class="external-link">dev.off</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; png </span></span>
<span><span class="co">#&gt;   2</span></span></code></pre></div>
<div class="float">
<img src="coveffectsplot7.png" alt="Shape By Parameter Covariate Effects Plot."><div class="figcaption">Shape By Parameter Covariate Effects Plot.</div>
</div>
</div>
<div class="section level3">
<h3 id="color-by-parameter">Color by Parameter<a class="anchor" aria-label="anchor" href="#color-by-parameter"></a>
</h3>
<p>This is achieved by setting <code>paramname_color = TRUE</code> (on
top of <code>paramname_shape = TRUE</code> or not) and the the user can
then pass a vector of colors in the <code>interval_col</code>
argument</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/grDevices/png.html" class="external-link">png</a></span><span class="op">(</span><span class="st">"./coveffectsplot_color.png"</span>,width <span class="op">=</span><span class="fl">9.5</span> ,height <span class="op">=</span> <span class="fl">6</span>,units <span class="op">=</span> <span class="st">"in"</span>,res<span class="op">=</span><span class="fl">72</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/forest_plot.html">forest_plot</a></span><span class="op">(</span><span class="va">fpdata</span><span class="op">[</span><span class="va">paramname</span><span class="op">!=</span><span class="st">"AUC"</span> <span class="op">&amp;</span></span>
<span>                     <span class="va">covname</span><span class="op">!=</span><span class="st">"BSV"</span><span class="op">&amp;</span></span>
<span>                     <span class="va">covname</span><span class="op">!=</span><span class="st">"Reference"</span>,<span class="op">]</span>,</span>
<span>                            ref_area <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.8</span>, <span class="fl">1</span><span class="op">/</span><span class="fl">0.8</span><span class="op">)</span>,</span>
<span>                            x_range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.35</span>,<span class="fl">1</span><span class="op">/</span><span class="fl">0.35</span><span class="op">)</span>,</span>
<span>                            xlabel <span class="op">=</span> <span class="st">"Fold Change Relative to Reference"</span>,</span>
<span>            ref_legend_text <span class="op">=</span> <span class="st">"Reference\nClinically relevant limits\n(0.8-1.25)"</span>,</span>
<span>            area_legend_text <span class="op">=</span> <span class="st">"Reference\nClinically relevant limits\n(0.8-1.25)"</span>,</span>
<span>                            facet_formula <span class="op">=</span> <span class="st">"covname~."</span>,</span>
<span>                            paramname_shape <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                            paramname_color <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                            combine_interval_shape_legend <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>            interval_shape <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"square"</span>,<span class="st">"triangle"</span><span class="op">)</span>,</span>
<span>            legend_order <span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"shape"</span>,<span class="st">"pointinterval"</span>,<span class="st">"ref"</span>, <span class="st">"area"</span><span class="op">)</span>,</span>
<span>                            legend_shape_reverse <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                            bsv_col <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/muted.html" class="external-link">muted</a></span><span class="op">(</span><span class="st">"red"</span><span class="op">)</span>,</span>
<span>                            facet_switch <span class="op">=</span> <span class="st">"y"</span>,</span>
<span>                            facet_scales <span class="op">=</span> <span class="st">"free_y"</span>,</span>
<span>                            facet_space <span class="op">=</span> <span class="st">"free"</span>,</span>
<span>                            table_position <span class="op">=</span> <span class="st">"none"</span>,</span>
<span>                            base_size <span class="op">=</span> <span class="fl">12</span>,</span>
<span>                            logxscale <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                            major_x_ticks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>,<span class="fl">0.8</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">/</span><span class="fl">0.8</span>,<span class="fl">1</span><span class="op">/</span><span class="fl">0.5</span><span class="op">)</span>,</span>
<span>                            major_x_labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"1/2"</span>,<span class="st">"0.8"</span>,<span class="st">"1"</span>,<span class="st">"1.25"</span>,<span class="st">"2"</span><span class="op">)</span>,</span>
<span>                            legend_space_x_mult <span class="op">=</span> <span class="fl">0.01</span>,</span>
<span>                            legend_position <span class="op">=</span> <span class="st">"right"</span>,</span>
<span>                            return_list <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">C</span><span class="op">[</span><span class="va">last</span><span class="op">]</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">C</span><span class="op">[</span><span class="va">max</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                       values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/muted.html" class="external-link">muted</a></span><span class="op">(</span><span class="st">"blue"</span><span class="op">)</span>,<span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/muted.html" class="external-link">muted</a></span><span class="op">(</span><span class="st">"red"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_shape.html" class="external-link">scale_shape_discrete</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">C</span><span class="op">[</span><span class="va">last</span><span class="op">]</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">C</span><span class="op">[</span><span class="va">max</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html" class="external-link">dev.off</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; png </span></span>
<span><span class="co">#&gt;   2</span></span></code></pre></div>
<div class="float">
<img src="coveffectsplot_color.png" alt="Color By Parameter Covariate Effects Plot."><div class="figcaption">Color By Parameter Covariate Effects Plot.</div>
</div>
<p>While we covered varying one at a time covariate value (marginal
effects), we can use observed or simulated distribution of correlated
covariates and simulate joint covariate effects as illustrated in the
Pediatric Application vignette.It can be misleading to show the BSV
around the reference only as it operates at all levels of covariate as
such we recommend to fully represent the intervals with BSV and
Uncertainty at all levels / covariate splits (full Distribution PK
example vignette.)</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Samer Mouksassi, Benjamin Rich.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

      </footer>
</div>






  </body>
</html>
