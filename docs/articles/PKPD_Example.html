<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PK/PD Model: Assessing the Impact of Covariates on a Biomarker â€¢ coveffectsplot</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/united/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="PK/PD Model: Assessing the Impact of Covariates on a Biomarker">
<meta property="og:description" content="coveffectsplot">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">coveffectsplot</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Vignettes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Introduction_to_coveffectsplot.html">Introduction to coveffectsplot</a>
    </li>
    <li>
      <a href="../articles/Exposure_Response_Example.html">Exposure-Response Example</a>
    </li>
    <li>
      <a href="../articles/PK_Example.html">PK Example</a>
    </li>
    <li>
      <a href="../articles/PK_Example_full.html">PK Example Full</a>
    </li>
    <li>
      <a href="../articles/Pediatric_Cov_Sim.html">PK Pediatric Example</a>
    </li>
    <li>
      <a href="../articles/PKPD_Example.html">PKPD Example</a>
    </li>
  </ul>
</li>
<li>
  <a href="../articles/app.html">Shiny App</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/smouksassi/coveffectsplot/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="PKPD_Example_files/header-attrs-2.13/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>PK/PD Model: Assessing the Impact of Covariates on a Biomarker</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/smouksassi/coveffectsplot/blob/master/vignettes/PKPD_Example.Rmd"><code>vignettes/PKPD_Example.Rmd</code></a></small>
      <div class="hidden name"><code>PKPD_Example.Rmd</code></div>

    </div>

    
    
<p>Here we illustrate how the ordinary differential equations (ODEs) model and the approach of varying one covariate at a time, can be expanded.<br>
We link the same two-compartment PK model (from the PK Example vignette) to an indirect response pharmacodynamic (PD) model where the drug concentrations inhibit the rate constant of input (Kin).<br>
The covariates model included several covariates effects on Clearance, Volume and Kin. The baseline PD value is controlled by the ratio of Kin/Kout.<br>
In this vignette we do not go into a lot of details, as we assume that the user has read and run the code of the Introduction to <code>coveffectsplot</code> and PK Example vignettes and that the reader is familiar with PK/PD concepts.<br>
At the end we show how we can add a table under a multiple parameters forest plot.</p>
<div id="specifying-a-pkpd-model-using-mrgsolve" class="section level2">
<h2 class="hasAnchor">
<a href="#specifying-a-pkpd-model-using-mrgsolve" class="anchor"></a>Specifying a PK/PD Model using <code>mrgsolve</code>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">codepkpdmodelcov</span> <span class="op">&lt;-</span> <span class="st">[2056 chars quoted with ''']</span>
<span class="va">modpkpdsim</span> <span class="op">&lt;-</span> <span class="fu">mcode</span><span class="op">(</span><span class="st">"codepkpdmodelcov"</span>, <span class="va">codepkpdmodelcov</span><span class="op">)</span>
<span class="va">partab</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/setDT.html">setDT</a></span><span class="op">(</span><span class="va">modpkpdsim</span><span class="op">@</span><span class="va">annot</span><span class="op">$</span><span class="va">data</span><span class="op">)</span><span class="op">[</span><span class="va">block</span><span class="op">==</span><span class="st">"PARAM"</span>, <span class="fu">.</span><span class="op">(</span><span class="va">name</span>, <span class="va">descr</span>, <span class="va">unit</span><span class="op">)</span><span class="op">]</span>
<span class="va">partab</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/merge.html">merge</a></span><span class="op">(</span><span class="va">partab</span>, <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/melt.data.table.html">melt</a></span><span class="op">(</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/setDT.html">setDT</a></span><span class="op">(</span><span class="va">modpkpdsim</span><span class="op">@</span><span class="va">param</span><span class="op">@</span><span class="va">data</span><span class="op">)</span>, meas<span class="op">=</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/patterns.html">patterns</a></span><span class="op">(</span><span class="st">"*"</span><span class="op">)</span>, var<span class="op">=</span><span class="st">"name"</span><span class="op">)</span><span class="op">)</span>
<span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="va">partab</span><span class="op">)</span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">name</th>
<th align="left">descr</th>
<th align="left">unit</th>
<th align="right">value</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">AGE</td>
<td align="left">Age</td>
<td align="left">years</td>
<td align="right">40.000</td>
</tr>
<tr class="even">
<td align="left">ALB</td>
<td align="left">Albumin</td>
<td align="left">g/L</td>
<td align="right">45.000</td>
</tr>
<tr class="odd">
<td align="left">CL</td>
<td align="left">Clearance CL</td>
<td align="left">L/h</td>
<td align="right">4.000</td>
</tr>
<tr class="even">
<td align="left">CLALB</td>
<td align="left">Ablumin on CL</td>
<td align="left">ref. 45 g/L</td>
<td align="right">-0.800</td>
</tr>
<tr class="odd">
<td align="left">CLSEX</td>
<td align="left">Sex on CL</td>
<td align="left">ref. Female</td>
<td align="right">0.200</td>
</tr>
<tr class="even">
<td align="left">CLWT</td>
<td align="left">Weight on CL</td>
<td align="left">ref. 85 kg</td>
<td align="right">1.000</td>
</tr>
<tr class="odd">
<td align="left">HEALTHY</td>
<td align="left">Health Status</td>
<td align="left">0=Diseased, 1=Healthy</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">IC50</td>
<td align="left">Drug concentration producing 50% of maximum inhibition</td>
<td align="left">.</td>
<td align="right">3.000</td>
</tr>
<tr class="odd">
<td align="left">IMAX</td>
<td align="left">Maximum Inhibition Response</td>
<td align="left">.</td>
<td align="right">0.999</td>
</tr>
<tr class="even">
<td align="left">KA</td>
<td align="left">Absorption rate constant Ka</td>
<td align="left">1/h</td>
<td align="right">0.500</td>
</tr>
<tr class="odd">
<td align="left">KIN</td>
<td align="left">Zero-order Rate constant of biomarker production</td>
<td align="left">amount/h</td>
<td align="right">3.000</td>
</tr>
<tr class="even">
<td align="left">KINAGE</td>
<td align="left">Age on KIN</td>
<td align="left">ref. 40 years</td>
<td align="right">-0.080</td>
</tr>
<tr class="odd">
<td align="left">KINHLTY</td>
<td align="left">Weight on CL</td>
<td align="left">ref. 85 kg</td>
<td align="right">1.500</td>
</tr>
<tr class="even">
<td align="left">KINWT</td>
<td align="left">Weight on KIN</td>
<td align="left">ref. 85 kg</td>
<td align="right">0.400</td>
</tr>
<tr class="odd">
<td align="left">KOUT</td>
<td align="left">First-order Rate constant of biomarker loss</td>
<td align="left">1/h</td>
<td align="right">0.060</td>
</tr>
<tr class="even">
<td align="left">Qp</td>
<td align="left">Intercompartmental clearance Q</td>
<td align="left">L/h</td>
<td align="right">10.000</td>
</tr>
<tr class="odd">
<td align="left">SEX</td>
<td align="left">Sex</td>
<td align="left">0=Female, 1=Male</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">V</td>
<td align="left">Central volume Vc</td>
<td align="left">L</td>
<td align="right">10.000</td>
</tr>
<tr class="odd">
<td align="left">VSEX</td>
<td align="left">Sex on Vc</td>
<td align="left">ref. Female</td>
<td align="right">0.070</td>
</tr>
<tr class="even">
<td align="left">VWT</td>
<td align="left">Weight on Vc</td>
<td align="left">ref. 85 kg</td>
<td align="right">1.000</td>
</tr>
<tr class="odd">
<td align="left">Vp</td>
<td align="left">Peripheral volume Vp</td>
<td align="left">L</td>
<td align="right">50.000</td>
</tr>
<tr class="even">
<td align="left">WT</td>
<td align="left">Weight</td>
<td align="left">kg</td>
<td align="right">85.000</td>
</tr>
<tr class="odd">
<td align="left">gamma</td>
<td align="left">Sigmoidicity factor of the sigmoid Emax equation</td>
<td align="left">.</td>
<td align="right">0.550</td>
</tr>
</tbody>
</table>
<div id="simulate-reference-subjects-with-bsv" class="section level3">
<h3 class="hasAnchor">
<a href="#simulate-reference-subjects-with-bsv" class="anchor"></a>Simulate Reference Subjects with BSV</h3>
<p>We simulate at reference covariate values with between subject variability (BSV) and then we show a plot of the PK and PD profiles of five random subjects.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">idata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/data.table.html">data.table</a></span><span class="op">(</span>ID<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="va">nbsvsubjects</span>, WT<span class="op">=</span><span class="fl">85</span>, SEX<span class="op">=</span><span class="fl">0</span>, ALB<span class="op">=</span><span class="fl">45</span>, AGE<span class="op">=</span><span class="fl">40</span>, HEALTHY <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>
<span class="va">ev1</span> <span class="op">&lt;-</span> <span class="fu">ev</span><span class="op">(</span>time <span class="op">=</span> <span class="fl">0</span>, amt <span class="op">=</span> <span class="fl">100</span>, cmt <span class="op">=</span> <span class="fl">1</span>, ii <span class="op">=</span> <span class="fl">24</span>, addl <span class="op">=</span> <span class="fl">20</span><span class="op">)</span>
<span class="va">data.dose</span> <span class="op">&lt;-</span> <span class="fu">ev</span><span class="op">(</span><span class="va">ev1</span><span class="op">)</span>
<span class="va">data.dose</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/setDT.html">setDT</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="va">data.dose</span><span class="op">)</span><span class="op">)</span>
<span class="va">data.all</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/data.table.html">data.table</a></span><span class="op">(</span><span class="va">idata</span>, <span class="va">data.dose</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">678549</span><span class="op">)</span>
<span class="va">outputpkpdsim</span> <span class="op">&lt;-</span> <span class="va">modpkpdsim</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu">data_set</span><span class="op">(</span><span class="va">data.all</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu">mrgsim</span><span class="op">(</span>end <span class="op">=</span> <span class="fl">28</span><span class="op">*</span><span class="fl">24</span>, delta <span class="op">=</span> <span class="fl">0.25</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="va">as.data.frame</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="va">as.data.table</span>

<span class="va">outputpkpdsim</span><span class="op">$</span><span class="va">HEALTHY</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">outputpkpdsim</span><span class="op">$</span><span class="va">HEALTHY</span><span class="op">)</span>

<span class="va">yvar_names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>
  <span class="st">'CP'</span><span class="op">=</span><span class="st">"Plasma Concentrations"</span>,
  <span class="st">'RESP'</span><span class="op">=</span><span class="st">"PD Values"</span>
<span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">678549</span><span class="op">)</span>
<span class="va">outputpkpdsimlong</span> <span class="op">&lt;-</span> <span class="va">outputpkpdsim</span><span class="op">[</span><span class="va">outputpkpdsim</span><span class="op">$</span><span class="va">ID</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span>
<span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/duplicated.html">unique</a></span><span class="op">(</span><span class="va">outputpkpdsim</span><span class="op">$</span><span class="va">ID</span><span class="op">)</span>, <span class="fl">5</span><span class="op">)</span>, <span class="op">]</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu">gather</span><span class="op">(</span><span class="va">key</span>,<span class="va">value</span>,<span class="va">CP</span>,<span class="va">RESP</span><span class="op">)</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span><span class="va">outputpkpdsimlong</span> ,
       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">value</span>, group <span class="op">=</span> <span class="va">ID</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.8</span>, size <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html">facet_grid</a></span><span class="op">(</span><span class="va">key</span> <span class="op">~</span><span class="va">ID</span>,scales<span class="op">=</span><span class="st">"free_y"</span>,switch<span class="op">=</span><span class="st">"y"</span>,
             labeller <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labeller.html">labeller</a></span><span class="op">(</span>key<span class="op">=</span><span class="va">yvar_names</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>y <span class="op">=</span> <span class="st">""</span>, color <span class="op">=</span> <span class="st">"Sex"</span>, x <span class="op">=</span> <span class="st">"Time (h)"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>strip.placement <span class="op">=</span> <span class="st">"outside"</span>,
        axis.title.y<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="PKPD_Example_files/figure-html/pkpdsimulation-1.png" width="672"></p>
</div>
<div id="compute-pd-parameters-and-summarize-bsv" class="section level3">
<h3 class="hasAnchor">
<a href="#compute-pd-parameters-and-summarize-bsv" class="anchor"></a>Compute PD Parameters and Summarize BSV</h3>
<p>Here we compute the PD baseline (where we start), nadir response (minimum response achieved) and the delta (difference) between the baseline and nadir. We then summarize and report the BSV around these parameters as ranges of 50 and 90% of patients. We then show a plot of the first 10 replicates as an example of the simulated PD profiles. Since the code is similar to the PK Example vignette it is not shown.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">derive.exposure</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">time</span>, <span class="va">PDRESP</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>
    nadir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">PDRESP</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,
    baselinepd <span class="op">=</span> <span class="va">PDRESP</span><span class="op">[</span><span class="fl">1L</span><span class="op">]</span>,
    deltapd <span class="op">=</span> <span class="va">PDRESP</span><span class="op">[</span><span class="fl">1L</span><span class="op">]</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">PDRESP</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
  <span class="op">)</span>
  <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/data.table.html">data.table</a></span><span class="op">(</span>paramname<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, paramvalue<span class="op">=</span><span class="va">x</span><span class="op">)</span>
<span class="op">}</span>
<span class="va">refbsv</span> <span class="op">&lt;-</span> <span class="va">outputpkpdsim</span><span class="op">[</span>, <span class="fu">derive.exposure</span><span class="op">(</span><span class="va">time</span>, <span class="va">PDRESP</span><span class="op">)</span>,
                        by<span class="op">=</span><span class="fu">.</span><span class="op">(</span><span class="va">ID</span>, <span class="va">WT</span>, <span class="va">SEX</span>, <span class="va">ALB</span>, <span class="va">AGE</span>, <span class="va">HEALTHY</span><span class="op">)</span><span class="op">]</span>

<span class="va">refbsv</span><span class="op">[</span>, <span class="va">stdparamvalue</span> <span class="op">:=</span> <span class="va">paramvalue</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/stats/median.html">median</a></span><span class="op">(</span><span class="va">paramvalue</span><span class="op">)</span>, by<span class="op">=</span><span class="va">paramname</span><span class="op">]</span>

<span class="va">bsvranges</span> <span class="op">&lt;-</span> <span class="va">refbsv</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    P05 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">stdparamvalue</span>, <span class="fl">0.05</span><span class="op">)</span>,
    P25 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">stdparamvalue</span>, <span class="fl">0.25</span><span class="op">)</span>,
    P50 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">stdparamvalue</span>, <span class="fl">0.5</span><span class="op">)</span>,
    P75 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">stdparamvalue</span>, <span class="fl">0.75</span><span class="op">)</span>,
    P95 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">stdparamvalue</span>, <span class="fl">0.95</span><span class="op">)</span><span class="op">)</span>, by <span class="op">=</span> <span class="va">paramname</span><span class="op">]</span>
<span class="va">bsvranges</span>
<span class="co">#&gt;     paramname       P05       P25 P50      P75      P95</span>
<span class="co">#&gt; 1:      nadir 0.6276383 0.8514868   1 1.222234 1.701741</span>
<span class="co">#&gt; 2: baselinepd 0.6230568 0.8462084   1 1.203854 1.740792</span>
<span class="co">#&gt; 3:    deltapd 0.6017202 0.8147581   1 1.199841 1.708660</span></code></pre></div>
</div>
</div>
<div id="construct-ans-simulate-at-combinations-of-covariate-of-interest" class="section level2">
<h2 class="hasAnchor">
<a href="#construct-ans-simulate-at-combinations-of-covariate-of-interest" class="anchor"></a>Construct ans Simulate at Combinations of Covariate of Interest</h2>
<p>Similarly to the PK Example vignette we generate covariate combinations of interest and we simulate with uncertainty using an invented varcov matrix.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">reference.values</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>WT <span class="op">=</span> <span class="fl">85</span>, ALB <span class="op">=</span> <span class="fl">45</span>, AGE <span class="op">=</span> <span class="fl">40</span>, SEX <span class="op">=</span> <span class="fl">0</span>, HEALTHY <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>   
<span class="va">covcomb</span> <span class="op">&lt;-</span> <span class="fu">expand.modelframe</span><span class="op">(</span>
  WT  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">56</span>,<span class="fl">128</span><span class="op">)</span>, 
  AGE <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">20</span>,<span class="fl">60</span><span class="op">)</span>,
  ALB <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">40</span>,<span class="fl">50</span><span class="op">)</span>,
  SEX <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>,<span class="co">#Refernce is for SEX =0</span>
  HEALTHY <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>,<span class="co">#Refernce is for HEALTHY =0</span>
  rv <span class="op">=</span> <span class="va">reference.values</span><span class="op">)</span>

<span class="co"># Add the reference</span>
<span class="va">covcomb</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/rbindlist.html">rbind</a></span><span class="op">(</span><span class="va">covcomb</span>, <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/data.table.html">data.table</a></span><span class="op">(</span><span class="va">reference.values</span>, covname<span class="op">=</span><span class="st">"REF"</span><span class="op">)</span><span class="op">)</span>
<span class="va">covcomb</span><span class="op">$</span><span class="va">ID</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">covcomb</span><span class="op">)</span>

<span class="va">covcomb</span>
<span class="co">#&gt;    WT AGE ALB SEX HEALTHY covname ID</span>
<span class="co">#&gt; 1  56  40  45   0       0      WT  1</span>
<span class="co">#&gt; 2 128  40  45   0       0      WT  2</span>
<span class="co">#&gt; 3  85  40  40   0       0     ALB  3</span>
<span class="co">#&gt; 4  85  40  50   0       0     ALB  4</span>
<span class="co">#&gt; 5  85  20  45   0       0     AGE  5</span>
<span class="co">#&gt; 6  85  60  45   0       0     AGE  6</span>
<span class="co">#&gt; 7  85  40  45   1       0     SEX  7</span>
<span class="co">#&gt; 8  85  40  45   0       1 HEALTHY  8</span>
<span class="co">#&gt; 9  85  40  45   0       0     REF  9</span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pdprofiles</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">iter_sims</span><span class="op">[</span><span class="va">iter_sims</span><span class="op">$</span><span class="va">rep</span><span class="op">&lt;=</span><span class="fl">10</span>,<span class="op">]</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">time</span><span class="op">/</span><span class="fl">24</span>,<span class="va">PDRESP</span>,col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">WT</span><span class="op">)</span>,linetype<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">HEALTHY</span><span class="op">)</span> <span class="op">)</span> <span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>group<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/interaction.html">interaction</a></span><span class="op">(</span><span class="va">ID</span>,<span class="va">rep</span><span class="op">)</span><span class="op">)</span>,alpha<span class="op">=</span><span class="fl">0.3</span>,size<span class="op">=</span><span class="fl">0.3</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">outcovcomb</span>,<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>group<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/interaction.html">interaction</a></span><span class="op">(</span><span class="va">ID</span><span class="op">)</span><span class="op">)</span>,color<span class="op">=</span><span class="st">"black"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html">facet_grid</a></span><span class="op">(</span><span class="va">SEX</span><span class="op">+</span><span class="va">ALB</span><span class="op">~</span> <span class="va">AGE</span><span class="op">+</span><span class="va">WT</span>,labeller <span class="op">=</span> <span class="va">label_both</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>linetype<span class="op">=</span><span class="st">"Black Lines\nNo Uncertainty\nHealthy Status"</span>,
       colour<span class="op">=</span><span class="st">"Colored Lines\nUncertainty\nReplicates\n(1 to 10)\nWeight (kg)"</span>,
       caption <span class="op">=</span><span class="st">"Simulation\nwith Uncertainty without BSV"</span> ,
       x<span class="op">=</span><span class="st">"Days"</span>, y <span class="op">=</span> <span class="st">"PD Values"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html">guides</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html">guide_legend</a></span><span class="op">(</span>override.aes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="va">pdprofiles</span></code></pre></div>
<p><img src="PKPD_Example_files/figure-html/unnamed-chunk-3-1.png" width="672"></p>
<div id="compute-pd-parameters-and-distributions-plots" class="section level3">
<h3 class="hasAnchor">
<a href="#compute-pd-parameters-and-distributions-plots" class="anchor"></a>Compute PD Parameters and Distributions Plots</h3>
<p>Similar to the above we compute the PD parameters, standardize by the median and provide a plot. Since the code is similar to the PK Example vignette it is not shown.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">boxplotpd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">boxplotdat</span>,
       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">covvalue</span> ,y<span class="op">=</span><span class="va">paramvalue</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html">facet_grid</a></span><span class="op">(</span><span class="va">paramname</span> <span class="op">~</span><span class="va">covname2</span>,scales<span class="op">=</span><span class="st">"free"</span>,switch<span class="op">=</span><span class="st">"both"</span>,
             labeller <span class="op">=</span> <span class="va">label_parsed</span><span class="op">)</span><span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html">geom_boxplot</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,strip.placement <span class="op">=</span> <span class="st">"outside"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>y<span class="op">=</span><span class="st">"PD Parameter Values"</span>,x<span class="op">=</span><span class="st">"Covariate Value"</span><span class="op">)</span>
<span class="va">boxplotpd</span></code></pre></div>
<p><img src="PKPD_Example_files/figure-html/unnamed-chunk-5-1.png" width="672"></p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pdggridges</span><span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">out.df.univariatecov.nca</span>,
       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">paramvaluestd</span>,y<span class="op">=</span><span class="va">covvalue</span>,fill<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">..quantile..</span><span class="op">)</span>,height<span class="op">=</span><span class="va">..ndensity..</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html">facet_grid</a></span><span class="op">(</span><span class="va">covname2</span><span class="op">~</span><span class="va">paramname</span>,scales<span class="op">=</span><span class="st">"free_y"</span>,space<span class="op">=</span><span class="st">"free"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span><span class="op">(</span> <span class="st">"rect"</span>,
            xmin <span class="op">=</span> <span class="fl">0.5</span>,
            xmax <span class="op">=</span> <span class="fl">2</span>,
            ymin <span class="op">=</span> <span class="op">-</span><span class="cn">Inf</span>,
            ymax <span class="op">=</span> <span class="cn">Inf</span>,
            fill <span class="op">=</span> <span class="st">"gray"</span>,alpha<span class="op">=</span><span class="fl">0.4</span>
  <span class="op">)</span><span class="op">+</span>
  <span class="fu">stat_density_ridges</span><span class="op">(</span>
    geom <span class="op">=</span> <span class="st">"density_ridges_gradient"</span>, calc_ecdf <span class="op">=</span> <span class="cn">TRUE</span>,
    quantile_lines <span class="op">=</span> <span class="cn">TRUE</span>, rel_min_height <span class="op">=</span> <span class="fl">0.001</span>,scale<span class="op">=</span><span class="fl">0.9</span>,
    quantiles <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.05</span>,<span class="fl">0.5</span>, <span class="fl">0.95</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_fill_manual</a></span><span class="op">(</span>
    name <span class="op">=</span> <span class="st">"Probability"</span>, values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"white"</span>, <span class="st">"#0000FFA0"</span>,<span class="st">"#0000FFA0"</span>, <span class="st">"white"</span><span class="op">)</span>,
    labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"(0, 0.05]"</span>, <span class="st">"(0.05, 0.5]"</span>,<span class="st">"(0.5, 0.95]"</span>, <span class="st">"(0.95, 1]"</span><span class="op">)</span>
  <span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_vline</a></span><span class="op">(</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x<span class="op">=</span><span class="st">"Effects Relative to Parameter Reference value"</span>,y<span class="op">=</span><span class="st">""</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span><span class="op">(</span>breaks<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.25</span>,<span class="fl">0.5</span>,<span class="fl">0.8</span>,<span class="fl">1</span><span class="op">/</span><span class="fl">0.8</span>,<span class="fl">1</span><span class="op">/</span><span class="fl">0.5</span>,<span class="fl">1</span><span class="op">/</span><span class="fl">0.25</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_log10</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">pdggridges</span></code></pre></div>
<p><img src="PKPD_Example_files/figure-html/unnamed-chunk-7-1.png" width="672"></p>
</div>
</div>
<div id="summarize-add-the-bsv-ranges-and-putting-it-all-together-using-forest_plot" class="section level2">
<h2 class="hasAnchor">
<a href="#summarize-add-the-bsv-ranges-and-putting-it-all-together-using-forest_plot" class="anchor"></a>Summarize, add the BSV Ranges and Putting it all Together Using <code>forest_plot</code>
</h2>
<p>Here we show how a multiple parameters, multiple covariates and table can be done.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">coveffectsdatacovrep</span> <span class="op">&lt;-</span> <span class="va">out.df.univariatecov.nca</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">paramname</span>,<span class="va">covname</span>,<span class="va">covvalue</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>
    mid<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html">median</a></span><span class="op">(</span><span class="va">paramvaluestd</span><span class="op">)</span>,
    lower<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">paramvaluestd</span>,<span class="fl">0.05</span><span class="op">)</span>,
    upper <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">paramvaluestd</span>,<span class="fl">0.95</span><span class="op">)</span><span class="op">)</span>

<span class="va">coveffectsdatacovreplabel</span><span class="op">&lt;-</span>   <span class="va">coveffectsdatacovrep</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>
    label<span class="op">=</span> <span class="va">covvalue</span>,
    LABEL <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">mid</span>,<span class="fl">2</span><span class="op">)</span>, nsmall <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,
                   <span class="st">" ["</span>, <span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">lower</span>,<span class="fl">2</span><span class="op">)</span>, nsmall <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>, <span class="st">"-"</span>,
                   <span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">upper</span>,<span class="fl">2</span><span class="op">)</span>, nsmall <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>, <span class="st">"]"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/setkey.html">setkey</a></span><span class="op">(</span><span class="va">bsvranges</span>, <span class="va">paramname</span><span class="op">)</span>
<span class="va">coveffectsdatacovrepbsv</span> <span class="op">&lt;-</span> <span class="va">coveffectsdatacovrep</span><span class="op">[</span><span class="va">coveffectsdatacovrep</span><span class="op">$</span><span class="va">covname</span><span class="op">==</span><span class="st">"REF"</span>,<span class="op">]</span>
<span class="va">coveffectsdatacovrepbsv</span><span class="op">$</span><span class="va">covname</span> <span class="op">&lt;-</span> <span class="st">"BSV"</span>
<span class="va">coveffectsdatacovrepbsv</span><span class="op">$</span><span class="va">covvalue</span> <span class="op">&lt;-</span> <span class="st">"50% of patients"</span>
<span class="va">coveffectsdatacovrepbsv</span><span class="op">$</span><span class="va">label</span> <span class="op">&lt;-</span>    <span class="st">"50% of patients"</span>
<span class="va">coveffectsdatacovrepbsv</span><span class="op">$</span><span class="va">lower</span> <span class="op">&lt;-</span> <span class="va">bsvranges</span><span class="op">$</span><span class="va">P25</span>
<span class="va">coveffectsdatacovrepbsv</span><span class="op">$</span><span class="va">upper</span> <span class="op">&lt;-</span> <span class="va">bsvranges</span><span class="op">$</span><span class="va">P75</span>

<span class="va">coveffectsdatacovrepbsv2</span> <span class="op">&lt;-</span> <span class="va">coveffectsdatacovrep</span><span class="op">[</span><span class="va">coveffectsdatacovrep</span><span class="op">$</span><span class="va">covname</span><span class="op">==</span><span class="st">"REF"</span>,<span class="op">]</span>
<span class="va">coveffectsdatacovrepbsv2</span><span class="op">$</span><span class="va">covname</span> <span class="op">&lt;-</span> <span class="st">"BSV"</span>
<span class="va">coveffectsdatacovrepbsv2</span><span class="op">$</span><span class="va">covvalue</span> <span class="op">&lt;-</span> <span class="st">"90% of patients"</span>
<span class="va">coveffectsdatacovrepbsv2</span><span class="op">$</span><span class="va">label</span> <span class="op">&lt;-</span>    <span class="st">"90% of patients"</span>
<span class="va">coveffectsdatacovrepbsv2</span><span class="op">$</span><span class="va">lower</span> <span class="op">&lt;-</span> <span class="va">bsvranges</span><span class="op">$</span><span class="va">P05</span>
<span class="va">coveffectsdatacovrepbsv2</span><span class="op">$</span><span class="va">upper</span> <span class="op">&lt;-</span> <span class="va">bsvranges</span><span class="op">$</span><span class="va">P95</span>
<span class="va">coveffectsdatacovrepbsv</span><span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/rbindlist.html">rbind</a></span><span class="op">(</span><span class="va">coveffectsdatacovrep</span>,<span class="va">coveffectsdatacovrepbsv</span>,<span class="va">coveffectsdatacovrepbsv2</span><span class="op">)</span>
<span class="va">coveffectsdatacovrepbsv</span> <span class="op">&lt;-</span> <span class="va">coveffectsdatacovrepbsv</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>
    label<span class="op">=</span> <span class="va">covvalue</span>,
    LABEL <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">mid</span>,<span class="fl">2</span><span class="op">)</span>, nsmall <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,
                   <span class="st">" ["</span>, <span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">lower</span>,<span class="fl">2</span><span class="op">)</span>, nsmall <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>, <span class="st">"-"</span>,
                   <span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">upper</span>,<span class="fl">2</span><span class="op">)</span>, nsmall <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>, <span class="st">"]"</span><span class="op">)</span><span class="op">)</span>
<span class="va">coveffectsdatacovrepbsv</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="va">coveffectsdatacovrepbsv</span><span class="op">)</span>
<span class="va">coveffectsdatacovrepbsv</span><span class="op">$</span><span class="va">label</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">coveffectsdatacovrepbsv</span><span class="op">$</span><span class="va">covvalue</span> <span class="op">)</span>
<span class="va">coveffectsdatacovrepbsv</span><span class="op">$</span><span class="va">label</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/reorder.factor.html">reorder</a></span><span class="op">(</span><span class="va">coveffectsdatacovrepbsv</span><span class="op">$</span><span class="va">label</span>,
                                         <span class="va">coveffectsdatacovrepbsv</span><span class="op">$</span><span class="va">lower</span><span class="op">)</span>


<span class="va">coveffectsdatacovrepbsv</span><span class="op">$</span><span class="va">covname</span> <span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">coveffectsdatacovrepbsv</span><span class="op">$</span><span class="va">covname</span> <span class="op">)</span>,levels <span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"WT"</span>,<span class="st">"SEX"</span>,<span class="st">"ALB"</span>,<span class="st">"AGE"</span>,<span class="st">"HEALTHY"</span>, <span class="st">"REF"</span>, <span class="st">"BSV"</span><span class="op">)</span>,
labels<span class="op">=</span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Weight"</span>,<span class="st">"Sex"</span>,<span class="st">"Albumin"</span>,<span class="st">"Age"</span>,<span class="st">"Healthy"</span>, <span class="st">"Reference"</span>, <span class="st">"BSV"</span><span class="op">)</span>
<span class="op">)</span>

<span class="va">interval_legend_text</span> <span class="op">&lt;-</span> <span class="st">"Median (points)\n90% CI (horizontal lines)"</span>
<span class="va">interval_bsv_text</span> <span class="op">&lt;-</span> <span class="st">"BSV (points)\nPrediction Intervals (horizontal lines)"</span>
<span class="va">ref_legend_text</span> <span class="op">&lt;-</span> <span class="st">"Reference\n(vertical line)\nClinically relevant limits\n(gray area)"</span>
<span class="va">area_legend_text</span> <span class="op">&lt;-</span> <span class="st">"Reference\n(vertical line)\nClinically relevant limits\n(gray area)"</span>
<span class="fu"><a href="https://rdrr.io/r/grDevices/png.html">png</a></span><span class="op">(</span><span class="st">"./Figure_S_PD_4.png"</span>,width <span class="op">=</span><span class="fl">12</span> ,height <span class="op">=</span> <span class="fl">9</span>,units <span class="op">=</span> <span class="st">"in"</span>,res<span class="op">=</span><span class="fl">72</span><span class="op">)</span>
<span class="fu">coveffectsplot</span><span class="fu">::</span><span class="fu"><a href="../reference/forest_plot.html">forest_plot</a></span><span class="op">(</span><span class="va">coveffectsdatacovrepbsv</span>,
                            ref_area <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">1</span><span class="op">/</span><span class="fl">0.5</span><span class="op">)</span>,
                            x_range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.25</span>,<span class="fl">4</span><span class="op">)</span>,
                            strip_placement <span class="op">=</span> <span class="st">"outside"</span>,
                            base_size <span class="op">=</span> <span class="fl">16</span>,
                            y_label_text_size <span class="op">=</span> <span class="fl">12</span>,
                            y_label_text_width <span class="op">=</span> <span class="fl">50</span>,
                            xlabel <span class="op">=</span> <span class="st">"Fold Change Relative to Reference"</span>,
                            ref_legend_text <span class="op">=</span> <span class="va">ref_legend_text</span>,
                            area_legend_text <span class="op">=</span><span class="va">area_legend_text</span>,
                            interval_legend_text <span class="op">=</span> <span class="va">interval_legend_text</span>,
                            interval_bsv_text <span class="op">=</span> <span class="va">interval_bsv_text</span>,
                            facet_formula <span class="op">=</span> <span class="st">"covname~paramname"</span>,
                            facet_switch <span class="op">=</span> <span class="st">"y"</span>,
                            facet_scales <span class="op">=</span> <span class="st">"free_y"</span>,
                            facet_space <span class="op">=</span> <span class="st">"fixed"</span>,
                            paramname_shape <span class="op">=</span> <span class="cn">FALSE</span>,
                            table_position <span class="op">=</span> <span class="st">"below"</span>,
                            table_text_size<span class="op">=</span><span class="fl">4</span>,
                            plot_table_ratio <span class="op">=</span> <span class="fl">1</span>,
                            table_facet_switch <span class="op">=</span> <span class="st">"both"</span>,
                            show_table_facet_strip <span class="op">=</span> <span class="st">"both"</span>,
                            show_table_yaxis_tick_label <span class="op">=</span> <span class="cn">TRUE</span>,
                            logxscale <span class="op">=</span> <span class="cn">TRUE</span>,
                            major_x_ticks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.5</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">/</span><span class="fl">0.5</span><span class="op">)</span>,
                            table_margin <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">5.5</span>,<span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>,
                            plot_margin <span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">5.5</span>,<span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>,
                            reserve_table_xaxis_label_space <span class="op">=</span> <span class="cn">FALSE</span>,
                            return_list <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html">dev.off</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; agg_png </span>
<span class="co">#&gt;       2</span>
<span class="co"># consider returning a list and editing the y axis label line breaks height</span>
<span class="co"># theme(axis.text.y = element_text(lineheight = ))</span></code></pre></div>
<div class="figure">
<img src="Figure_S_PD_4.png" alt=""><p class="caption">Covariate Effects Plot.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Samer Mouksassi.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
