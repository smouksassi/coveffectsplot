<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PK Model in Pediatric Patients: Assessing the Impact of a Multivariate Correlated Distribution of Covariates on PK Exposures â€¢ coveffectsplot</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/united/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="PK Model in Pediatric Patients: Assessing the Impact of a Multivariate Correlated Distribution of Covariates on PK Exposures">
<meta property="og:description" content="coveffectsplot">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">coveffectsplot</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Vignettes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Introduction_to_coveffectsplot.html">Introduction to coveffectsplot</a>
    </li>
    <li>
      <a href="../articles/Exposure_Response_Example.html">Exposure-Response Example</a>
    </li>
    <li>
      <a href="../articles/PK_Example.html">PK Example</a>
    </li>
    <li>
      <a href="../articles/PK_Example_full.html">PK Example Full</a>
    </li>
    <li>
      <a href="../articles/Pediatric_Cov_Sim.html">PK Pediatric Example</a>
    </li>
    <li>
      <a href="../articles/PKPD_Example.html">PKPD Example</a>
    </li>
  </ul>
</li>
<li>
  <a href="../articles/app.html">Shiny App</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/smouksassi/coveffectsplot/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="Pediatric_Cov_Sim_files/header-attrs-2.13/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>PK Model in Pediatric Patients: Assessing the Impact of a Multivariate Correlated Distribution of Covariates on PK Exposures</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/smouksassi/coveffectsplot/blob/master/vignettes/Pediatric_Cov_Sim.Rmd"><code>vignettes/Pediatric_Cov_Sim.Rmd</code></a></small>
      <div class="hidden name"><code>Pediatric_Cov_Sim.Rmd</code></div>

    </div>

    
    
<p>In this vignette we illustrate how to simulate joint effects of covariates in a pediatric population between 2 to 6 years old. Since Age and Weight in kids are highly correlated, we will not simulate varying one covariate at a time rather we will incorporate a <strong>distribution</strong> of realistic Age/Weight pairs. This approach is recommended when a database of realistic covariates distribution is available.</p>
<div id="specifying-a-pediatric-simulation-model" class="section level2">
<h2 class="hasAnchor">
<a href="#specifying-a-pediatric-simulation-model" class="anchor"></a>Specifying A Pediatric Simulation Model</h2>
<p>Here we have a simple one-compartment PK model with first-order absorption where clearance and volume are allometrically scaled. The reference subject is a 4 year old female with a weight of 15.9 kg.<br>
First, we plot a typical PK profile with between subject variability (BSV).</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pedpkmodelcov</span> <span class="op">&lt;-</span> <span class="st">'
$PARAM @annotated
KA    : 0.5   : Absorption rate constant Ka (1/h)
CL    : 4     : Clearance CL (L/h)
V     : 10    : Central volume Vc (L)
CLWT  : 0.75  : Weight on CL (ref. 22.5 kg)
VWT   : 1     : Weight on V (ref. 22.5 kg)

$PARAM @annotated // reference values for covariate
WT    : 15.8  : Weight (kg)
SEX   : 0     : Sex (0=Female, 1=Male)
AGE   : 4     : Age (years)

$CMT GUT CENT
$MAIN
double CLi = CL *
    pow((WT/15.8), CLWT)*exp(ETA(1)); 
double Vi = V *
    pow((WT/15.8), VWT)*exp(ETA(2));  

double KAi = KA;
double Keli = CLi/Vi;

$OMEGA
0.09 
0.01 0.09 

$ODE
dxdt_GUT  = -KAi*GUT;
dxdt_CENT =  KAi*GUT-Keli*CENT;

$TABLE
double CP   = CENT/ Vi;
$CAPTURE CP KAi CLi Vi WT SEX AGE 
'</span>
<span class="va">pedmodsim</span> <span class="op">&lt;-</span> <span class="fu">mcode</span><span class="op">(</span><span class="st">"pedpkmodelcov"</span>, <span class="va">pedpkmodelcov</span><span class="op">)</span>
<span class="va">partab</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/setDT.html">setDT</a></span><span class="op">(</span><span class="va">pedmodsim</span><span class="op">@</span><span class="va">annot</span><span class="op">$</span><span class="va">data</span><span class="op">)</span><span class="op">[</span><span class="va">block</span><span class="op">==</span><span class="st">"PARAM"</span>, <span class="fu">.</span><span class="op">(</span><span class="va">name</span>, <span class="va">descr</span>, <span class="va">unit</span><span class="op">)</span><span class="op">]</span>
<span class="va">partab</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/merge.html">merge</a></span><span class="op">(</span><span class="va">partab</span>, <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/melt.data.table.html">melt</a></span><span class="op">(</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/setDT.html">setDT</a></span><span class="op">(</span><span class="va">pedmodsim</span><span class="op">@</span><span class="va">param</span><span class="op">@</span><span class="va">data</span><span class="op">)</span>, meas<span class="op">=</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/patterns.html">patterns</a></span><span class="op">(</span><span class="st">"*"</span><span class="op">)</span>, var<span class="op">=</span><span class="st">"name"</span><span class="op">)</span><span class="op">)</span>
<span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="va">partab</span><span class="op">)</span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">name</th>
<th align="left">descr</th>
<th align="left">unit</th>
<th align="right">value</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">AGE</td>
<td align="left">Age</td>
<td align="left">years</td>
<td align="right">4.00</td>
</tr>
<tr class="even">
<td align="left">CL</td>
<td align="left">Clearance CL</td>
<td align="left">L/h</td>
<td align="right">4.00</td>
</tr>
<tr class="odd">
<td align="left">CLWT</td>
<td align="left">Weight on CL</td>
<td align="left">ref. 22.5 kg</td>
<td align="right">0.75</td>
</tr>
<tr class="even">
<td align="left">KA</td>
<td align="left">Absorption rate constant Ka</td>
<td align="left">1/h</td>
<td align="right">0.50</td>
</tr>
<tr class="odd">
<td align="left">SEX</td>
<td align="left">Sex</td>
<td align="left">0=Female, 1=Male</td>
<td align="right">0.00</td>
</tr>
<tr class="even">
<td align="left">V</td>
<td align="left">Central volume Vc</td>
<td align="left">L</td>
<td align="right">10.00</td>
</tr>
<tr class="odd">
<td align="left">VWT</td>
<td align="left">Weight on V</td>
<td align="left">ref. 22.5 kg</td>
<td align="right">1.00</td>
</tr>
<tr class="even">
<td align="left">WT</td>
<td align="left">Weight</td>
<td align="left">kg</td>
<td align="right">15.80</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">idata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/data.table.html">data.table</a></span><span class="op">(</span>
  ID <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">nsubj</span>,
  WT <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">15.8</span>,<span class="va">nsubj</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span>,
         <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">16.2</span>,<span class="va">nsubj</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span>,<span class="co">#from Nhanes at 4 years female and male</span>
  AGE <span class="op">=</span> <span class="fl">4</span>,
  SEX <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0</span>,<span class="va">nsubj</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">1</span>,<span class="va">nsubj</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span>
<span class="op">)</span>
<span class="va">ev1</span> <span class="op">&lt;-</span> <span class="fu">ev</span><span class="op">(</span>time <span class="op">=</span> <span class="fl">0</span>, amt <span class="op">=</span> <span class="fl">100</span>, cmt <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>
<span class="va">data.dose</span> <span class="op">&lt;-</span> <span class="fu">ev</span><span class="op">(</span><span class="va">ev1</span><span class="op">)</span>
<span class="va">data.dose</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/setDT.html">setDT</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="va">data.dose</span><span class="op">)</span><span class="op">)</span>
<span class="va">data.all</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/data.table.html">data.table</a></span><span class="op">(</span><span class="va">idata</span>, <span class="va">data.dose</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">678549</span><span class="op">)</span>
<span class="va">outputsim</span> <span class="op">&lt;-</span> <span class="va">pedmodsim</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu">data_set</span><span class="op">(</span><span class="va">data.all</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu">mrgsim</span><span class="op">(</span>end <span class="op">=</span> <span class="fl">24</span>, delta <span class="op">=</span> <span class="fl">0.25</span><span class="op">)</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="va">as.data.frame</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="va">as.data.table</span>

<span class="va">outputsim</span><span class="op">$</span><span class="va">SEX</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">outputsim</span><span class="op">$</span><span class="va">SEX</span><span class="op">)</span>
<span class="va">outputsim</span><span class="op">$</span><span class="va">SEX</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">outputsim</span><span class="op">$</span><span class="va">SEX</span>, labels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Girls"</span>,<span class="st">"Boys"</span><span class="op">)</span><span class="op">)</span>

<span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">outputsim</span><span class="op">[</span>,<span class="op">]</span>,
             <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">CP</span>, group <span class="op">=</span> <span class="va">ID</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.2</span>, size <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html">facet_grid</a></span><span class="op">(</span><span class="va">AGE</span> <span class="op">~</span> <span class="va">WT</span><span class="op">+</span><span class="va">SEX</span>,
             labeller <span class="op">=</span> <span class="va">label_both</span> , switch <span class="op">=</span><span class="st">"y"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_log10</a></span><span class="op">(</span>breaks <span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.001</span>,<span class="fl">0.01</span>,<span class="fl">0.01</span>,<span class="fl">0.1</span>,<span class="fl">1</span>,<span class="fl">10</span><span class="op">)</span>,
                labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"0.001"</span>,<span class="st">"0.01"</span>,<span class="st">"0.01"</span>,<span class="st">"0.1"</span>,<span class="st">"1"</span>,<span class="st">"10"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="va">Log</span><span class="op">[</span><span class="fl">10</span><span class="op">]</span><span class="op">~</span><span class="op">~</span><span class="va">Plasma</span><span class="op">~</span><span class="op">~</span><span class="va">Concentrations</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"Sex"</span>, x <span class="op">=</span> <span class="st">"Time (h)"</span><span class="op">)</span>
<span class="va">p1</span></code></pre></div>
<p><img src="Pediatric_Cov_Sim_files/figure-html/pedpkmodel-1.png" width="672"></p>
</div>
<div id="pk-parameters-and-associated-bsv-ranges" class="section level2">
<h2 class="hasAnchor">
<a href="#pk-parameters-and-associated-bsv-ranges" class="anchor"></a>PK Parameters and Associated BSV ranges</h2>
<p>Second, we compute the PK parameters AUC and Cmax, standardize and compute between subject variability ranges.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">derive.exposure</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">time</span>, <span class="va">CP</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">time</span><span class="op">)</span>
  <span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>
    Cmax <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">CP</span><span class="op">)</span>,
    AUC <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diff.html">diff</a></span><span class="op">(</span><span class="va">time</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="va">CP</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="va">CP</span><span class="op">[</span><span class="op">-</span><span class="va">n</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span>
  <span class="op">)</span>
  <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/data.table.html">data.table</a></span><span class="op">(</span>paramname<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, paramvalue<span class="op">=</span><span class="va">x</span><span class="op">)</span>
<span class="op">}</span>
<span class="va">refbsv</span> <span class="op">&lt;-</span> <span class="va">outputsim</span><span class="op">[</span>, <span class="fu">derive.exposure</span><span class="op">(</span><span class="va">time</span>, <span class="va">CP</span><span class="op">)</span>, by<span class="op">=</span><span class="fu">.</span><span class="op">(</span><span class="va">ID</span>, <span class="va">WT</span>, <span class="va">SEX</span>, <span class="va">AGE</span><span class="op">)</span><span class="op">]</span>
<span class="va">refbsv</span><span class="op">[</span>, <span class="va">stdparamvalue</span> <span class="op">:=</span> <span class="va">paramvalue</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/stats/median.html">median</a></span><span class="op">(</span><span class="va">paramvalue</span><span class="op">)</span>, by<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">SEX</span>,<span class="va">paramname</span><span class="op">)</span><span class="op">]</span>

<span class="va">bsvranges</span> <span class="op">&lt;-</span> <span class="va">refbsv</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    P05 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">stdparamvalue</span>, <span class="fl">0.05</span><span class="op">)</span>,
    P25 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">stdparamvalue</span>, <span class="fl">0.25</span><span class="op">)</span>,
    P50 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">stdparamvalue</span>, <span class="fl">0.5</span><span class="op">)</span>,
    P75 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">stdparamvalue</span>, <span class="fl">0.75</span><span class="op">)</span>,
    P95 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">stdparamvalue</span>, <span class="fl">0.95</span><span class="op">)</span><span class="op">)</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">SEX</span>,<span class="va">paramname</span><span class="op">)</span><span class="op">]</span>
<span class="va">bsvranges</span>
<span class="co">#&gt;      SEX paramname       P05       P25 P50      P75      P95</span>
<span class="co">#&gt; 1: Girls      Cmax 0.7852997 0.9212879   1 1.122921 1.301545</span>
<span class="co">#&gt; 2: Girls       AUC 0.6185701 0.8328135   1 1.245339 1.744747</span>
<span class="co">#&gt; 3:  Boys      Cmax 0.7742915 0.9104196   1 1.093831 1.251045</span>
<span class="co">#&gt; 4:  Boys       AUC 0.6312985 0.8298309   1 1.209752 1.607079</span>

<span class="va">yvar_names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>
  <span class="st">'AUC'</span><span class="op">=</span><span class="st">"AUC"</span>,
  <span class="st">'Cmax'</span><span class="op">=</span><span class="st">"Cmax"</span>
<span class="op">)</span>
<span class="va">p4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">refbsv</span><span class="op">[</span>,<span class="op">]</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>
        x      <span class="op">=</span> <span class="va">stdparamvalue</span>,
        y      <span class="op">=</span> <span class="va">paramname</span>,
        fill   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">..quantile..</span><span class="op">)</span>,
        height <span class="op">=</span> <span class="va">..ndensity..</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html">facet_grid</a></span><span class="op">(</span><span class="va">paramname</span><span class="op">+</span><span class="va">AGE</span><span class="op">~</span><span class="va">WT</span><span class="op">+</span><span class="va">SEX</span> , scales<span class="op">=</span><span class="st">"free_y"</span>,
             labeller<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labeller.html">labeller</a></span><span class="op">(</span>paramname<span class="op">=</span><span class="va">yvar_names</span>,
                               .cols <span class="op">=</span><span class="va">label_both</span>,
                                AGE <span class="op">=</span> <span class="va">label_both</span><span class="op">)</span>
,switch<span class="op">=</span><span class="st">"y"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">stat_density_ridges</span><span class="op">(</span>
    geom<span class="op">=</span><span class="st">"density_ridges_gradient"</span>, calc_ecdf<span class="op">=</span><span class="cn">TRUE</span>,
    quantile_lines<span class="op">=</span><span class="cn">TRUE</span>, rel_min_height<span class="op">=</span><span class="fl">0.001</span>, scale<span class="op">=</span><span class="fl">0.9</span>,
    quantiles<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.05</span>, <span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>, <span class="fl">0.95</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_fill_manual</a></span><span class="op">(</span>
    name<span class="op">=</span><span class="st">"Probability"</span>,
    values<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"white"</span>, <span class="st">"#FF000050"</span>, <span class="st">"#FF0000A0"</span>, 
             <span class="st">"#FF0000A0"</span>, <span class="st">"#FF000050"</span>, <span class="st">"white"</span><span class="op">)</span>,
    labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"(0, 0.05]"</span>, <span class="st">"(0.05, 0.25]"</span>,
             <span class="st">"(0.25, 0.5]"</span>, <span class="st">"(0.5, 0.75]"</span>,
             <span class="st">"(0.75, 0.95]"</span>, <span class="st">"(0.95, 1]"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>
    legend.position <span class="op">=</span> <span class="st">"none"</span>,
    axis.text.y     <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,
    axis.ticks.y    <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,
    axis.title.y    <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x<span class="op">=</span><span class="st">"Standardized PK Parameters"</span>, y<span class="op">=</span><span class="st">""</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_log10</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html">coord_cartesian</a></span><span class="op">(</span>expand<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span>

<span class="va">p4</span></code></pre></div>
<p><img src="Pediatric_Cov_Sim_files/figure-html/ncapedpkmodel-1.png" width="672"></p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="co"># p1&lt;- p1 +theme_bw(base_size=18)</span>
<span class="co"># p4 &lt;- p4+ theme_bw(base_size=18)+</span>
<span class="co">#   theme(axis.text.y=element_blank(),axis.ticks.y = element_blank(),</span>
<span class="co">#         legend.position = "none")</span>
<span class="co"># egg::ggarrange(p1 , p4,ncol=2)</span></code></pre></div>
</div>
<div id="simulating-ageweight-pairs-using-nhanes-lms-values" class="section level2">
<h2 class="hasAnchor">
<a href="#simulating-ageweight-pairs-using-nhanes-lms-values" class="anchor"></a>Simulating Age/Weight Pairs Using NHANES LMS Values</h2>
<p>The NHANES website provides a csv file containing the smoothed growth charts distribution parameters at specific ages for boys and girls. The <code><a href="https://rdrr.io/pkg/gamlss.dist/man/BCCG.html">gamlss.dist::rBCCG</a></code> function is used to show how we can use these parameters to generate a realistic pediatric Age/Weight/Sex distribution. The <code>wtage</code> dataset is now part of the package.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">wtage</span><span class="op">&lt;-</span>  <span class="va">wtage</span><span class="op">[</span><span class="va">wtage</span><span class="op">$</span><span class="va">Agemos</span><span class="op">&lt;=</span><span class="fl">6</span><span class="op">*</span><span class="fl">12</span>,<span class="op">]</span> <span class="co"># keeps only 2 to 6 years</span>
<span class="va">wtage</span><span class="op">[</span><span class="va">wtage</span><span class="op">$</span><span class="va">Agemos</span><span class="op">&gt;=</span><span class="fl">4</span><span class="op">*</span><span class="fl">12</span><span class="op">-</span><span class="fl">1</span><span class="op">&amp;</span><span class="va">wtage</span><span class="op">$</span><span class="va">Agemos</span><span class="op">&lt;=</span><span class="fl">4</span><span class="op">*</span><span class="fl">12</span> <span class="op">+</span><span class="fl">1</span>,<span class="op">]</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">Sex</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>Median<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/median.html">median</a></span><span class="op">(</span><span class="va">M</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 2 x 2</span>
<span class="co">#&gt;     Sex Median</span>
<span class="co">#&gt;   &lt;dbl&gt;  &lt;dbl&gt;</span>
<span class="co">#&gt; 1     1   16.2</span>
<span class="co">#&gt; 2     2   15.8</span>

<span class="va">nweightsperage</span> <span class="op">&lt;-</span> <span class="fl">50</span> <span class="co"># simulate 50 kid at each age/sex</span>
<span class="va">simwtageoutput</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="cn">NA</span>, nrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">wtage</span><span class="op">)</span>,ncol <span class="op">=</span> <span class="va">nweightsperage</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">simwtageoutput</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"Var"</span>, <span class="fl">1</span><span class="op">:</span><span class="va">nweightsperage</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">209321</span><span class="op">)</span>
<span class="va">wtage</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="va">wtage</span><span class="op">)</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">wtage</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span><span class="co">#</span>
  <span class="va">simpoints</span> <span class="op">&lt;-</span> <span class="fu">gamlss.dist</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/gamlss.dist/man/BCCG.html">rBCCG</a></span><span class="op">(</span><span class="va">nweightsperage</span>,
                                  mu <span class="op">=</span> <span class="va">wtage</span><span class="op">[</span><span class="va">i</span>,<span class="st">"M"</span><span class="op">]</span>,
                                  sigma <span class="op">=</span>  <span class="va">wtage</span><span class="op">[</span><span class="va">i</span>,<span class="st">"S"</span><span class="op">]</span>,
                                  nu <span class="op">=</span> <span class="va">wtage</span><span class="op">[</span><span class="va">i</span>,<span class="st">"L"</span><span class="op">]</span><span class="op">)</span>
<span class="va">simwtageoutput</span><span class="op">[</span><span class="va">i</span>, <span class="op">]</span> <span class="op">&lt;-</span> <span class="va">simpoints</span>
<span class="op">}</span>
<span class="va">simwtageoutput</span><span class="op">$</span><span class="va">Agemos</span>  <span class="op">&lt;-</span> <span class="va">wtage</span><span class="op">$</span><span class="va">Agemos</span>
<span class="va">simwtageoutput</span><span class="op">$</span><span class="va">AgeY</span>  <span class="op">&lt;-</span> <span class="va">wtage</span><span class="op">$</span><span class="va">Agemos</span><span class="op">/</span><span class="fl">12</span>
<span class="va">simwtageoutput</span><span class="op">$</span><span class="va">Sex</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/fifelse.html">ifelse</a></span><span class="op">(</span> <span class="va">wtage</span><span class="op">$</span><span class="va">Sex</span><span class="op">==</span><span class="fl">2</span>,<span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span><span class="co">#recode girls to 0, boys to 1</span>

<span class="va">simwtageoutput</span> <span class="op">&lt;-</span> <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/gather.html">gather</a></span><span class="op">(</span><span class="va">simwtageoutput</span>,<span class="va">age</span>,<span class="va">Weight</span>,
                                <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"Var"</span>, <span class="fl">1</span><span class="op">:</span><span class="va">nweightsperage</span><span class="op">)</span><span class="op">)</span>
<span class="va">simwtageoutput</span><span class="op">$</span><span class="va">age</span> <span class="op">&lt;-</span> <span class="cn">NULL</span>
<span class="va">simwtageoutput</span><span class="op">$</span><span class="va">SEXLABEL</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">simwtageoutput</span><span class="op">$</span><span class="va">Sex</span>,labels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Girls"</span>,<span class="st">"Boys"</span><span class="op">)</span><span class="op">)</span>
<span class="va">wtvsageplot</span><span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">simwtageoutput</span>,<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">AgeY</span>,<span class="va">Weight</span>,color<span class="op">=</span><span class="va">SEXLABEL</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>alpha<span class="op">=</span><span class="fl">0.2</span>,size<span class="op">=</span><span class="fl">1.5</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html">facet_grid</a></span><span class="op">(</span><span class="op">~</span><span class="va">SEXLABEL</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>y<span class="op">=</span><span class="st">"Weight (kg)"</span>, x<span class="op">=</span> <span class="st">"Age (years)"</span>,col<span class="op">=</span><span class="st">""</span><span class="op">)</span>
<span class="va">wtvsageplot</span></code></pre></div>
<p><img src="Pediatric_Cov_Sim_files/figure-html/simcovariate-1.png" width="672"></p>
</div>
<div id="simulation-with-the-multivariate-realistic-distribution" class="section level2">
<h2 class="hasAnchor">
<a href="#simulation-with-the-multivariate-realistic-distribution" class="anchor"></a>Simulation with the Multivariate Realistic Distribution</h2>
<p>The section above generated 4900 Age/Weight/Sex distribution values that we will use for the simulation. We will not remove the between subject variability to be able to appreciate the range of possible PK concentrations. We show a plot of the PK profiles and the normalized PK parameters versus Age and versus Weight. Since we are dealing with a distribution and not specific covariate values we split into quartile ranges of the covariate distribution.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">idata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="va">simwtageoutput</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">idata</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Agemos"</span>,<span class="st">"AGE"</span>,<span class="st">"SEX"</span>,<span class="st">"WT"</span>,<span class="st">"SEXLABEL"</span><span class="op">)</span>
<span class="va">ev1</span> <span class="op">&lt;-</span> <span class="fu">ev</span><span class="op">(</span>time<span class="op">=</span><span class="fl">0</span>,amt<span class="op">=</span><span class="fl">100</span>, cmt<span class="op">=</span><span class="fl">1</span><span class="op">)</span>
<span class="va">data.dose</span> <span class="op">&lt;-</span> <span class="fu">ev</span><span class="op">(</span><span class="va">ev1</span><span class="op">)</span>
<span class="va">data.dose</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="va">data.dose</span><span class="op">)</span>
<span class="va">data.all</span><span class="op">&lt;-</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/merge.html">merge</a></span><span class="op">(</span><span class="va">idata</span>,<span class="va">data.dose</span><span class="op">)</span>
<span class="va">data.all</span><span class="op">$</span><span class="va">ID</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">data.all</span><span class="op">)</span>
<span class="va">outcovcomb</span><span class="op">&lt;-</span> <span class="va">pedmodsim</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu">data_set</span><span class="op">(</span><span class="va">data.all</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu">mrgsim</span><span class="op">(</span>end<span class="op">=</span><span class="fl">24</span>, delta<span class="op">=</span><span class="fl">1</span><span class="op">)</span>
<span class="va">outcovcomb</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="va">outcovcomb</span><span class="op">)</span>
<span class="va">outcovcomb</span> <span class="op">&lt;-</span> <span class="va">outcovcomb</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">ID</span>,<span class="va">time</span>,<span class="va">SEX</span>,<span class="va">AGE</span>,<span class="va">WT</span><span class="op">)</span>
<span class="va">outcovcomb</span><span class="op">$</span><span class="va">SEX</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">outcovcomb</span><span class="op">$</span><span class="va">SEX</span><span class="op">)</span>
<span class="va">outcovcomb</span><span class="op">$</span><span class="va">SEX</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">outcovcomb</span><span class="op">$</span><span class="va">SEX</span>,labels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Girls"</span>,<span class="st">"Boys"</span><span class="op">)</span><span class="op">)</span>

<span class="va">f</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">xcat</span>, <span class="va">which</span>, <span class="va">what</span>, <span class="va">from</span>, <span class="va">to</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span>
   <span class="va">what</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">sub</a></span><span class="op">(</span><span class="st">"of "</span>, <span class="st">"of\n"</span>, <span class="va">what</span><span class="op">)</span>
   <span class="va">what</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">sub</a></span><span class="op">(</span><span class="st">"median "</span>, <span class="st">"median\n"</span>, <span class="va">what</span><span class="op">)</span>
   <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html">sprintf</a></span><span class="op">(</span><span class="st">"%s %s [%s to %s["</span>,
       <span class="va">which</span>, <span class="va">what</span>, <span class="fu">signif_pad</span><span class="op">(</span><span class="va">from</span>, <span class="fl">3</span>, <span class="cn">FALSE</span><span class="op">)</span>, <span class="fu">signif_pad</span><span class="op">(</span><span class="va">to</span>, <span class="fl">3</span>, <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>
 <span class="va">p3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span><span class="va">outcovcomb</span> ,
       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">CP</span>, group <span class="op">=</span> <span class="va">ID</span>,color<span class="op">=</span><span class="va">SEX</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.1</span>, size <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html">facet_grid</a></span><span class="op">(</span>  <span class="fu">table1</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/table1/man/eqcut.html">eqcut</a></span><span class="op">(</span><span class="va">AGE</span>,<span class="fl">2</span>,<span class="va">f</span><span class="op">)</span>  <span class="op">~</span> <span class="fu">table1</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/table1/man/eqcut.html">eqcut</a></span><span class="op">(</span><span class="va">WT</span>,<span class="fl">4</span>,<span class="va">f</span><span class="op">)</span> <span class="op">)</span> <span class="op">+</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>y <span class="op">=</span> <span class="st">"Plasma Concentrations"</span>, color <span class="op">=</span> <span class="st">"Sex"</span>, x <span class="op">=</span> <span class="st">"Time (h)"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>strip.placement <span class="op">=</span> <span class="st">"outside"</span>,legend.position <span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.9</span>,<span class="fl">0.2</span><span class="op">)</span>,
  legend.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html">guides</a></span><span class="op">(</span>colour<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html">guide_legend</a></span><span class="op">(</span>override.aes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>alpha<span class="op">=</span><span class="fl">1</span>,size<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
 <span class="va">p3</span></code></pre></div>
<p><img src="Pediatric_Cov_Sim_files/figure-html/simcovariatemodelpk-1.png" width="672"></p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">out.df.multivariatecov</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="va">outcovcomb</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">ID</span>,<span class="va">time</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">ID</span>,<span class="va">SEX</span>,<span class="va">AGE</span>,<span class="va">WT</span><span class="op">)</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span> <span class="op">(</span>Cmax <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">CP</span>,na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,
             AUC<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diff.html">diff</a></span><span class="op">(</span><span class="va">time</span> <span class="op">)</span> <span class="op">*</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/na.omit.data.table.html">na.omit</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/lead-lag.html">lead</a></span><span class="op">(</span><span class="va">CP</span><span class="op">)</span> <span class="op">+</span> <span class="va">CP</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span><span class="op">)</span> 

<span class="va">out.df.multivariatecov.long</span> <span class="op">&lt;-</span> <span class="va">out.df.multivariatecov</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu">gather</span><span class="op">(</span><span class="va">paramname</span>,<span class="va">paramvalue</span>,<span class="va">Cmax</span>,<span class="va">AUC</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span> <span class="op">(</span><span class="va">paramname</span>,<span class="va">SEX</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>medparam <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html">median</a></span><span class="op">(</span><span class="va">paramvalue</span><span class="op">)</span>,
         paramvalue <span class="op">=</span> <span class="va">paramvalue</span> <span class="op">/</span> <span class="va">medparam</span><span class="op">)</span> 
<span class="va">out.df.multivariatecov.long</span><span class="op">$</span><span class="va">SEXLABEL</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">out.df.multivariatecov.long</span><span class="op">$</span><span class="va">SEX</span>,
                                               labels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Girls"</span>,<span class="st">"Boys"</span><span class="op">)</span><span class="op">)</span>

<span class="va">nca.summaries</span> <span class="op">&lt;-</span> <span class="va">out.df.multivariatecov.long</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>REF <span class="op">=</span> <span class="st">"All Subjects"</span><span class="op">)</span>

<span class="va">nca.summaries</span><span class="op">$</span><span class="va">WTCAT3</span> <span class="op">&lt;-</span> <span class="fu">table1</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/table1/man/eqcut.html">eqcut</a></span><span class="op">(</span> <span class="va">nca.summaries</span><span class="op">$</span><span class="va">WT</span>,<span class="fl">3</span>,varlabel <span class="op">=</span> <span class="st">"Weight"</span><span class="op">)</span>
<span class="va">nca.summaries</span><span class="op">$</span><span class="va">WTCAT4</span> <span class="op">&lt;-</span> <span class="fu">table1</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/table1/man/eqcut.html">eqcut</a></span><span class="op">(</span> <span class="va">nca.summaries</span><span class="op">$</span><span class="va">WT</span>,<span class="fl">4</span>,varlabel <span class="op">=</span> <span class="st">"Weight"</span><span class="op">)</span>
<span class="va">nca.summaries</span><span class="op">$</span><span class="va">AGECAT4</span> <span class="op">&lt;-</span> <span class="fu">table1</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/table1/man/eqcut.html">eqcut</a></span><span class="op">(</span> <span class="va">nca.summaries</span><span class="op">$</span><span class="va">AGE</span>,<span class="fl">4</span>,varlabel <span class="op">=</span> <span class="st">"Age"</span><span class="op">)</span>

<span class="va">nca.summaries</span><span class="op">$</span><span class="va">AGECAT4_label</span> <span class="op">&lt;-</span> <span class="va">nca.summaries</span><span class="op">$</span><span class="va">AGECAT4</span> 


<span class="va">f</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">xcat</span>, <span class="va">which</span>, <span class="va">what</span>, <span class="va">from</span>, <span class="va">to</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">what</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">sub</a></span><span class="op">(</span><span class="st">"of "</span>, <span class="st">"of\n"</span>, <span class="va">what</span><span class="op">)</span>
  <span class="va">what</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">sub</a></span><span class="op">(</span><span class="st">"median "</span>, <span class="st">"median\n"</span>, <span class="va">what</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html">sprintf</a></span><span class="op">(</span><span class="st">"%s %s [%s to %s["</span>,
          <span class="va">which</span>, <span class="va">what</span>, <span class="fu">signif_pad</span><span class="op">(</span><span class="va">from</span>, <span class="fl">3</span>, <span class="cn">FALSE</span><span class="op">)</span>, <span class="fu">signif_pad</span><span class="op">(</span><span class="va">to</span>, <span class="fl">3</span>, <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span>
 <span class="op">}</span>


<span class="va">plot1</span> <span class="op">&lt;-</span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">nca.summaries</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
                    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">WT</span><span class="op">&lt;=</span><span class="fl">25</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
                    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">WT</span><span class="op">&gt;</span><span class="fl">12</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
                    <span class="fu">gather</span><span class="op">(</span><span class="va">key</span>,<span class="va">value</span>,<span class="va">WT</span>,<span class="va">AGE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
                    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>key <span class="op">=</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/fifelse.html">ifelse</a></span><span class="op">(</span><span class="va">key</span><span class="op">==</span><span class="st">"WT"</span>,<span class="st">"Weight (kg)"</span>, <span class="st">"Age (years)"</span><span class="op">)</span><span class="op">)</span> ,
                  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">value</span>,y<span class="op">=</span><span class="va">paramvalue</span>,fill<span class="op">=</span> <span class="va">SEX</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span><span class="op">(</span><span class="st">"rect"</span>,
           ymin  <span class="op">=</span> <span class="fl">0.6</span>,
           ymax  <span class="op">=</span> <span class="fl">1.4</span>,
           xmin  <span class="op">=</span> <span class="op">-</span><span class="cn">Inf</span>,
           xmax  <span class="op">=</span> <span class="cn">Inf</span>,
           fill  <span class="op">=</span> <span class="st">"gray"</span>,
           alpha <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_hline</a></span><span class="op">(</span>data<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span> <span class="op">(</span>yintercept<span class="op">=</span><span class="fl">1</span><span class="op">)</span>,  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>yintercept <span class="op">=</span><span class="va">yintercept</span>  <span class="op">)</span>,size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.2</span>, size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">stat_quant_band</span><span class="op">(</span>method <span class="op">=</span> <span class="st">"rqss"</span>,formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="fu">qss</span><span class="op">(</span><span class="va">x</span>, lambda <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,
                   quantiles <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.05</span>, <span class="fl">0.5</span>, <span class="fl">0.95</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"black"</span>,<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>fill<span class="op">=</span><span class="va">SEX</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
   <span class="fu">facet_nested</span><span class="op">(</span><span class="va">SEX</span><span class="op">~</span><span class="va">paramname</span><span class="op">+</span><span class="va">key</span>,scales<span class="op">=</span><span class="st">"free"</span>,switch <span class="op">=</span> <span class="st">"both"</span><span class="op">)</span><span class="op">+</span>
  <span class="co">#stat_quantile()+</span>
  <span class="co">#facet_grid(SEX~key,scales="free",switch = "both")+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">18</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x<span class="op">=</span><span class="st">""</span>,y<span class="op">=</span><span class="st">"Standardized PK Exposure"</span>, fill <span class="op">=</span><span class="st">"Smoothed 90%\nquantreg intervals"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>strip.placement <span class="op">=</span> <span class="st">"outside"</span>,legend.position <span class="op">=</span> <span class="st">"none"</span>,axis.title.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_log10</a></span><span class="op">(</span>  breaks <span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.25</span>,<span class="fl">0.5</span>,<span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html">coord_cartesian</a></span><span class="op">(</span>ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.25</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span>

<span class="va">plot1</span></code></pre></div>
<p><img src="Pediatric_Cov_Sim_files/figure-html/simcovariatemodelpkparam-1.png" width="768"></p>
</div>
<div id="pk-parameters-summaries-and-distribution-plots" class="section level2">
<h2 class="hasAnchor">
<a href="#pk-parameters-summaries-and-distribution-plots" class="anchor"></a>PK Parameters Summaries and Distribution Plots</h2>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">nca.summaries.long</span> <span class="op">&lt;-</span> <span class="fu">gather</span><span class="op">(</span><span class="va">nca.summaries</span>,
                             <span class="va">covname</span>,
                             <span class="va">covvalue</span>,<span class="va">REF</span>,<span class="va">WTCAT3</span>,<span class="va">WTCAT4</span>,<span class="va">AGECAT4</span>,<span class="va">SEX</span>,
                             factor_key <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="va">nca.summaries.long</span><span class="op">$</span><span class="va">covvalue</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span> <span class="va">nca.summaries.long</span><span class="op">$</span><span class="va">covvalue</span><span class="op">)</span>
<span class="va">nca.summaries.long</span><span class="op">$</span><span class="va">covvalue</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/reorder.factor.html">reorder</a></span><span class="op">(</span><span class="va">nca.summaries.long</span><span class="op">$</span><span class="va">covvalue</span>,<span class="va">nca.summaries.long</span><span class="op">$</span><span class="va">paramvalue</span><span class="op">)</span>

<span class="va">ggridgesplot</span><span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">nca.summaries.long</span>,
        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">paramvalue</span>,y<span class="op">=</span><span class="va">covvalue</span>,fill<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">..quantile..</span><span class="op">)</span>,height<span class="op">=</span><span class="va">..ndensity..</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
   <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html">facet_grid</a></span><span class="op">(</span><span class="va">covname</span><span class="op">~</span><span class="va">paramname</span>,scales<span class="op">=</span><span class="st">"free_y"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span><span class="op">(</span><span class="st">"rect"</span>,
    xmin  <span class="op">=</span> <span class="fl">0.8</span>,
    xmax  <span class="op">=</span> <span class="fl">1.25</span>,
    ymin  <span class="op">=</span> <span class="op">-</span><span class="cn">Inf</span>,
    ymax  <span class="op">=</span> <span class="cn">Inf</span>,
    fill  <span class="op">=</span> <span class="st">"gray"</span>,
    alpha <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span> <span class="op">+</span>
   <span class="fu">stat_density_ridges</span><span class="op">(</span>
     geom <span class="op">=</span> <span class="st">"density_ridges_gradient"</span>, calc_ecdf <span class="op">=</span> <span class="cn">TRUE</span>,
     quantile_lines <span class="op">=</span> <span class="cn">TRUE</span>, rel_min_height <span class="op">=</span> <span class="fl">0.01</span>,scale<span class="op">=</span><span class="fl">0.9</span>,
     quantiles <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.05</span>,<span class="fl">0.5</span>, <span class="fl">0.95</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
   <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_fill_manual</a></span><span class="op">(</span>
     name <span class="op">=</span> <span class="st">"Probability"</span>, values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"white"</span>,<span class="st">"#0000FFA0"</span>, <span class="st">"#0000FFA0"</span>, <span class="st">"white"</span><span class="op">)</span>,
     labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"(0, 0.05]"</span>, <span class="st">"(0.05, 0.5]"</span>,<span class="st">"(0.5, 0.95]"</span>, <span class="st">"(0.95, 1]"</span><span class="op">)</span>
   <span class="op">)</span><span class="op">+</span>
   <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_vline</a></span><span class="op">(</span>data<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span> <span class="op">(</span>xintercept<span class="op">=</span><span class="fl">1</span><span class="op">)</span>,  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>xintercept <span class="op">=</span><span class="va">xintercept</span>  <span class="op">)</span>,size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">+</span>
   <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
   <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x<span class="op">=</span><span class="st">"Effects Of Covariates on PK Parameter"</span>,y<span class="op">=</span><span class="st">""</span><span class="op">)</span>
<span class="va">ggridgesplot</span></code></pre></div>
<p><img src="Pediatric_Cov_Sim_files/figure-html/computenca-1.png" width="672"></p>
</div>
<div id="a-forest-plot-with-a-side-table" class="section level2">
<h2 class="hasAnchor">
<a href="#a-forest-plot-with-a-side-table" class="anchor"></a>A Forest Plot with a Side Table</h2>
<p>Similarly to previous sections, we prepare the data to use <code>forest_plot</code>. We provide a two parameters plot illustrating some of the options.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">coveffectsdatacovrep</span> <span class="op">&lt;-</span> <span class="va">nca.summaries.long</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">paramname</span>,<span class="va">covname</span>,<span class="va">covvalue</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>
    mid<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html">median</a></span><span class="op">(</span><span class="va">paramvalue</span><span class="op">)</span>,
    lower<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">paramvalue</span>,<span class="fl">0.05</span><span class="op">)</span>,
    upper <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">paramvalue</span>,<span class="fl">0.95</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">mid</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">covname</span> <span class="op">!=</span><span class="st">"WTCAT4"</span><span class="op">)</span>

<span class="va">bsvranges</span> <span class="op">&lt;-</span> <span class="va">refbsv</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    P05 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">stdparamvalue</span>, <span class="fl">0.05</span><span class="op">)</span>,
    P25 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">stdparamvalue</span>, <span class="fl">0.25</span><span class="op">)</span>,
    P50 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">stdparamvalue</span>, <span class="fl">0.5</span><span class="op">)</span>,
    P75 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">stdparamvalue</span>, <span class="fl">0.75</span><span class="op">)</span>,
    P95 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">stdparamvalue</span>, <span class="fl">0.95</span><span class="op">)</span><span class="op">)</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">paramname</span><span class="op">)</span><span class="op">]</span>

<span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/setkey.html">setkey</a></span><span class="op">(</span><span class="va">bsvranges</span>, <span class="va">paramname</span><span class="op">)</span>

<span class="va">coveffectsdatacovrepbsv</span> <span class="op">&lt;-</span> <span class="va">coveffectsdatacovrep</span><span class="op">[</span><span class="va">coveffectsdatacovrep</span><span class="op">$</span><span class="va">covname</span><span class="op">==</span><span class="st">"REF"</span>,<span class="op">]</span>
<span class="va">coveffectsdatacovrepbsv</span><span class="op">$</span><span class="va">covname</span> <span class="op">&lt;-</span> <span class="st">"BSV"</span>
<span class="va">coveffectsdatacovrepbsv</span><span class="op">$</span><span class="va">covvalue</span> <span class="op">&lt;-</span> <span class="st">"90% of patients"</span>
<span class="va">coveffectsdatacovrepbsv</span><span class="op">$</span><span class="va">label</span> <span class="op">&lt;-</span>    <span class="st">"90% of patients"</span>
<span class="va">coveffectsdatacovrepbsv</span><span class="op">$</span><span class="va">lower</span> <span class="op">&lt;-</span> <span class="va">bsvranges</span><span class="op">$</span><span class="va">P05</span>
<span class="va">coveffectsdatacovrepbsv</span><span class="op">$</span><span class="va">upper</span> <span class="op">&lt;-</span> <span class="va">bsvranges</span><span class="op">$</span><span class="va">P95</span>
<span class="va">coveffectsdatacovrepbsv2</span> <span class="op">&lt;-</span> <span class="va">coveffectsdatacovrep</span><span class="op">[</span><span class="va">coveffectsdatacovrep</span><span class="op">$</span><span class="va">covname</span><span class="op">==</span><span class="st">"REF"</span>,<span class="op">]</span>
<span class="va">coveffectsdatacovrepbsv2</span><span class="op">$</span><span class="va">covname</span> <span class="op">&lt;-</span> <span class="st">"BSV"</span>
<span class="va">coveffectsdatacovrepbsv2</span><span class="op">$</span><span class="va">covvalue</span> <span class="op">&lt;-</span> <span class="st">"50% of patients"</span>
<span class="va">coveffectsdatacovrepbsv2</span><span class="op">$</span><span class="va">label</span> <span class="op">&lt;-</span>    <span class="st">"50% of patients"</span>
<span class="va">coveffectsdatacovrepbsv2</span><span class="op">$</span><span class="va">lower</span> <span class="op">&lt;-</span> <span class="va">bsvranges</span><span class="op">$</span><span class="va">P25</span>
<span class="va">coveffectsdatacovrepbsv2</span><span class="op">$</span><span class="va">upper</span> <span class="op">&lt;-</span> <span class="va">bsvranges</span><span class="op">$</span><span class="va">P75</span>

<span class="va">coveffectsdatacovrepbsv</span> <span class="op">&lt;-</span> <span class="va">coveffectsdatacovrep</span>

<span class="va">coveffectsdatacovrepbsv</span> <span class="op">&lt;-</span> <span class="va">coveffectsdatacovrepbsv</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>
    label <span class="op">=</span> <span class="va">covvalue</span>,
    LABEL <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">mid</span>,<span class="fl">2</span><span class="op">)</span>, nsmall <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,
                   <span class="st">" ["</span>, <span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">lower</span>,<span class="fl">2</span><span class="op">)</span>, nsmall <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>, <span class="st">"-"</span>,
                   <span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">upper</span>,<span class="fl">2</span><span class="op">)</span>, nsmall <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>, <span class="st">"]"</span><span class="op">)</span><span class="op">)</span>
<span class="va">coveffectsdatacovrepbsv</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="va">coveffectsdatacovrepbsv</span><span class="op">)</span>

<span class="va">coveffectsdatacovrepbsv</span><span class="op">$</span><span class="va">label</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">": "</span>, <span class="st">":\n"</span>, <span class="va">coveffectsdatacovrepbsv</span><span class="op">$</span><span class="va">label</span><span class="op">)</span>

<span class="va">coveffectsdatacovrepbsv</span><span class="op">$</span><span class="va">covname</span> <span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">coveffectsdatacovrepbsv</span><span class="op">$</span><span class="va">covname</span> <span class="op">)</span>,
                  levels <span class="op">=</span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"WTCAT3"</span>,<span class="st">"AGECAT4"</span>,<span class="st">"SEX"</span>,<span class="st">"REF"</span><span class="op">)</span>,
                   labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Weight\nSplits"</span>,<span class="st">"Age\nSplits"</span>,<span class="st">"Sex\nSplits"</span>,<span class="st">"All"</span><span class="op">)</span><span class="op">)</span>


<span class="va">coveffectsdatacovrepbsv</span><span class="op">$</span><span class="va">label</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">coveffectsdatacovrepbsv</span><span class="op">$</span><span class="va">label</span><span class="op">)</span>
<span class="va">coveffectsdatacovrepbsv</span><span class="op">$</span><span class="va">label</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">coveffectsdatacovrepbsv</span><span class="op">$</span><span class="va">label</span>,
                                        levels <span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>
                                            <span class="st">"1st quartile of Age:\n[2.00,2.96)"</span>
                                          , <span class="st">"2nd quartile of Age:\n[2.96,3.96)"</span>
                                          , <span class="st">"3rd quartile of Age:\n[3.96,4.96)"</span>
                                          , <span class="st">"4th quartile of Age:\n[4.96,5.96]"</span> 
                                          , <span class="st">"Boys"</span>, <span class="st">"Girls"</span>, <span class="st">"All Subjects"</span>
                                          , <span class="st">"1st tertile of Weight:\n[9.40,14.6)"</span>
                                          , <span class="st">"2nd tertile of Weight:\n[14.6,17.4)"</span>
                                          , <span class="st">"3rd tertile of Weight:\n[17.4,38.2]"</span>
                                        <span class="op">)</span><span class="op">)</span>
<span class="va">interval_bsv_text</span> <span class="op">=</span> <span class="st">""</span>
<span class="va">ref_legend_text</span> <span class="op">=</span> <span class="st">"Reference (vertical line)\nClinically relevant limits\n(gray area)"</span>
<span class="va">interval_legend_text</span> <span class="op">&lt;-</span> <span class="st">"Median (points)\n90% intervals (horizontal lines) of joint effects:
covariate distributions, uncertainty\nand between subject variability"</span>

<span class="fu"><a href="https://rdrr.io/r/grDevices/png.html">png</a></span><span class="op">(</span><span class="st">"./Figure_7_4.png"</span>,width <span class="op">=</span> <span class="fl">11</span> ,height <span class="op">=</span> <span class="fl">7</span>,units <span class="op">=</span> <span class="st">"in"</span>,res<span class="op">=</span><span class="fl">72</span><span class="op">)</span>
<span class="fu">coveffectsplot</span><span class="fu">::</span><span class="fu"><a href="../reference/forest_plot.html">forest_plot</a></span><span class="op">(</span><span class="va">coveffectsdatacovrepbsv</span>,
                            ref_area <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.6</span>, <span class="fl">1</span><span class="op">/</span><span class="fl">0.6</span><span class="op">)</span>,
                            x_range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.4</span>,<span class="fl">2.2</span><span class="op">)</span>,
                            strip_placement <span class="op">=</span> <span class="st">"outside"</span>,
                            base_size <span class="op">=</span> <span class="fl">18</span>,
                            y_label_text_size <span class="op">=</span> <span class="fl">10</span>,x_label_text_size <span class="op">=</span> <span class="fl">10</span>,
                            xlabel <span class="op">=</span> <span class="st">"Fold Change Relative to Reference"</span>,
                            ref_legend_text <span class="op">=</span><span class="va">ref_legend_text</span>,
                            area_legend_text <span class="op">=</span><span class="va">ref_legend_text</span> ,
                            interval_legend_text <span class="op">=</span> <span class="va">interval_legend_text</span>,
                            interval_bsv_text <span class="op">=</span> <span class="va">interval_bsv_text</span>,
                            plot_title <span class="op">=</span> <span class="st">""</span>,
                            legend_shape_reverse <span class="op">=</span> <span class="cn">TRUE</span>,
                            facet_formula <span class="op">=</span> <span class="st">"covname~."</span>,
                            facet_switch <span class="op">=</span> <span class="st">"both"</span>,
                            table_facet_switch <span class="op">=</span> <span class="st">"both"</span>,
                            reserve_table_xaxis_label_space <span class="op">=</span> <span class="cn">TRUE</span>,
                            facet_scales <span class="op">=</span> <span class="st">"free_y"</span>, facet_space <span class="op">=</span> <span class="st">"free"</span>,
                            paramname_shape <span class="op">=</span> <span class="cn">TRUE</span>,
                            table_position <span class="op">=</span> <span class="st">"right"</span>,
                            table_text_size<span class="op">=</span> <span class="fl">4</span>,
                            plot_table_ratio <span class="op">=</span> <span class="fl">5</span>,
                            show_table_facet_strip <span class="op">=</span> <span class="st">"x"</span>,
                            show_table_yaxis_tick_label <span class="op">=</span> <span class="cn">FALSE</span>,
                            logxscale <span class="op">=</span> <span class="cn">TRUE</span>,
                            major_x_ticks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.5</span>,<span class="fl">0.8</span>,<span class="fl">1</span><span class="op">/</span><span class="fl">0.8</span>,<span class="fl">1</span><span class="op">/</span><span class="fl">0.5</span><span class="op">)</span>,
                            return_list <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html">dev.off</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; agg_png </span>
<span class="co">#&gt;       2</span></code></pre></div>
<div class="figure">
<img src="Figure_7_4.png" alt=""><p class="caption">Covariate Effects Plot.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Samer Mouksassi.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
