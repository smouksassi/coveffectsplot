<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PK Model: Assessing the Impact of Joint Covariates Distributions and BSV on Drug Exposure â€¢ coveffectsplot</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/united/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="PK Model: Assessing the Impact of Joint Covariates Distributions and BSV on Drug Exposure">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">coveffectsplot</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.0.7</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Vignettes

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/introduction_to_coveffectsplot.html">Introduction to coveffectsplot</a>
    </li>
    <li>
      <a href="../articles/Exposure_Response_Example.html">Exposure-Response Example</a>
    </li>
    <li>
      <a href="../articles/PK_Example.html">PK Example</a>
    </li>
    <li>
      <a href="../articles/PK_Example_full.html">PK Example Full</a>
    </li>
    <li>
      <a href="../articles/Pediatric_Cov_Sim.html">PK Pediatric Example</a>
    </li>
    <li>
      <a href="../articles/PKPD_Example.html">PKPD Example</a>
    </li>
  </ul>
</li>
<li>
  <a href="../articles/app.html">Shiny App</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/smouksassi/coveffectsplot/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>PK Model: Assessing the Impact of Joint
Covariates Distributions and BSV on Drug Exposure</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/smouksassi/coveffectsplot/blob/main/vignettes/PK_Example_full.Rmd" class="external-link"><code>vignettes/PK_Example_full.Rmd</code></a></small>
      <div class="hidden name"><code>PK_Example_full.Rmd</code></div>

    </div>

    
    
<p>Here we illustrate the full distribution of covariates + BSV
approach. A two-compartment pharmacokinetic (PK) model defined with
ordinary differential equations (ODEs) is used. Covariates Weight,
Albumin and Sex had effects on the Clearance (CL) model parameter while
Weight and Sex had effects on the Volume of distribution (V) model
parameter. For simplicity, there were no included covariates effects on
other PK parameters such as peripheral clearance or volume. The approach
is general and can be easily extended to any other ODEs model with
multiple covariate effects on multiple model parameters.</p>
<div class="section level2">
<h2 id="specifying-a-pk-model-using-mrgsolve">Specifying a PK Model using <code>mrgsolve</code><a class="anchor" aria-label="anchor" href="#specifying-a-pk-model-using-mrgsolve"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">codepkmodelcov</span> <span class="op">&lt;-</span> <span class="st">'</span></span>
<span><span class="st">$PARAM @annotated</span></span>
<span><span class="st">KA    : 0.5   : Absorption rate constant Ka (1/h)</span></span>
<span><span class="st">CL    : 4     : Clearance CL (L/h)</span></span>
<span><span class="st">V     : 10    : Central volume Vc (L)</span></span>
<span><span class="st">Vp    : 50    : Peripheral volume Vp (L)</span></span>
<span><span class="st">Qp    : 10    : Intercompartmental clearance Q (L/h)</span></span>
<span><span class="st">CLALB : -0.8  : Ablumin on CL (ref. 45 g/L)</span></span>
<span><span class="st">CLSEX : 0.2   : Sex on CL (ref. Female)</span></span>
<span><span class="st">CLWT  : 1     : Weight on CL (ref. 85 kg)</span></span>
<span><span class="st">VSEX  : 0.07  : Sex on Vc (ref. Female)</span></span>
<span><span class="st">VWT   : 1     : Weight on Vc (ref. 85 kg)</span></span>
<span><span class="st"></span></span>
<span><span class="st">$PARAM @annotated // reference values for covariate</span></span>
<span><span class="st">WT    : 85    : Weight (kg)</span></span>
<span><span class="st">SEX   : 0     : Sex (0=Female, 1=Male)</span></span>
<span><span class="st">ALB   : 45    : Albumin (g/L)</span></span>
<span><span class="st"></span></span>
<span><span class="st">$PKMODEL cmt="GUT CENT PER", depot=TRUE, trans=11</span></span>
<span><span class="st"></span></span>
<span><span class="st">$MAIN</span></span>
<span><span class="st">double CLi = CL *</span></span>
<span><span class="st">    pow((ALB/45.0), CLALB)*</span></span>
<span><span class="st">    (SEX == 1.0 ? (1.0+CLSEX) : 1.0)*</span></span>
<span><span class="st">    pow((WT/85.0), CLWT)*exp(nCL); </span></span>
<span><span class="st">double V2i = V *</span></span>
<span><span class="st">    (SEX == 1.0 ? (1.0+VSEX) : 1.0)*</span></span>
<span><span class="st">    pow((WT/85.0), VWT)*exp(nVC);  </span></span>
<span><span class="st"></span></span>
<span><span class="st">double KAi = KA;</span></span>
<span><span class="st">double V3i = Vp *pow((WT/85.0),    1);</span></span>
<span><span class="st">double Qi = Qp *pow((WT/85.0), 0.75);</span></span>
<span><span class="st"></span></span>
<span><span class="st">$OMEGA @annotated @block</span></span>
<span><span class="st">nCL : 0.09       : ETA on CL</span></span>
<span><span class="st">nVC : 0.01 0.09  : ETA on Vc</span></span>
<span><span class="st"></span></span>
<span><span class="st">$TABLE</span></span>
<span><span class="st">double CP   = CENT/V2i;</span></span>
<span><span class="st"></span></span>
<span><span class="st">$CAPTURE CP KAi CLi V2i V3i Qi WT SEX ALB</span></span>
<span><span class="st">'</span></span>
<span><span class="va">modcovsim</span> <span class="op">&lt;-</span> <span class="fu">mcode</span><span class="op">(</span><span class="st">"codepkmodelcov"</span>, <span class="va">codepkmodelcov</span><span class="op">)</span></span>
<span></span>
<span><span class="va">partab</span> <span class="op">&lt;-</span> <span class="fu">setDT</span><span class="op">(</span><span class="va">modcovsim</span><span class="op">@</span><span class="va">annot</span><span class="op">$</span><span class="va">data</span><span class="op">)</span><span class="op">[</span><span class="va">block</span><span class="op">==</span><span class="st">"PARAM"</span>, <span class="fu">.</span><span class="op">(</span><span class="va">name</span>, <span class="va">descr</span>, <span class="va">unit</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">partab</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="va">partab</span>, <span class="fu">melt</span><span class="op">(</span><span class="fu">setDT</span><span class="op">(</span><span class="va">modcovsim</span><span class="op">@</span><span class="va">param</span><span class="op">@</span><span class="va">data</span><span class="op">)</span>, meas<span class="op">=</span><span class="fu">patterns</span><span class="op">(</span><span class="st">"*"</span><span class="op">)</span>, var<span class="op">=</span><span class="st">"name"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">partab</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">name</th>
<th align="left">descr</th>
<th align="left">unit</th>
<th align="right">value</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">ALB</td>
<td align="left">Albumin</td>
<td align="left">g/L</td>
<td align="right">45.00</td>
</tr>
<tr class="even">
<td align="left">CL</td>
<td align="left">Clearance CL</td>
<td align="left">L/h</td>
<td align="right">4.00</td>
</tr>
<tr class="odd">
<td align="left">CLALB</td>
<td align="left">Ablumin on CL</td>
<td align="left">ref. 45 g/L</td>
<td align="right">-0.80</td>
</tr>
<tr class="even">
<td align="left">CLSEX</td>
<td align="left">Sex on CL</td>
<td align="left">ref. Female</td>
<td align="right">0.20</td>
</tr>
<tr class="odd">
<td align="left">CLWT</td>
<td align="left">Weight on CL</td>
<td align="left">ref. 85 kg</td>
<td align="right">1.00</td>
</tr>
<tr class="even">
<td align="left">KA</td>
<td align="left">Absorption rate constant Ka</td>
<td align="left">1/h</td>
<td align="right">0.50</td>
</tr>
<tr class="odd">
<td align="left">Qp</td>
<td align="left">Intercompartmental clearance Q</td>
<td align="left">L/h</td>
<td align="right">10.00</td>
</tr>
<tr class="even">
<td align="left">SEX</td>
<td align="left">Sex</td>
<td align="left">0=Female, 1=Male</td>
<td align="right">0.00</td>
</tr>
<tr class="odd">
<td align="left">V</td>
<td align="left">Central volume Vc</td>
<td align="left">L</td>
<td align="right">10.00</td>
</tr>
<tr class="even">
<td align="left">VSEX</td>
<td align="left">Sex on Vc</td>
<td align="left">ref. Female</td>
<td align="right">0.07</td>
</tr>
<tr class="odd">
<td align="left">VWT</td>
<td align="left">Weight on Vc</td>
<td align="left">ref. 85 kg</td>
<td align="right">1.00</td>
</tr>
<tr class="even">
<td align="left">Vp</td>
<td align="left">Peripheral volume Vp</td>
<td align="left">L</td>
<td align="right">50.00</td>
</tr>
<tr class="odd">
<td align="left">WT</td>
<td align="left">Weight</td>
<td align="left">kg</td>
<td align="right">85.00</td>
</tr>
</tbody>
</table>
<div class="section level3">
<h3 id="simulate-a-reference-subjects-with-bsv">Simulate a Reference Subjects with BSV<a class="anchor" aria-label="anchor" href="#simulate-a-reference-subjects-with-bsv"></a>
</h3>
<p>We simulate the reference subject having the reference covariate
values defined in the model which are:<br>
Weight = 85 kg, Sex = Female and Albumin = 45 g/L. We also keep the
between subject variability (BSV) to illustrate its effects on the
concentration-time profiles on linear and log linear scales.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">idata</span> <span class="op">&lt;-</span> <span class="fu">data.table</span><span class="op">(</span>ID<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="va">nbsvsubjects</span>, WT<span class="op">=</span><span class="fl">85</span>, SEX<span class="op">=</span><span class="fl">0</span>, ALB<span class="op">=</span><span class="fl">45</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ev1</span> <span class="op">&lt;-</span> <span class="fu">ev</span><span class="op">(</span>time <span class="op">=</span> <span class="fl">0</span>, amt <span class="op">=</span> <span class="fl">100</span>, cmt <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">data.dose</span> <span class="op">&lt;-</span> <span class="fu">ev</span><span class="op">(</span><span class="va">ev1</span><span class="op">)</span></span>
<span><span class="va">data.dose</span> <span class="op">&lt;-</span> <span class="fu">setDT</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">data.dose</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">data.all</span> <span class="op">&lt;-</span> <span class="fu">data.table</span><span class="op">(</span><span class="va">idata</span>, <span class="va">data.dose</span><span class="op">)</span></span>
<span></span>
<span><span class="va">outputsim</span> <span class="op">&lt;-</span> <span class="va">modcovsim</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">data_set</span><span class="op">(</span><span class="va">data.all</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">mrgsim</span><span class="op">(</span>end <span class="op">=</span> <span class="fl">24</span>, delta <span class="op">=</span> <span class="fl">0.25</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="va">as.data.frame</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="va">as.data.table</span></span>
<span></span>
<span><span class="va">outputsim</span><span class="op">$</span><span class="va">SEX</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">outputsim</span><span class="op">$</span><span class="va">SEX</span>, labels<span class="op">=</span><span class="st">"Female"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Only plot a random sample of N=500</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">678549</span><span class="op">)</span></span>
<span><span class="va">plotdata</span> <span class="op">&lt;-</span> <span class="va">outputsim</span><span class="op">[</span><span class="va">ID</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">ID</span><span class="op">)</span>, <span class="fl">500</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># New facet label names for dose variable</span></span>
<span><span class="va">albumin.labs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"albumin: 45 ng/mL"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">albumin.labs</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"45"</span><span class="op">)</span></span>
<span><span class="va">wt.labs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"weight: 85 kg"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">wt.labs</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"85"</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">plotdata</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">CP</span>, group <span class="op">=</span> <span class="va">ID</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.2</span>, size <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span><span class="op">~</span> <span class="va">WT</span> <span class="op">+</span> <span class="va">ALB</span> <span class="op">+</span> <span class="va">SEX</span>,</span>
<span>             labeller <span class="op">=</span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labeller.html" class="external-link">labeller</a></span><span class="op">(</span>ALB <span class="op">=</span> <span class="va">albumin.labs</span>,</span>
<span>                                  WT <span class="op">=</span> <span class="va">wt.labs</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>y <span class="op">=</span> <span class="st">"Plasma Concentrations"</span>, x <span class="op">=</span> <span class="st">"Time (h)"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">plotdata</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">CP</span>, group <span class="op">=</span> <span class="va">ID</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.2</span>, size <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span><span class="op">~</span> <span class="va">WT</span> <span class="op">+</span> <span class="va">ALB</span> <span class="op">+</span> <span class="va">SEX</span>,</span>
<span>             labeller <span class="op">=</span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labeller.html" class="external-link">labeller</a></span><span class="op">(</span>ALB <span class="op">=</span> <span class="va">albumin.labs</span>,</span>
<span>                                  WT <span class="op">=</span> <span class="va">wt.labs</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_log10</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>y <span class="op">=</span> <span class="st">"Plasma~Concentrations\n(logarithmic scale)"</span>, x <span class="op">=</span> <span class="st">"Time (h)"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">egg</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/egg/man/ggarrange.html" class="external-link">ggarrange</a></span><span class="op">(</span><span class="va">p1</span>, <span class="va">p2</span>, ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="PK_Example_full_files/figure-html/pksimulation-1.png" width="672"></p>
</div>
<div class="section level3">
<h3 id="compute-pk-parameters-plot-and-summarize-bsv">Compute PK Parameters, Plot and Summarize BSV<a class="anchor" aria-label="anchor" href="#compute-pk-parameters-plot-and-summarize-bsv"></a>
</h3>
<p>In this section we compute the PK parameters of interest, provide a
plot of the parameters as well as of the standardized ones. We also
summarize and report the BSV as ranges of 50 and 90% of patients for
each PK parameter. Later on we might choose to include these ranges in
the <code>coveffectsplot</code> or not.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">derive.exposure</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">time</span>, <span class="va">CP</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">time</span><span class="op">)</span></span>
<span>  <span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    Cmax <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">CP</span><span class="op">)</span>,</span>
<span>    Clast <span class="op">=</span> <span class="va">CP</span><span class="op">[</span><span class="va">n</span><span class="op">]</span>,</span>
<span>    AUC <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diff.html" class="external-link">diff</a></span><span class="op">(</span><span class="va">time</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="va">CP</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="va">CP</span><span class="op">[</span><span class="op">-</span><span class="va">n</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="fu">data.table</span><span class="op">(</span>paramname<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, paramvalue<span class="op">=</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">refbsv</span> <span class="op">&lt;-</span> <span class="va">outputsim</span><span class="op">[</span>, <span class="fu">derive.exposure</span><span class="op">(</span><span class="va">time</span>, <span class="va">CP</span><span class="op">)</span>, by<span class="op">=</span><span class="fu">.</span><span class="op">(</span><span class="va">ID</span>, <span class="va">WT</span>, <span class="va">SEX</span>, <span class="va">ALB</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="va">p3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">refbsv</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span></span>
<span>        x      <span class="op">=</span> <span class="va">paramvalue</span>,</span>
<span>        y      <span class="op">=</span> <span class="va">paramname</span>,</span>
<span>        fill   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">..quantile..</span><span class="op">)</span>,</span>
<span>        height <span class="op">=</span> <span class="va">..ndensity..</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">paramname</span>, scales<span class="op">=</span><span class="st">"free"</span>, ncol<span class="op">=</span><span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">stat_density_ridges</span><span class="op">(</span></span>
<span>    geom<span class="op">=</span><span class="st">"density_ridges_gradient"</span>, calc_ecdf<span class="op">=</span><span class="cn">TRUE</span>,</span>
<span>    quantile_lines<span class="op">=</span><span class="cn">TRUE</span>, rel_min_height<span class="op">=</span><span class="fl">0.001</span>, scale<span class="op">=</span><span class="fl">0.9</span>,</span>
<span>    quantiles<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.05</span>, <span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>, <span class="fl">0.95</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span></span>
<span>    name   <span class="op">=</span> <span class="st">"Probability"</span>,</span>
<span>    values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"white"</span>, <span class="st">"#FF000050"</span>, <span class="st">"#FF0000A0"</span>, <span class="st">"#FF0000A0"</span>, <span class="st">"#FF000050"</span>, <span class="st">"white"</span><span class="op">)</span>,</span>
<span>    labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"(0, 0.05]"</span>, <span class="st">"(0.05, 0.25]"</span>,</span>
<span>               <span class="st">"(0.25, 0.5]"</span>, <span class="st">"(0.5, 0.75]"</span>,</span>
<span>               <span class="st">"(0.75, 0.95]"</span>, <span class="st">"(0.95, 1]"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span></span>
<span>    legend.position <span class="op">=</span> <span class="st">"none"</span>,</span>
<span>    axis.text.y     <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    axis.ticks.y    <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    axis.title.y    <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x<span class="op">=</span><span class="st">"PK Parameters"</span>, y<span class="op">=</span><span class="st">""</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_log10</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html" class="external-link">coord_cartesian</a></span><span class="op">(</span>expand<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Obtain the standardized parameter value by dividing by the median.</span></span>
<span><span class="va">refbsv</span><span class="op">[</span>, <span class="va">stdparamvalue</span> <span class="op">:=</span> <span class="va">paramvalue</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span><span class="op">(</span><span class="va">paramvalue</span><span class="op">)</span>, by<span class="op">=</span><span class="va">paramname</span><span class="op">]</span></span>
<span></span>
<span><span class="va">p4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">refbsv</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span></span>
<span>        x      <span class="op">=</span> <span class="va">stdparamvalue</span>,</span>
<span>        y      <span class="op">=</span> <span class="va">paramname</span>,</span>
<span>        fill   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">..quantile..</span><span class="op">)</span>,</span>
<span>        height <span class="op">=</span> <span class="va">..ndensity..</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">paramname</span>, scales<span class="op">=</span><span class="st">"free"</span>, ncol<span class="op">=</span><span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">stat_density_ridges</span><span class="op">(</span></span>
<span>    geom<span class="op">=</span><span class="st">"density_ridges_gradient"</span>, calc_ecdf<span class="op">=</span><span class="cn">TRUE</span>,</span>
<span>    quantile_lines<span class="op">=</span><span class="cn">TRUE</span>, rel_min_height<span class="op">=</span><span class="fl">0.001</span>, scale<span class="op">=</span><span class="fl">0.9</span>,</span>
<span>    quantiles<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.05</span>, <span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>, <span class="fl">0.95</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span></span>
<span>    name<span class="op">=</span><span class="st">"Probability"</span>,</span>
<span>    values<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"white"</span>, <span class="st">"#FF000050"</span>, <span class="st">"#FF0000A0"</span>, <span class="st">"#FF0000A0"</span>, <span class="st">"#FF000050"</span>, <span class="st">"white"</span><span class="op">)</span>,</span>
<span>    labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"(0, 0.05]"</span>, <span class="st">"(0.05, 0.25]"</span>,</span>
<span>             <span class="st">"(0.25, 0.5]"</span>, <span class="st">"(0.5, 0.75]"</span>,</span>
<span>             <span class="st">"(0.75, 0.95]"</span>, <span class="st">"(0.95, 1]"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span></span>
<span>    legend.position <span class="op">=</span> <span class="st">"none"</span>,</span>
<span>    axis.text.y     <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    axis.ticks.y    <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    axis.title.y    <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x<span class="op">=</span><span class="st">"Standardized PK Parameters"</span>, y<span class="op">=</span><span class="st">""</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_log10</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html" class="external-link">coord_cartesian</a></span><span class="op">(</span>expand<span class="op">=</span><span class="cn">FALSE</span>, xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.3</span>,<span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p3</span> <span class="op">+</span> <span class="va">p4</span></span></code></pre></div>
<p><img src="PK_Example_full_files/figure-html/computenca-1.png" width="672"></p>
<p><strong>Ranges of BSV for each PK Parameter:</strong></p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bsvranges</span> <span class="op">&lt;-</span> <span class="va">refbsv</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    P05 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">stdparamvalue</span>, <span class="fl">0.05</span><span class="op">)</span>,</span>
<span>    P25 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">stdparamvalue</span>, <span class="fl">0.25</span><span class="op">)</span>,</span>
<span>    P50 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">stdparamvalue</span>, <span class="fl">0.5</span><span class="op">)</span>,</span>
<span>    P75 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">stdparamvalue</span>, <span class="fl">0.75</span><span class="op">)</span>,</span>
<span>    P95 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">stdparamvalue</span>, <span class="fl">0.95</span><span class="op">)</span><span class="op">)</span>, by <span class="op">=</span> <span class="va">paramname</span><span class="op">]</span></span>
<span><span class="va">bsvranges</span></span>
<span><span class="co">#&gt;    paramname       P05       P25   P50      P75      P95</span></span>
<span><span class="co">#&gt;       &lt;char&gt;     &lt;num&gt;     &lt;num&gt; &lt;num&gt;    &lt;num&gt;    &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:      Cmax 0.7982012 0.9162689     1 1.078929 1.191273</span></span>
<span><span class="co">#&gt; 2:     Clast 0.4591170 0.7702615     1 1.264859 1.751432</span></span>
<span><span class="co">#&gt; 3:       AUC 0.7017877 0.8815325     1 1.117071 1.318266</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="importing-realistic-distributions-of-covariates">Importing Realistic Distributions of Covariates<a class="anchor" aria-label="anchor" href="#importing-realistic-distributions-of-covariates"></a>
</h2>
<p>Here we import from a dataset named <code>covdatasim</code> available
in the package. Instead of simulating at specific covariate values we
will use the full distribution.</p>
<div class="section level3">
<h3 id="visualize-the-dataset-of-covariates">Visualize the dataset of Covariates:<a class="anchor" aria-label="anchor" href="#visualize-the-dataset-of-covariates"></a>
</h3>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">reference.values</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>WT <span class="op">=</span> <span class="fl">85</span>, ALB <span class="op">=</span> <span class="fl">45</span>, SEX <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>   </span>
<span><span class="va">covdatasim</span><span class="op">$</span><span class="va">SEX</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">covdatasim</span><span class="op">$</span><span class="va">SEX</span><span class="op">==</span><span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">0</span><span class="op">)</span></span>
<span><span class="va">covdatasim</span><span class="op">$</span><span class="va">SEX</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">covdatasim</span><span class="op">$</span><span class="va">SEX</span> <span class="op">)</span></span>
<span><span class="va">covdatasim</span><span class="op">$</span><span class="va">SEX</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">covdatasim</span><span class="op">$</span><span class="va">SEX</span>,labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Female"</span>,<span class="st">"Male"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">covdatasimpairs</span> <span class="op">&lt;-</span> <span class="va">covdatasim</span></span>
<span><span class="va">covdatasimpairs</span><span class="op">$</span><span class="va">Weight</span> <span class="op">&lt;-</span> <span class="va">covdatasimpairs</span><span class="op">$</span><span class="va">WT</span></span>
<span><span class="va">covdatasimpairs</span><span class="op">$</span><span class="va">Sex</span> <span class="op">&lt;-</span> <span class="va">covdatasimpairs</span><span class="op">$</span><span class="va">SEX</span></span>
<span><span class="va">covdatasimpairs</span><span class="op">$</span><span class="va">Albumin</span> <span class="op">&lt;-</span> <span class="va">covdatasimpairs</span><span class="op">$</span><span class="va">ALB</span></span>
<span></span>
<span><span class="va">ggpairsplot</span> <span class="op">&lt;-</span> <span class="fu">GGally</span><span class="fu">::</span><span class="fu"><a href="https://ggobi.github.io/ggally/reference/ggpairs.html" class="external-link">ggpairs</a></span><span class="op">(</span><span class="va">covdatasimpairs</span>,</span>
<span>                       columns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Weight"</span>,<span class="st">"Sex"</span>,<span class="st">"Albumin"</span><span class="op">)</span>,mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>colour<span class="op">=</span><span class="va">SEX</span><span class="op">)</span>,</span>
<span>                       diag<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>                         continuous <span class="op">=</span> <span class="fu">GGally</span><span class="fu">::</span><span class="fu"><a href="https://ggobi.github.io/ggally/reference/wrap.html" class="external-link">wrap</a></span><span class="op">(</span><span class="st">"densityDiag"</span>, alpha <span class="op">=</span> <span class="fl">0.3</span>,colour<span class="op">=</span><span class="cn">NA</span><span class="op">)</span>,</span>
<span>                         discrete   <span class="op">=</span> <span class="fu">GGally</span><span class="fu">::</span><span class="fu"><a href="https://ggobi.github.io/ggally/reference/wrap.html" class="external-link">wrap</a></span><span class="op">(</span><span class="st">"barDiag"</span>,  alpha <span class="op">=</span><span class="fl">0.3</span>, position <span class="op">=</span> <span class="st">"dodge2"</span><span class="op">)</span></span>
<span>                       <span class="op">)</span>,</span>
<span>                       lower <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>                         continuous <span class="op">=</span> <span class="fu">GGally</span><span class="fu">::</span><span class="fu"><a href="https://ggobi.github.io/ggally/reference/wrap.html" class="external-link">wrap</a></span><span class="op">(</span><span class="st">"points"</span>, alpha <span class="op">=</span> <span class="fl">0.2</span>, size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,</span>
<span>                         combo <span class="op">=</span> <span class="fu">GGally</span><span class="fu">::</span><span class="fu"><a href="https://ggobi.github.io/ggally/reference/wrap.html" class="external-link">wrap</a></span><span class="op">(</span><span class="st">"facethist"</span>, alpha <span class="op">=</span></span>
<span>                                                <span class="fl">0.2</span>, position <span class="op">=</span> <span class="st">"dodge2"</span><span class="op">)</span></span>
<span>                       <span class="op">)</span>,</span>
<span>                       upper <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>                         continuous <span class="op">=</span> <span class="fu">GGally</span><span class="fu">::</span><span class="fu"><a href="https://ggobi.github.io/ggally/reference/wrap.html" class="external-link">wrap</a></span><span class="op">(</span><span class="st">"cor"</span>, size <span class="op">=</span> <span class="fl">4.75</span>, align_percent <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>,</span>
<span>                         combo <span class="op">=</span> <span class="fu">GGally</span><span class="fu">::</span><span class="fu"><a href="https://ggobi.github.io/ggally/reference/wrap.html" class="external-link">wrap</a></span><span class="op">(</span><span class="st">"box_no_facet"</span>, alpha <span class="op">=</span><span class="fl">0.3</span><span class="op">)</span>,</span>
<span>                         discrete <span class="op">=</span> <span class="fu">GGally</span><span class="fu">::</span><span class="fu"><a href="https://ggobi.github.io/ggally/reference/wrap.html" class="external-link">wrap</a></span><span class="op">(</span><span class="st">"facetbar"</span>,  alpha <span class="op">=</span> <span class="fl">0.3</span>, position <span class="op">=</span> <span class="st">"dodge2"</span><span class="op">)</span></span>
<span>                       <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">covdatasim</span><span class="op">$</span><span class="va">SEX</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">covdatasim</span><span class="op">$</span><span class="va">SEX</span><span class="op">)</span><span class="op">-</span><span class="fl">1</span></span>
<span><span class="va">ggpairsplot</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">12</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">9</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="PK_Example_full_files/figure-html/covcomb-1.png" width="672"></p>
</div>
<div class="section level3">
<h3 id="simulation-with-full-distributions-of-covariates">Simulation With Full Distributions of Covariates<a class="anchor" aria-label="anchor" href="#simulation-with-full-distributions-of-covariates"></a>
</h3>
<p>As a first step, we simulate without uncertainty and without BSV
using <code>zero_re()</code> and provide a plot to visualize the
effects.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">idata</span> <span class="op">&lt;-</span> <span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/copy.html" class="external-link">copy</a></span><span class="op">(</span><span class="va">covdatasim</span><span class="op">)</span></span>
<span><span class="va">idata</span><span class="op">$</span><span class="va">covname</span> <span class="op">&lt;-</span>  <span class="cn">NULL</span></span>
<span><span class="va">ev1</span> <span class="op">&lt;-</span> <span class="fu">ev</span><span class="op">(</span>time<span class="op">=</span><span class="fl">0</span>, amt<span class="op">=</span><span class="fl">100</span>, cmt<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">data.dose</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">ev1</span><span class="op">)</span></span>
<span><span class="va">data.all</span> <span class="op">&lt;-</span> <span class="fu">data.table</span><span class="op">(</span><span class="va">idata</span>, <span class="va">data.dose</span><span class="op">)</span></span>
<span></span>
<span><span class="va">outcovcomb</span><span class="op">&lt;-</span> <span class="va">modcovsim</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">data_set</span><span class="op">(</span><span class="va">data.all</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">zero_re</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">mrgsim</span><span class="op">(</span>end<span class="op">=</span><span class="fl">24</span>, delta<span class="op">=</span><span class="fl">0.25</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="va">as.data.frame</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="va">as.data.table</span></span>
<span></span>
<span><span class="va">outcovcomb</span><span class="op">$</span><span class="va">SEX</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">outcovcomb</span><span class="op">$</span><span class="va">SEX</span> <span class="op">)</span></span>
<span><span class="va">outcovcomb</span><span class="op">$</span><span class="va">SEX</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">outcovcomb</span><span class="op">$</span><span class="va">SEX</span>, labels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Female"</span>, <span class="st">"Male"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">stat_sum_df</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">fun</span>, <span class="va">geom</span><span class="op">=</span><span class="st">"ribbon"</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/stat_summary.html" class="external-link">stat_summary</a></span><span class="op">(</span>fun.data <span class="op">=</span> <span class="va">fun</span>, geom <span class="op">=</span> <span class="va">geom</span>, <span class="va">...</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">stat_sum_df_line</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">fun</span>, <span class="va">geom</span><span class="op">=</span><span class="st">"line"</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/stat_summary.html" class="external-link">stat_summary</a></span><span class="op">(</span>fun.data <span class="op">=</span> <span class="va">fun</span>, geom <span class="op">=</span> <span class="va">geom</span>, <span class="va">...</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">fwt</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">xcat</span>, <span class="va">which</span>, <span class="va">what</span>, <span class="va">from</span>, <span class="va">to</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">what</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">sub</a></span><span class="op">(</span><span class="st">"WT"</span>, <span class="st">"\nWeight"</span>, <span class="va">what</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"%s %s [%s to %s["</span>,</span>
<span>          <span class="va">which</span>, <span class="va">what</span>, <span class="fu">signif_pad</span><span class="op">(</span><span class="va">from</span>, <span class="fl">3</span>, <span class="cn">FALSE</span><span class="op">)</span>, <span class="fu">signif_pad</span><span class="op">(</span><span class="va">to</span>, <span class="fl">3</span>, <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">f</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">xcat</span>, <span class="va">which</span>, <span class="va">what</span>, <span class="va">from</span>, <span class="va">to</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">what</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">sub</a></span><span class="op">(</span><span class="st">"ALB"</span>, <span class="st">"\nAlbumin"</span>, <span class="va">what</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"%s %s [%s to %s["</span>,</span>
<span>          <span class="va">which</span>, <span class="va">what</span>, <span class="fu">signif_pad</span><span class="op">(</span><span class="va">from</span>, <span class="fl">3</span>, <span class="cn">FALSE</span><span class="op">)</span>, <span class="fu">signif_pad</span><span class="op">(</span><span class="va">to</span>, <span class="fl">3</span>, <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">plotlines</span><span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">outcovcomb</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">time</span>,<span class="va">CP</span>,col<span class="op">=</span><span class="va">SEX</span> <span class="op">)</span> <span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>group<span class="op">=</span><span class="va">ID</span><span class="op">)</span>,alpha<span class="op">=</span><span class="fl">0.1</span>,size<span class="op">=</span><span class="fl">0.1</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span><span class="fu">table1</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/table1/man/eqcut.html" class="external-link">eqcut</a></span><span class="op">(</span><span class="va">ALB</span>,<span class="fl">2</span>,<span class="va">f</span><span class="op">)</span> <span class="op">~</span> <span class="fu">table1</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/table1/man/eqcut.html" class="external-link">eqcut</a></span><span class="op">(</span><span class="va">WT</span>,<span class="fl">2</span>,<span class="va">fwt</span><span class="op">)</span>,labeller <span class="op">=</span> <span class="va">label_value</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>colour<span class="op">=</span><span class="st">"Sex"</span>,caption <span class="op">=</span><span class="st">"Simulation without Uncertainty\nFull</span></span>
<span><span class="st">       Covariate Distribution\nwithout BSV/Uncertainty"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Time (h)"</span>, y<span class="op">=</span><span class="st">"Plasma Concentrations"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html" class="external-link">coord_cartesian</a></span><span class="op">(</span>ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">3.5</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">plotranges</span><span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">outcovcomb</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">time</span>,<span class="va">CP</span>,col<span class="op">=</span><span class="va">SEX</span>,fill<span class="op">=</span><span class="va">SEX</span> <span class="op">)</span> <span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">stat_sum_df</span><span class="op">(</span>fun<span class="op">=</span><span class="st">"median_hilow"</span>,alpha<span class="op">=</span><span class="fl">0.2</span>,</span>
<span>              mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>group<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/interaction.html" class="external-link">interaction</a></span><span class="op">(</span><span class="fu">table1</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/table1/man/eqcut.html" class="external-link">eqcut</a></span><span class="op">(</span><span class="va">WT</span>,<span class="fl">2</span>,<span class="va">fwt</span><span class="op">)</span>,</span>
<span>                                              <span class="va">SEX</span>,</span>
<span>                                              <span class="fu">table1</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/table1/man/eqcut.html" class="external-link">eqcut</a></span><span class="op">(</span><span class="va">ALB</span>,<span class="fl">2</span>,<span class="va">f</span><span class="op">)</span><span class="op">)</span></span>
<span>              <span class="op">)</span>, colour <span class="op">=</span> <span class="st">"transparent"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">stat_sum_df_line</span><span class="op">(</span>fun<span class="op">=</span><span class="st">"median_hilow"</span>,size <span class="op">=</span><span class="fl">2</span>,</span>
<span>                   mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>linetype <span class="op">=</span> <span class="va">SEX</span>,</span>
<span>                                 group<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/interaction.html" class="external-link">interaction</a></span><span class="op">(</span><span class="fu">table1</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/table1/man/eqcut.html" class="external-link">eqcut</a></span><span class="op">(</span><span class="va">WT</span>,<span class="fl">2</span>,<span class="va">fwt</span><span class="op">)</span>,</span>
<span>                                                   <span class="va">SEX</span>,<span class="fu">table1</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/table1/man/eqcut.html" class="external-link">eqcut</a></span><span class="op">(</span><span class="va">ALB</span>,<span class="fl">2</span>,<span class="va">f</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span><span class="fu">table1</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/table1/man/eqcut.html" class="external-link">eqcut</a></span><span class="op">(</span><span class="va">ALB</span>,<span class="fl">2</span>,<span class="va">f</span><span class="op">)</span> <span class="op">~</span> <span class="fu">table1</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/table1/man/eqcut.html" class="external-link">eqcut</a></span><span class="op">(</span><span class="va">WT</span>,<span class="fl">2</span>,<span class="va">fwt</span><span class="op">)</span>,</span>
<span>             labeller <span class="op">=</span> <span class="va">label_value</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>linetype<span class="op">=</span><span class="st">"Sex"</span>,colour<span class="op">=</span><span class="st">"Sex"</span>,fill<span class="op">=</span><span class="st">"Sex"</span>,</span>
<span>  caption <span class="op">=</span><span class="st">"Simulation with Full Covariate Distribution with BSV</span></span>
<span><span class="st">  95% (Covariate Effects + BSV) Percentiles"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Time (h)"</span>, y<span class="op">=</span><span class="st">"Plasma Concentrations"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html" class="external-link">coord_cartesian</a></span><span class="op">(</span>ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">3.5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">plotranges</span></span></code></pre></div>
<p><img src="PK_Example_full_files/figure-html/unnamed-chunk-2-1.png" width="672"></p>
</div>
</div>
<div class="section level2">
<h2 id="adding-uncertainty-from-a-varcov-matrix">Adding Uncertainty from a Varcov Matrix<a class="anchor" aria-label="anchor" href="#adding-uncertainty-from-a-varcov-matrix"></a>
</h2>
<p>First, we will invent a varcov matrix by assuming 25% relative
standard errors and correlations of 0.2 across the board. We then
simulate a 100 set of parameters using a multivariate normal (kept at
100 for the vignette, use more replicates for a real project). Also,
unless the model was written in a way to allow unconstrained parameter
values, care should be taken to make sure the simulated parameters are
valid and make sense. When available, use the set of parameters from
bootstrap replicates.</p>
<p><strong>Variance Covariance Matrix of fixed effects:</strong></p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">theta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">unclass</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span><span class="fu">param</span><span class="op">(</span><span class="va">modcovsim</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">theta</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"WT"</span>, <span class="st">"SEX"</span>, <span class="st">"ALB"</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span><span class="va">theta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">theta</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">theta</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;    KA CL  V Vp Qp CLALB CLSEX CLWT VSEX VWT</span></span>
<span><span class="co">#&gt; 1 0.5  4 10 50 10  -0.8   0.2    1 0.07   1</span></span>
<span></span>
<span><span class="va">varcov</span> <span class="op">&lt;-</span> <span class="fu">cor2cov</span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0.2</span>, nrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">theta</span><span class="op">)</span>, ncol<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">theta</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  sd<span class="op">=</span><span class="va">theta</span><span class="op">*</span><span class="fl">0.25</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">varcov</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">varcov</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">theta</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">varcov</span><span class="op">)</span></span>
<span><span class="co">#&gt;               KA      CL        V        Vp       Qp  CLALB     CLSEX      CLWT</span></span>
<span><span class="co">#&gt; KA     0.0156250  0.0250  0.06250   0.31250  0.06250 -5e-03  0.001250  0.006250</span></span>
<span><span class="co">#&gt; CL     0.0250000  1.0000  0.50000   2.50000  0.50000 -4e-02  0.010000  0.050000</span></span>
<span><span class="co">#&gt; V      0.0625000  0.5000  6.25000   6.25000  1.25000 -1e-01  0.025000  0.125000</span></span>
<span><span class="co">#&gt; Vp     0.3125000  2.5000  6.25000 156.25000  6.25000 -5e-01  0.125000  0.625000</span></span>
<span><span class="co">#&gt; Qp     0.0625000  0.5000  1.25000   6.25000  6.25000 -1e-01  0.025000  0.125000</span></span>
<span><span class="co">#&gt; CLALB -0.0050000 -0.0400 -0.10000  -0.50000 -0.10000  4e-02 -0.002000 -0.010000</span></span>
<span><span class="co">#&gt; CLSEX  0.0012500  0.0100  0.02500   0.12500  0.02500 -2e-03  0.002500  0.002500</span></span>
<span><span class="co">#&gt; CLWT   0.0062500  0.0500  0.12500   0.62500  0.12500 -1e-02  0.002500  0.062500</span></span>
<span><span class="co">#&gt; VSEX   0.0004375  0.0035  0.00875   0.04375  0.00875 -7e-04  0.000175  0.000875</span></span>
<span><span class="co">#&gt; VWT    0.0062500  0.0500  0.12500   0.62500  0.12500 -1e-02  0.002500  0.012500</span></span>
<span><span class="co">#&gt;              VSEX       VWT</span></span>
<span><span class="co">#&gt; KA     0.00043750  0.006250</span></span>
<span><span class="co">#&gt; CL     0.00350000  0.050000</span></span>
<span><span class="co">#&gt; V      0.00875000  0.125000</span></span>
<span><span class="co">#&gt; Vp     0.04375000  0.625000</span></span>
<span><span class="co">#&gt; Qp     0.00875000  0.125000</span></span>
<span><span class="co">#&gt; CLALB -0.00070000 -0.010000</span></span>
<span><span class="co">#&gt; CLSEX  0.00017500  0.002500</span></span>
<span><span class="co">#&gt; CLWT   0.00087500  0.012500</span></span>
<span><span class="co">#&gt; VSEX   0.00030625  0.000875</span></span>
<span><span class="co">#&gt; VWT    0.00087500  0.062500</span></span></code></pre></div>
<div class="section level3">
<h3 id="generating-sets-of-parameters-with-uncertainty">Generating Sets of Parameters with Uncertainty<a class="anchor" aria-label="anchor" href="#generating-sets-of-parameters-with-uncertainty"></a>
</h3>
<p>Second, we generate the sim_parameters dataset using
<code>mvrnorm</code> and then incorporate the uncertainty by simulating
using a different set of parameters (row) for each replicate.</p>
<p><strong>First Few Rows of a Dataset Containing Simulated Fixed
Effects with Uncertainty:</strong></p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">678549</span><span class="op">)</span></span>
<span><span class="co"># mvtnorm::rmvnorm is another option that can be explored</span></span>
<span><span class="va">sim_parameters</span> <span class="op">&lt;-</span> <span class="fu">MASS</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/MASS/man/mvrnorm.html" class="external-link">mvrnorm</a></span><span class="op">(</span><span class="va">nsim</span>, <span class="va">theta</span>, <span class="va">varcov</span>, empirical<span class="op">=</span><span class="cn">T</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="va">as.data.table</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">sim_parameters</span><span class="op">)</span></span>
<span><span class="co">#&gt;           KA       CL         V       Vp        Qp      CLALB     CLSEX</span></span>
<span><span class="co">#&gt;        &lt;num&gt;    &lt;num&gt;     &lt;num&gt;    &lt;num&gt;     &lt;num&gt;      &lt;num&gt;     &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1: 0.5375471 3.859718 11.776286 52.39755  7.724310 -0.8066153 0.2945232</span></span>
<span><span class="co">#&gt; 2: 0.2230463 3.419779  8.011085 56.04744 10.419208 -0.9222598 0.1834507</span></span>
<span><span class="co">#&gt; 3: 0.5309878 4.015704 13.664640 52.43240  8.704933 -1.0714973 0.2111655</span></span>
<span><span class="co">#&gt; 4: 0.6365986 2.250415  6.909055 51.94856  9.417983 -0.8956168 0.1685993</span></span>
<span><span class="co">#&gt; 5: 0.4952909 2.903572 11.522559 43.72084 10.580390 -0.4553854 0.1521218</span></span>
<span><span class="co">#&gt; 6: 0.4543855 4.312384 10.023184 21.07089 10.220721 -0.8836006 0.1630121</span></span>
<span><span class="co">#&gt;         CLWT       VSEX       VWT</span></span>
<span><span class="co">#&gt;        &lt;num&gt;      &lt;num&gt;     &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1: 1.1738511 0.07151801 1.3858291</span></span>
<span><span class="co">#&gt; 2: 0.8402279 0.08457004 1.0878012</span></span>
<span><span class="co">#&gt; 3: 0.8196344 0.06084993 0.6810535</span></span>
<span><span class="co">#&gt; 4: 1.1129703 0.06006972 0.9283686</span></span>
<span><span class="co">#&gt; 5: 0.6110228 0.06239222 1.0600674</span></span>
<span><span class="co">#&gt; 6: 1.1534327 0.08007656 1.0493339</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="iterative-simulation-to-apply-the-uncertainty">Iterative Simulation to Apply the Uncertainty<a class="anchor" aria-label="anchor" href="#iterative-simulation-to-apply-the-uncertainty"></a>
</h3>
<p>Third, we illustrate how you can iterate over a set of parameters
value using a <code>for</code> loop. We then overlay the previous
simulation results without uncertainty on the one with uncertainty to
visualize the effect of adding it. The user might want to use a parallel
back-end to speed-up the simulations. The code that can simulate the
uncertainty of BSV is commented out to keep the vignette fast.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">idata</span> <span class="op">&lt;-</span> <span class="fu">copy</span><span class="op">(</span><span class="va">covdatasim</span><span class="op">)</span></span>
<span><span class="va">ev1</span>       <span class="op">&lt;-</span> <span class="fu">ev</span><span class="op">(</span>time<span class="op">=</span><span class="fl">0</span>, amt<span class="op">=</span><span class="fl">100</span>, cmt<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">data.dose</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">ev1</span><span class="op">)</span></span>
<span></span>
<span><span class="va">iter_sims</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">nsim</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># you might want to resample your covariate database here</span></span>
<span>  <span class="co"># e.g. subsample from a large pool of patient</span></span>
<span>  <span class="co"># include uncertainty on your covariate distribution</span></span>
<span>  </span>
<span>  <span class="va">data.all</span>  <span class="op">&lt;-</span> <span class="fu">data.table</span><span class="op">(</span><span class="va">idata</span>, <span class="va">data.dose</span>, <span class="va">sim_parameters</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">out</span> <span class="op">&lt;-</span> <span class="va">modcovsim</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu">data_set</span><span class="op">(</span><span class="va">data.all</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="co">#zero_re() %&gt;%</span></span>
<span>    <span class="co">#omat(rxode2::cvPost(2000, matrix(c(0.09,0.01,0.01,0.09), 2, 2),</span></span>
<span>    <span class="co">#type = "invWishart")) %&gt;%  # unc on bsv uncomment and increase nsim for CPT:PSP paper</span></span>
<span>    <span class="fu">mrgsim</span><span class="op">(</span>start<span class="op">=</span><span class="fl">0</span>, end<span class="op">=</span><span class="fl">24</span>, delta<span class="op">=</span><span class="fl">0.25</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="va">as.data.frame</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="va">as.data.table</span></span>
<span>  <span class="va">out</span><span class="op">[</span>, <span class="va">rep</span> <span class="op">:=</span> <span class="va">i</span><span class="op">]</span></span>
<span>  <span class="va">iter_sims</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">iter_sims</span>, <span class="va">out</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">f</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">xcat</span>, <span class="va">which</span>, <span class="va">what</span>, <span class="va">from</span>, <span class="va">to</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">what</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">sub</a></span><span class="op">(</span><span class="st">"ALB"</span>, <span class="st">"\nAlbumin"</span>, <span class="va">what</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"%s %s [%s to %s["</span>,</span>
<span>          <span class="va">which</span>, <span class="va">what</span>, <span class="fu">signif_pad</span><span class="op">(</span><span class="va">from</span>, <span class="fl">3</span>, <span class="cn">FALSE</span><span class="op">)</span>, <span class="fu">signif_pad</span><span class="op">(</span><span class="va">to</span>, <span class="fl">3</span>, <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">fwt</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">xcat</span>, <span class="va">which</span>, <span class="va">what</span>, <span class="va">from</span>, <span class="va">to</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">what</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">sub</a></span><span class="op">(</span><span class="st">"WT"</span>, <span class="st">"\nWeight"</span>, <span class="va">what</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"%s %s [%s to %s["</span>,</span>
<span>          <span class="va">which</span>, <span class="va">what</span>, <span class="fu">signif_pad</span><span class="op">(</span><span class="va">from</span>, <span class="fl">3</span>, <span class="cn">FALSE</span><span class="op">)</span>, <span class="fu">signif_pad</span><span class="op">(</span><span class="va">to</span>, <span class="fl">3</span>, <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">iter_sims_summary_all</span> <span class="op">&lt;-</span> <span class="va">iter_sims</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>WT<span class="op">=</span><span class="fu">table1</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/table1/man/eqcut.html" class="external-link">eqcut</a></span><span class="op">(</span><span class="va">WT</span>,<span class="fl">2</span>,<span class="va">fwt</span><span class="op">)</span>,ALB<span class="op">=</span><span class="fu">table1</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/table1/man/eqcut.html" class="external-link">eqcut</a></span><span class="op">(</span><span class="va">ALB</span>,<span class="fl">2</span>,<span class="va">f</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">time</span>,<span class="va">WT</span>,<span class="va">ALB</span>,<span class="va">SEX</span><span class="op">)</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span> P50<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span><span class="op">(</span><span class="va">CP</span><span class="op">)</span> ,</span>
<span>             P05 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">CP</span>,<span class="fl">0.05</span><span class="op">)</span>,</span>
<span>             P95<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">CP</span>,<span class="fl">0.95</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">iter_sims_summary_all</span><span class="op">$</span><span class="va">SEX</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">iter_sims_summary_all</span><span class="op">$</span><span class="va">SEX</span> <span class="op">)</span></span>
<span><span class="va">iter_sims_summary_all</span><span class="op">$</span><span class="va">SEX</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">iter_sims_summary_all</span><span class="op">$</span><span class="va">SEX</span>,labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Female"</span>,<span class="st">"Male"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">legendlabel</span><span class="op">&lt;-</span> <span class="st">"Median\n5%-95%"</span></span>
<span><span class="va">plotrangesunc</span><span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">iter_sims_summary_all</span>,</span>
<span>                       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">time</span>,<span class="va">P50</span>,col<span class="op">=</span><span class="va">SEX</span>,fill<span class="op">=</span><span class="va">SEX</span>,group<span class="op">=</span><span class="va">SEX</span>,linetype<span class="op">=</span><span class="va">SEX</span><span class="op">)</span> <span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>ymin<span class="op">=</span><span class="va">P05</span>,ymax<span class="op">=</span><span class="va">P95</span><span class="op">)</span>,alpha<span class="op">=</span><span class="fl">0.3</span>,linetype<span class="op">=</span><span class="fl">0</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">1</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span><span class="va">ALB</span> <span class="op">~</span> <span class="va">WT</span>, labeller <span class="op">=</span> <span class="va">label_value</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>linetype<span class="op">=</span><span class="va">legendlabel</span>,colour<span class="op">=</span><span class="va">legendlabel</span>,fill<span class="op">=</span><span class="va">legendlabel</span>,</span>
<span>       caption <span class="op">=</span><span class="st">"Simulation with joint correlated covariate distributions</span></span>
<span><span class="st">       with uncertainty and between subject variability"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Time (h)"</span>, y<span class="op">=</span><span class="st">"Plasma Concentrations"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html" class="external-link">coord_cartesian</a></span><span class="op">(</span>ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">3.5</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">plotrangesunc</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>axis.title.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">12</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html" class="external-link">coord_cartesian</a></span><span class="op">(</span>ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">4</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="PK_Example_full_files/figure-html/unnamed-chunk-5-1.png" width="672"></p>
</div>
<div class="section level3">
<h3 id="compute-pk-parameters-and-boxplots">Compute PK Parameters and Boxplots<a class="anchor" aria-label="anchor" href="#compute-pk-parameters-and-boxplots"></a>
</h3>
<p>Similar to an earlier section, we compute the PK parameters by
patient and by replicate standardize by the computed median for
reference subject by replicate and provide a plot. We add some data
manipulation to construct more informative labels that will help in the
plotting.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">out.df.parameters</span> <span class="op">&lt;-</span> <span class="va">iter_sims</span><span class="op">[</span>, <span class="fu">derive.exposure</span><span class="op">(</span><span class="va">time</span>, <span class="va">CP</span><span class="op">)</span>,</span>
<span>                                    by<span class="op">=</span><span class="fu">.</span><span class="op">(</span><span class="va">rep</span>, <span class="va">ID</span>, <span class="va">WT</span>, <span class="va">SEX</span>, <span class="va">ALB</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="va">refvalues</span> <span class="op">&lt;-</span> <span class="va">out.df.parameters</span><span class="op">[</span>,<span class="fu">.</span><span class="op">(</span>medparam <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span><span class="op">(</span><span class="va">paramvalue</span><span class="op">)</span><span class="op">)</span>, by<span class="op">=</span><span class="fu">.</span><span class="op">(</span><span class="va">paramname</span>,<span class="va">rep</span><span class="op">)</span><span class="op">]</span></span></code></pre></div>
<p><strong>Median Parameter Values for the Reference:</strong></p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu">setkey</span><span class="op">(</span><span class="va">out.df.parameters</span>, <span class="va">paramname</span>, <span class="va">rep</span><span class="op">)</span></span>
<span><span class="va">out.df.parameters</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="va">out.df.parameters</span>,<span class="va">refvalues</span><span class="op">)</span></span>
<span><span class="va">out.df.parameters</span><span class="op">[</span>, <span class="va">paramvaluestd</span> <span class="op">:=</span> <span class="va">paramvalue</span><span class="op">/</span><span class="va">medparam</span><span class="op">]</span></span>
<span></span>
<span><span class="va">out.df.parameters</span><span class="op">[</span>, <span class="va">SEXCAT</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span> <span class="va">SEX</span><span class="op">==</span><span class="fl">0</span>,<span class="st">"Female"</span>,<span class="st">"Male"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">out.df.parameters</span><span class="op">[</span>, <span class="va">REF</span> <span class="op">:=</span> <span class="st">"All Subjects"</span><span class="op">]</span></span>
<span><span class="va">out.df.parameters</span><span class="op">[</span>, <span class="va">WTCAT4</span> <span class="op">:=</span> <span class="fu">table1</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/table1/man/eqcut.html" class="external-link">eqcut</a></span><span class="op">(</span> <span class="va">out.df.parameters</span><span class="op">$</span><span class="va">WT</span>,<span class="fl">4</span>,varlabel <span class="op">=</span> <span class="st">"Weight"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">out.df.parameters</span><span class="op">[</span>, <span class="va">ALBCAT3</span> <span class="op">:=</span> <span class="fu">table1</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/table1/man/eqcut.html" class="external-link">eqcut</a></span><span class="op">(</span> <span class="va">out.df.parameters</span><span class="op">$</span><span class="va">ALB</span>,<span class="fl">3</span>,varlabel <span class="op">=</span> <span class="st">"Albumin"</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="va">nca.summaries.long</span> <span class="op">&lt;-</span>  <span class="fu">melt</span><span class="op">(</span><span class="va">out.df.parameters</span>, measure<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"REF"</span>,<span class="st">"WTCAT4"</span>,<span class="st">"ALBCAT3"</span>,<span class="st">"SEXCAT"</span><span class="op">)</span>,</span>
<span>                            value.name <span class="op">=</span> <span class="st">"covvalue"</span>,variable.name <span class="op">=</span><span class="st">"covname"</span> <span class="op">)</span></span>
<span></span>
<span><span class="va">nca.summaries.long</span><span class="op">$</span><span class="va">covvalue</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span> <span class="va">nca.summaries.long</span><span class="op">$</span><span class="va">covvalue</span><span class="op">)</span></span>
<span><span class="va">nca.summaries.long</span><span class="op">$</span><span class="va">covvalue</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/reorder.factor.html" class="external-link">reorder</a></span><span class="op">(</span><span class="va">nca.summaries.long</span><span class="op">$</span><span class="va">covvalue</span>,<span class="va">nca.summaries.long</span><span class="op">$</span><span class="va">paramvalue</span><span class="op">)</span></span>
<span></span>
<span><span class="va">nca.summaries.long</span><span class="op">$</span><span class="va">covvalue</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">nca.summaries.long</span><span class="op">$</span><span class="va">covvalue</span>,</span>
<span>                                      levels <span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>  </span>
<span>                                        <span class="st">"1st tertile of Albumin: [31.0,44.0)"</span></span>
<span>                                        , <span class="st">"2nd tertile of Albumin: [44.0,46.0)"</span></span>
<span>                                        , <span class="st">"3rd tertile of Albumin: [46.0,54.0]"</span></span>
<span>                                        , <span class="st">"Male"</span>  </span>
<span>                                        , <span class="st">"Female"</span></span>
<span>                                        , <span class="st">"All Subjects"</span></span>
<span>                                        , <span class="st">"1st quartile of Weight: [40.6,71.3)"</span></span>
<span>                                        , <span class="st">"2nd quartile of Weight: [71.3,85.0)"</span></span>
<span>                                        , <span class="st">"3rd quartile of Weight: [85.0,98.2)"</span></span>
<span>                                        ,<span class="st">"4th quartile of Weight: [98.2,222]"</span></span>
<span>                                      <span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">nca.summaries.long</span><span class="op">$</span><span class="va">covvalue2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">nca.summaries.long</span><span class="op">$</span><span class="va">covvalue</span>,</span>
<span>                                       labels <span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>  </span>
<span>                                         <span class="st">"T1: [31.0,44.0)"</span></span>
<span>                                         , <span class="st">"T2: [44.0,46.0)"</span></span>
<span>                                         , <span class="st">"T3: [46.0,54.0]"</span></span>
<span>                                         , <span class="st">"Male"</span>  </span>
<span>                                         , <span class="st">"Female"</span></span>
<span>                                         , <span class="st">"All Subjects"</span>     </span>
<span>                                         , <span class="st">"Q1: [40.6,71.3)"</span></span>
<span>                                         , <span class="st">"Q2: [71.3,85.0)"</span></span>
<span>                                         , <span class="st">"Q3: [85.0,98.2)"</span></span>
<span>                                         , <span class="st">"Q4: [98.2,222]"</span></span>
<span>                                       <span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">nca.summaries.long</span><span class="op">$</span><span class="va">covname</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">nca.summaries.long</span><span class="op">$</span><span class="va">covname</span><span class="op">)</span></span>
<span><span class="va">nca.summaries.long</span><span class="op">$</span><span class="va">covname</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">nca.summaries.long</span><span class="op">$</span><span class="va">covname</span>,</span>
<span>                                    levels <span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"WTCAT4"</span>,<span class="st">"SEXCAT"</span>,<span class="st">"ALBCAT3"</span>,<span class="st">"REF"</span><span class="op">)</span>,</span>
<span>                                    labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Weight"</span>,<span class="st">"Sex"</span>,<span class="st">"Albumin"</span>,<span class="st">"REF"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">func</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">bob</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">bob</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span><span class="op">(</span><span class="va">bob</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">bob</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">boxplotMV</span><span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">nca.summaries.long</span></span>
<span>                   , <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">covvalue2</span>  , y<span class="op">=</span><span class="va">paramvalue</span> <span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span> <span class="op">(</span>  <span class="va">paramname</span> <span class="op">~</span><span class="va">covname</span>, scales<span class="op">=</span><span class="st">"free"</span>, labeller<span class="op">=</span><span class="va">label_parsed</span>,</span>
<span>                switch<span class="op">=</span><span class="st">"both"</span>,space<span class="op">=</span><span class="st">"free_x"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html" class="external-link">geom_boxplot</a></span><span class="op">(</span>outlier.shape <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">12</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>axis.title<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        strip.placement <span class="op">=</span> <span class="st">"outside"</span>,</span>
<span>        axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>angle<span class="op">=</span><span class="fl">20</span>,vjust <span class="op">=</span> <span class="fl">1</span>, hjust <span class="op">=</span> <span class="fl">1</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span>,</span>
<span>        strip.text.y.left <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>angle<span class="op">=</span> <span class="fl">0</span>,vjust <span class="op">=</span> <span class="fl">1</span>, hjust <span class="op">=</span> <span class="fl">1</span>,face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/pretty_breaks.html" class="external-link">pretty_breaks</a></span><span class="op">(</span>n<span class="op">=</span><span class="fl">4</span><span class="op">)</span>  <span class="op">)</span></span>
<span><span class="va">boxplotMV</span></span></code></pre></div>
<p><img src="PK_Example_full_files/figure-html/unnamed-chunk-7-1.png" width="672"></p>
</div>
</div>
<div class="section level2">
<h2 id="alternative-view-of-the-data-distributions-and-intervals">Alternative View of the Data: Distributions and Intervals<a class="anchor" aria-label="anchor" href="#alternative-view-of-the-data-distributions-and-intervals"></a>
</h2>
<p>Here we provide an alternative visual summary of the standardized PK
parameters. It shows intervals of interest split by covariate quantiles
(e.g.Â below/above median, tertiles, quartiles).It is exactly the same
data as the boxplots. We need to keep in mind here that although we
split by one covariate quantiles we can split jointly by more than one
covariate. Also, the presented effects are joint effects of all
covariates viewed from a specific covariate angle.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ggridgesplot</span><span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">nca.summaries.long</span>,</span>
<span>                      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">paramvaluestd</span>,y<span class="op">=</span><span class="va">covvalue</span>,</span>
<span>                          fill<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">..quantile..</span><span class="op">)</span>,</span>
<span>                          height<span class="op">=</span><span class="va">..ndensity..</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span><span class="va">covname</span><span class="op">~</span><span class="va">paramname</span>,scales<span class="op">=</span><span class="st">"free_y"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html" class="external-link">annotate</a></span><span class="op">(</span> <span class="st">"rect"</span>,</span>
<span>            xmin <span class="op">=</span> <span class="fl">0.8</span>,</span>
<span>            xmax <span class="op">=</span> <span class="fl">1.25</span>,</span>
<span>            ymin <span class="op">=</span> <span class="op">-</span><span class="cn">Inf</span>,</span>
<span>            ymax <span class="op">=</span> <span class="cn">Inf</span>,</span>
<span>            fill <span class="op">=</span> <span class="st">"gray"</span>,alpha<span class="op">=</span><span class="fl">0.4</span></span>
<span>  <span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">stat_density_ridges</span><span class="op">(</span></span>
<span>    geom <span class="op">=</span> <span class="st">"density_ridges_gradient"</span>, calc_ecdf <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    quantile_lines <span class="op">=</span> <span class="cn">TRUE</span>, rel_min_height <span class="op">=</span> <span class="fl">0.01</span>,scale<span class="op">=</span><span class="fl">0.9</span>,</span>
<span>    quantiles <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.05</span>,<span class="fl">0.5</span>, <span class="fl">0.95</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span></span>
<span>    name <span class="op">=</span> <span class="st">"Probability"</span>, values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"white"</span>,<span class="st">"#0000FFA0"</span>, <span class="st">"#0000FFA0"</span>, <span class="st">"white"</span><span class="op">)</span>,</span>
<span>    labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"(0, 0.05]"</span>, <span class="st">"(0.05, 0.5]"</span>,<span class="st">"(0.5, 0.95]"</span>, <span class="st">"(0.95, 1]"</span><span class="op">)</span></span>
<span>  <span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span>data<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span> <span class="op">(</span>xintercept<span class="op">=</span><span class="fl">1</span><span class="op">)</span>,  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>xintercept <span class="op">=</span><span class="va">xintercept</span>  <span class="op">)</span>,size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x<span class="op">=</span><span class="st">"Effects Of Covariates on PK Parameter"</span>,y<span class="op">=</span><span class="st">""</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>breaks<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>,<span class="fl">0.8</span>,<span class="fl">1</span><span class="op">/</span><span class="fl">0.8</span>,<span class="fl">1</span><span class="op">/</span><span class="fl">0.5</span>,<span class="fl">1</span><span class="op">/</span><span class="fl">0.25</span><span class="op">)</span>,trans <span class="op">=</span><span class="st">"log"</span> <span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html" class="external-link">coord_cartesian</a></span><span class="op">(</span>xlim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.25</span>,<span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">ggridgesplot</span></span></code></pre></div>
<p><img src="PK_Example_full_files/figure-html/unnamed-chunk-8-1.png" width="672"></p>
</div>
<div class="section level2">
<h2 id="putting-it-all-together-using-forest_plot">Putting it all Together Using <code>forest_plot</code><a class="anchor" aria-label="anchor" href="#putting-it-all-together-using-forest_plot"></a>
</h2>
<p>Here we have the joint effects of correlated covariates, BSV and
uncertainty concisely summarized and presented using intervals.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">coveffectsdatacovrep</span> <span class="op">&lt;-</span> <span class="va">nca.summaries.long</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">paramname</span>,<span class="va">covname</span>,<span class="va">covvalue</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span></span>
<span>    mid<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span><span class="op">(</span><span class="va">paramvaluestd</span><span class="op">)</span>,</span>
<span>    lower<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">paramvaluestd</span>,<span class="fl">0.05</span><span class="op">)</span>,</span>
<span>    upper <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">paramvaluestd</span>,<span class="fl">0.95</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">mid</span><span class="op">)</span><span class="op">)</span> </span>
<span></span>
<span></span>
<span><span class="va">coveffectsdatacovrepbsv</span> <span class="op">&lt;-</span> <span class="va">coveffectsdatacovrep</span><span class="op">[</span><span class="va">coveffectsdatacovrep</span><span class="op">$</span><span class="va">covname</span><span class="op">==</span><span class="st">"REF"</span>,<span class="op">]</span></span>
<span><span class="va">coveffectsdatacovrepbsv</span><span class="op">$</span><span class="va">covname</span> <span class="op">&lt;-</span> <span class="st">"BSV"</span></span>
<span><span class="va">coveffectsdatacovrepbsv</span><span class="op">$</span><span class="va">covvalue</span> <span class="op">&lt;-</span> <span class="st">"90% of patients"</span></span>
<span><span class="va">coveffectsdatacovrepbsv</span><span class="op">$</span><span class="va">label</span> <span class="op">&lt;-</span>    <span class="st">"90% of patients"</span></span>
<span><span class="va">coveffectsdatacovrepbsv</span><span class="op">$</span><span class="va">lower</span> <span class="op">&lt;-</span> <span class="va">bsvranges</span><span class="op">$</span><span class="va">P05</span></span>
<span><span class="va">coveffectsdatacovrepbsv</span><span class="op">$</span><span class="va">upper</span> <span class="op">&lt;-</span> <span class="va">bsvranges</span><span class="op">$</span><span class="va">P95</span></span>
<span><span class="va">coveffectsdatacovrepbsv2</span> <span class="op">&lt;-</span> <span class="va">coveffectsdatacovrep</span><span class="op">[</span><span class="va">coveffectsdatacovrep</span><span class="op">$</span><span class="va">covname</span><span class="op">==</span><span class="st">"REF"</span>,<span class="op">]</span></span>
<span><span class="va">coveffectsdatacovrepbsv2</span><span class="op">$</span><span class="va">covname</span> <span class="op">&lt;-</span> <span class="st">"BSV"</span></span>
<span><span class="va">coveffectsdatacovrepbsv2</span><span class="op">$</span><span class="va">covvalue</span> <span class="op">&lt;-</span> <span class="st">"50% of patients"</span></span>
<span><span class="va">coveffectsdatacovrepbsv2</span><span class="op">$</span><span class="va">label</span> <span class="op">&lt;-</span>    <span class="st">"50% of patients"</span></span>
<span><span class="va">coveffectsdatacovrepbsv2</span><span class="op">$</span><span class="va">lower</span> <span class="op">&lt;-</span> <span class="va">bsvranges</span><span class="op">$</span><span class="va">P25</span></span>
<span><span class="va">coveffectsdatacovrepbsv2</span><span class="op">$</span><span class="va">upper</span> <span class="op">&lt;-</span> <span class="va">bsvranges</span><span class="op">$</span><span class="va">P75</span></span>
<span></span>
<span><span class="va">coveffectsdatacovrepbsv</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">coveffectsdatacovrep</span>,<span class="va">coveffectsdatacovrepbsv2</span>,</span>
<span>                                <span class="va">coveffectsdatacovrepbsv</span><span class="op">)</span></span>
<span><span class="va">coveffectsdatacovrepbsv</span> <span class="op">&lt;-</span> <span class="va">coveffectsdatacovrepbsv</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    label<span class="op">=</span> <span class="va">covvalue</span>,</span>
<span>    LABEL <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/format.html" class="external-link">format</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">mid</span>,<span class="fl">2</span><span class="op">)</span>, nsmall <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,</span>
<span>                   <span class="st">" ["</span>, <span class="fu"><a href="https://rdrr.io/r/base/format.html" class="external-link">format</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">lower</span>,<span class="fl">2</span><span class="op">)</span>, nsmall <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>, <span class="st">"-"</span>,</span>
<span>                   <span class="fu"><a href="https://rdrr.io/r/base/format.html" class="external-link">format</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">upper</span>,<span class="fl">2</span><span class="op">)</span>, nsmall <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>, <span class="st">"]"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">coveffectsdatacovrepbsv</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">coveffectsdatacovrepbsv</span><span class="op">)</span></span>
<span></span>
<span><span class="va">coveffectsdatacovrepbsv</span><span class="op">$</span><span class="va">label</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">": "</span>, <span class="st">":\n"</span>, <span class="va">coveffectsdatacovrepbsv</span><span class="op">$</span><span class="va">label</span><span class="op">)</span></span>
<span></span>
<span><span class="va">coveffectsdatacovrepbsv</span><span class="op">$</span><span class="va">covname</span> <span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">coveffectsdatacovrepbsv</span><span class="op">$</span><span class="va">covname</span> <span class="op">)</span>,</span>
<span>                                         levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Weight"</span>,<span class="st">"Sex"</span>,<span class="st">"Albumin"</span>,<span class="st">"REF"</span>,<span class="st">"BSV"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">coveffectsdatacovrepbsv</span><span class="op">$</span><span class="va">label</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">coveffectsdatacovrepbsv</span><span class="op">$</span><span class="va">label</span>,</span>
<span>                                        levels <span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span> <span class="st">"1st tertile of Albumin:\n[31.0,44.0)"</span></span>
<span>                                                   , <span class="st">"2nd tertile of Albumin:\n[44.0,46.0)"</span></span>
<span>                                                   , <span class="st">"3rd tertile of Albumin:\n[46.0,54.0]"</span></span>
<span>                                                   , <span class="st">"Male"</span>, <span class="st">"Female"</span></span>
<span>                                                   , <span class="st">"All Subjects"</span>,<span class="st">"90% of patients"</span>,<span class="st">"50% of patients"</span></span>
<span>                                                   , <span class="st">"1st quartile of Weight:\n[40.6,71.3)"</span></span>
<span>                                                   , <span class="st">"2nd quartile of Weight:\n[71.3,85.0)"</span></span>
<span>                                                   , <span class="st">"3rd quartile of Weight:\n[85.0,98.2)"</span></span>
<span>                                                   ,<span class="st">"4th quartile of Weight:\n[98.2,222]"</span></span>
<span>                                        <span class="op">)</span><span class="op">)</span></span>
<span><span class="va">coveffectsdatacovrepbsv</span><span class="op">$</span><span class="va">label</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">coveffectsdatacovrepbsv</span><span class="op">$</span><span class="va">label</span>,</span>
<span>                                        labels <span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"T1:\n[31.0,44.0)"</span></span>
<span>                                                  , <span class="st">"T2:\n[44.0,46.0)"</span></span>
<span>                                                  , <span class="st">"T3:\n[46.0,54.0]"</span></span>
<span>                                                  , <span class="st">"Male"</span>, <span class="st">"Female"</span></span>
<span>                                                  , <span class="st">"All Subjects"</span>,<span class="st">"90% of patients"</span>,<span class="st">"50% of patients"</span></span>
<span>                                                  , <span class="st">"Q1:\n[40.6,71.3)"</span></span>
<span>                                                  , <span class="st">"Q2:\n[71.3,85.0)"</span></span>
<span>                                                  , <span class="st">"Q3:\n[85.0,98.2)"</span></span>
<span>                                                  , <span class="st">"Q4:\n[98.2,222]"</span></span>
<span>                                        <span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">interval_legend_text</span> <span class="op">&lt;-</span> <span class="st">"Median (points)\n90% intervals (horizontal lines)\njoint effects:</span></span>
<span><span class="st">covariate distributions,</span></span>
<span><span class="st">uncertainty</span></span>
<span><span class="st">and between subject variability"</span></span>
<span><span class="va">interval_bsv_text</span>    <span class="op">&lt;-</span> <span class="st">"BSV (points)\nPrediction Intervals (horizontal lines)"</span></span>
<span><span class="va">ref_legend_text</span>      <span class="op">&lt;-</span> <span class="st">"Reference (vertical line)\nClinically relevant limits\n(gray area)"</span></span>
<span><span class="va">area_legend_text</span>     <span class="op">&lt;-</span> <span class="st">"Reference (vertical line)\nClinically relevant limits\n(gray area)"</span></span>
<span></span>
<span></span>
<span><span class="co">#emf("Figure_PKdist_forest.emf",width= 15, height = 7.5)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/grDevices/png.html" class="external-link">png</a></span><span class="op">(</span><span class="st">"./coveffectsplot_full.png"</span>,width <span class="op">=</span><span class="fl">9.5</span> ,height <span class="op">=</span> <span class="fl">8</span>,units <span class="op">=</span> <span class="st">"in"</span>,res<span class="op">=</span><span class="fl">72</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/forest_plot.html">forest_plot</a></span><span class="op">(</span><span class="va">coveffectsdatacovrepbsv</span><span class="op">[</span><span class="va">coveffectsdatacovrepbsv</span><span class="op">$</span><span class="va">covname</span><span class="op">!=</span><span class="st">"REF"</span><span class="op">&amp;</span></span>
<span>                                                      <span class="va">coveffectsdatacovrepbsv</span><span class="op">$</span><span class="va">covname</span><span class="op">!=</span><span class="st">"BSV"</span>,</span>
<span><span class="op">]</span>,</span>
<span>ref_area <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.8</span>, <span class="fl">1</span><span class="op">/</span><span class="fl">0.8</span><span class="op">)</span>,x_range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.4</span>,<span class="fl">3</span><span class="op">)</span>,</span>
<span>strip_placement <span class="op">=</span> <span class="st">"outside"</span>,base_size <span class="op">=</span> <span class="fl">18</span>,</span>
<span>y_label_text_size <span class="op">=</span> <span class="fl">9</span>,x_label_text_size <span class="op">=</span> <span class="fl">10</span>,</span>
<span>xlabel <span class="op">=</span> <span class="st">"Fold Change Relative to Reference"</span>,</span>
<span>ref_legend_text <span class="op">=</span> <span class="va">ref_legend_text</span>,</span>
<span>area_legend_text <span class="op">=</span> <span class="va">ref_legend_text</span> ,</span>
<span>interval_legend_text <span class="op">=</span> <span class="va">interval_legend_text</span>,</span>
<span>legend_order <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"pointinterval"</span>, <span class="st">"ref"</span>, <span class="st">"area"</span><span class="op">)</span>,</span>
<span>combine_interval_shape_legend <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>plot_title <span class="op">=</span> <span class="st">""</span>,</span>
<span>interval_bsv_text <span class="op">=</span> <span class="va">interval_bsv_text</span>,</span>
<span>facet_formula <span class="op">=</span> <span class="st">"covname~paramname"</span>,</span>
<span>facet_switch <span class="op">=</span> <span class="st">"y"</span>,</span>
<span>table_facet_switch <span class="op">=</span> <span class="st">"both"</span>,</span>
<span>reserve_table_xaxis_label_space <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>facet_scales <span class="op">=</span> <span class="st">"free_y"</span>, facet_space <span class="op">=</span> <span class="st">"free"</span>,</span>
<span>paramname_shape <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>table_position <span class="op">=</span> <span class="st">"below"</span>,</span>
<span>show_table_yaxis_tick_label <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>table_text_size<span class="op">=</span> <span class="fl">4</span>,</span>
<span>plot_table_ratio <span class="op">=</span> <span class="fl">1</span>,</span>
<span>show_table_facet_strip <span class="op">=</span> <span class="st">"both"</span>,</span>
<span>logxscale <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>major_x_ticks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>,<span class="fl">0.8</span>,<span class="fl">1</span><span class="op">/</span><span class="fl">0.8</span>,<span class="fl">1</span><span class="op">/</span><span class="fl">0.5</span><span class="op">)</span>,</span>
<span>return_list <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html" class="external-link">dev.off</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; png </span></span>
<span><span class="co">#&gt;   2</span></span></code></pre></div>
<div class="float">
<img src="coveffectsplot_full.png" alt="Covariate Effects Plot With BSV."><div class="figcaption">Covariate Effects Plot With BSV.</div>
</div>
</div>
<div class="section level2">
<h2 id="computing-geometric-mean-ratios-gmr-using-a-category-as-reference">Computing Geometric Mean Ratios (GMR) using a category as
reference<a class="anchor" aria-label="anchor" href="#computing-geometric-mean-ratios-gmr-using-a-category-as-reference"></a>
</h2>
<p>It is often more useful to compute GMR for each split/facet using one
of the categories as reference.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">refSex</span> <span class="op">&lt;-</span> <span class="va">out.df.parameters</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">SEX</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>covname<span class="op">=</span><span class="st">"SEXCAT"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">rep</span>,<span class="va">paramname</span>,<span class="va">covname</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>refvalue<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span><span class="op">(</span><span class="va">paramvalue</span><span class="op">)</span>,</span>
<span>                   geommeanref<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">paramvalue</span><span class="op">)</span> <span class="op">)</span>,</span>
<span>                   varianceref <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">var</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">paramvalue</span><span class="op">)</span> <span class="op">)</span>,</span>
<span>                   Nref <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">refWeight</span> <span class="op">&lt;-</span> <span class="va">out.df.parameters</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">WTCAT4</span><span class="op">==</span><span class="st">"2nd quartile of Weight: [71.3,85.0)"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>covname<span class="op">=</span><span class="st">"WTCAT4"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">rep</span>,<span class="va">paramname</span>,<span class="va">covname</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>refvalue<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span><span class="op">(</span><span class="va">paramvalue</span><span class="op">)</span>,</span>
<span>                   geommeanref<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">paramvalue</span><span class="op">)</span> <span class="op">)</span>,</span>
<span>                   varianceref <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">var</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">paramvalue</span><span class="op">)</span> <span class="op">)</span>,</span>
<span>                   Nref <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">refAlbumin</span> <span class="op">&lt;-</span> <span class="va">out.df.parameters</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">ALBCAT3</span><span class="op">==</span><span class="st">"2nd tertile of Albumin: [44.0,46.0)"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>covname<span class="op">=</span><span class="st">"ALBCAT3"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">rep</span>,<span class="va">paramname</span>,<span class="va">covname</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>refvalue<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span><span class="op">(</span><span class="va">paramvalue</span><span class="op">)</span>,</span>
<span>                   geommeanref<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">paramvalue</span><span class="op">)</span> <span class="op">)</span>,</span>
<span>                   varianceref <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">var</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">paramvalue</span><span class="op">)</span> <span class="op">)</span>,</span>
<span>                   Nref <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">refvaluesall</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">refSex</span>,<span class="va">refWeight</span>,<span class="va">refAlbumin</span><span class="op">)</span></span>
<span></span>
<span><span class="va">out.df.parameters.long</span> <span class="op">&lt;-</span> <span class="va">out.df.parameters</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">gather</span><span class="op">(</span><span class="va">covname</span>,<span class="va">covvalue</span>,<span class="st">"SEXCAT"</span>,<span class="st">"WTCAT4"</span>,<span class="st">"ALBCAT3"</span>,factor_key <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">out.df.parameters.long</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">out.df.parameters.long</span>,<span class="va">refvaluesall</span><span class="op">)</span></span>
<span></span>
<span><span class="va">out.df.parameters.long</span><span class="op">$</span><span class="va">paramvaluestd</span> <span class="op">&lt;-</span> <span class="va">out.df.parameters.long</span><span class="op">$</span><span class="va">paramvalue</span><span class="op">/</span><span class="va">out.df.parameters.long</span><span class="op">$</span><span class="va">refvalue</span></span>
<span><span class="va">out.df.parameters.long</span><span class="op">&lt;-</span> <span class="va">out.df.parameters.long</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">rep</span>,<span class="va">covname</span>,<span class="va">paramname</span>,<span class="va">covvalue</span>,</span>
<span>           <span class="va">geommeanref</span>,<span class="va">varianceref</span>, <span class="va">Nref</span><span class="op">)</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>geommean<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">paramvalue</span><span class="op">)</span> <span class="op">)</span>,</span>
<span>                   variance <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">var</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">paramvalue</span><span class="op">)</span> <span class="op">)</span>,</span>
<span>                   N <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>meanlogdiff<span class="op">=</span> <span class="va">geommean</span> <span class="op">-</span> <span class="va">geommeanref</span>,</span>
<span>         mid <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">meanlogdiff</span><span class="op">)</span>,</span>
<span>         SDERR <span class="op">=</span>  <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="op">(</span><span class="va">variance</span><span class="op">/</span><span class="va">N</span><span class="op">)</span> <span class="op">+</span> <span class="op">(</span><span class="va">varianceref</span><span class="op">/</span><span class="va">Nref</span><span class="op">)</span><span class="op">)</span>,</span>
<span>         Rnorm <span class="op">=</span> <span class="va">SDERR</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">qnorm</a></span><span class="op">(</span><span class="fl">0.95</span><span class="op">)</span>,</span>
<span>         lower <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">meanlogdiff</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">qnorm</a></span><span class="op">(</span><span class="fl">0.95</span><span class="op">)</span> <span class="op">*</span> <span class="va">SDERR</span><span class="op">)</span>,</span>
<span>         upper <span class="op">=</span>   <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">meanlogdiff</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">qnorm</a></span><span class="op">(</span><span class="fl">0.95</span><span class="op">)</span> <span class="op">*</span> <span class="va">SDERR</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">out.df.parameters.long</span><span class="op">$</span><span class="va">covvalue2</span> <span class="op">&lt;-</span> <span class="va">out.df.parameters.long</span><span class="op">$</span><span class="va">covvalue</span></span>
<span></span>
<span><span class="va">out.df.parameters.long</span> <span class="op">&lt;-</span> <span class="va">out.df.parameters.long</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">covvalue2</span>,<span class="va">covname</span>,<span class="va">paramname</span>,<span class="va">covvalue</span>,<span class="va">N</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span></span>
<span>    mid<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span><span class="op">(</span><span class="va">mid</span> <span class="op">)</span>,</span>
<span>    lower<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span><span class="op">(</span><span class="va">lower</span>  <span class="op">)</span>,</span>
<span>    upper <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span><span class="op">(</span><span class="va">upper</span> <span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">out.df.parameters.long</span> <span class="op">&lt;-</span> <span class="va">out.df.parameters.long</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span> label<span class="op">=</span> <span class="va">covvalue2</span>,</span>
<span>          LABEL <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/format.html" class="external-link">format</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">mid</span>,<span class="fl">2</span><span class="op">)</span>, nsmall <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,</span>
<span>                         <span class="st">" ["</span>, <span class="fu"><a href="https://rdrr.io/r/base/format.html" class="external-link">format</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">lower</span>,<span class="fl">2</span><span class="op">)</span>, nsmall <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>, <span class="st">"-"</span>,</span>
<span>                         <span class="fu"><a href="https://rdrr.io/r/base/format.html" class="external-link">format</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">upper</span>,<span class="fl">2</span><span class="op">)</span>, nsmall <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>, <span class="st">"]"</span>,<span class="st">" N="</span>,<span class="va">N</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">out.df.parameters.long</span><span class="op">$</span><span class="va">lower</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">out.df.parameters.long</span><span class="op">$</span><span class="va">mid</span><span class="op">==</span><span class="fl">1</span>,</span>
<span>                                   <span class="fl">1</span>, <span class="va">out.df.parameters.long</span><span class="op">$</span><span class="va">lower</span><span class="op">)</span></span>
<span><span class="va">out.df.parameters.long</span><span class="op">$</span><span class="va">upper</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">out.df.parameters.long</span><span class="op">$</span><span class="va">mid</span><span class="op">==</span><span class="fl">1</span>,</span>
<span>                                   <span class="fl">1</span>, <span class="va">out.df.parameters.long</span><span class="op">$</span><span class="va">upper</span><span class="op">)</span></span>
<span><span class="va">out.df.parameters.long</span><span class="op">$</span><span class="va">LABEL</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">out.df.parameters.long</span><span class="op">$</span><span class="va">mid</span><span class="op">==</span><span class="fl">1</span>,</span>
<span>                                   <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Reference"</span>, <span class="st">" N="</span>,<span class="va">out.df.parameters.long</span><span class="op">$</span><span class="va">N</span><span class="op">)</span>,</span>
<span>                                   <span class="va">out.df.parameters.long</span><span class="op">$</span><span class="va">LABEL</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/grDevices/png.html" class="external-link">png</a></span><span class="op">(</span><span class="st">"./coveffectsplot_full_gmr.png"</span>,width <span class="op">=</span><span class="fl">9.5</span> ,height <span class="op">=</span> <span class="fl">8</span>,units <span class="op">=</span> <span class="st">"in"</span>,res<span class="op">=</span><span class="fl">72</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/forest_plot.html">forest_plot</a></span><span class="op">(</span><span class="va">out.df.parameters.long</span>,</span>
<span>ref_area <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.8</span>, <span class="fl">1</span><span class="op">/</span><span class="fl">0.8</span><span class="op">)</span>,x_range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.4</span>,<span class="fl">3</span><span class="op">)</span>,</span>
<span>strip_placement <span class="op">=</span> <span class="st">"outside"</span>,base_size <span class="op">=</span> <span class="fl">18</span>,</span>
<span>y_label_text_size <span class="op">=</span> <span class="fl">9</span>,x_label_text_size <span class="op">=</span> <span class="fl">10</span>,</span>
<span>xlabel <span class="op">=</span> <span class="st">"Fold Change Relative to Reference"</span>,</span>
<span>ref_legend_text <span class="op">=</span> <span class="va">ref_legend_text</span>,</span>
<span>area_legend_text <span class="op">=</span> <span class="va">ref_legend_text</span> ,</span>
<span>interval_legend_text <span class="op">=</span> <span class="va">interval_legend_text</span>,</span>
<span>interval_size <span class="op">=</span> <span class="fl">1</span>,</span>
<span>interval_fatten <span class="op">=</span> <span class="fl">2</span>,</span>
<span>legend_order <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"pointinterval"</span>, <span class="st">"ref"</span>, <span class="st">"area"</span><span class="op">)</span>,</span>
<span>combine_interval_shape_legend <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>plot_title <span class="op">=</span> <span class="st">""</span>,</span>
<span>interval_bsv_text <span class="op">=</span> <span class="va">interval_bsv_text</span>,</span>
<span>facet_formula <span class="op">=</span> <span class="st">"covname~paramname"</span>,</span>
<span>facet_switch <span class="op">=</span> <span class="st">"y"</span>,</span>
<span>table_facet_switch <span class="op">=</span> <span class="st">"both"</span>,</span>
<span>reserve_table_xaxis_label_space <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>facet_scales <span class="op">=</span> <span class="st">"free_y"</span>, facet_space <span class="op">=</span> <span class="st">"free"</span>,</span>
<span>paramname_shape <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>table_position <span class="op">=</span> <span class="st">"below"</span>,</span>
<span>show_table_yaxis_tick_label <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>table_text_size<span class="op">=</span> <span class="fl">4</span>,</span>
<span>plot_table_ratio <span class="op">=</span> <span class="fl">1</span>,</span>
<span>show_table_facet_strip <span class="op">=</span> <span class="st">"both"</span>,</span>
<span>logxscale <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>major_x_ticks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>,<span class="fl">0.8</span>,<span class="fl">1</span><span class="op">/</span><span class="fl">0.8</span>,<span class="fl">1</span><span class="op">/</span><span class="fl">0.5</span><span class="op">)</span>,</span>
<span>return_list <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html" class="external-link">dev.off</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; png </span></span>
<span><span class="co">#&gt;   2</span></span></code></pre></div>
<div class="float">
<img src="coveffectsplot_full_gmr.png" alt="Covariate Effects Plot With BSV."><div class="figcaption">Covariate Effects Plot With BSV.</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Samer Mouksassi, Benjamin Rich.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

      </footer>
</div>






  </body>
</html>
